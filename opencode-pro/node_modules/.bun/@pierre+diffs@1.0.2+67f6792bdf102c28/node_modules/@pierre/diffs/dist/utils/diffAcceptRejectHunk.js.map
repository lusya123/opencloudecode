{"version":3,"file":"diffAcceptRejectHunk.js","names":["newContent: ContextContent"],"sources":["../../src/utils/diffAcceptRejectHunk.ts"],"sourcesContent":["import type { ContextContent, FileDiffMetadata } from '../types';\n\nexport function diffAcceptRejectHunk(\n  diff: FileDiffMetadata,\n  hunkIndex: number,\n  type: 'accept' | 'reject'\n): FileDiffMetadata {\n  diff = {\n    ...diff,\n    hunks: [...diff.hunks],\n    oldLines: diff.oldLines != null ? [...diff.oldLines] : undefined,\n    newLines: diff.newLines != null ? [...diff.newLines] : undefined,\n    // Automatically update cacheKey if it exists, since content is changing\n    cacheKey:\n      diff.cacheKey != null\n        ? `${diff.cacheKey}:${type[0]}-${hunkIndex}`\n        : undefined,\n  };\n  // Fix the content lines\n  const { newLines, oldLines } = diff;\n  if (newLines != null && oldLines != null) {\n    const hunk = diff.hunks[hunkIndex];\n    if (hunk == null) {\n      console.error({ diff, hunkIndex });\n      throw new Error(\n        `diffResolveRejectHunk: Invalid hunk index: ${hunkIndex}`\n      );\n    }\n    if (type === 'reject') {\n      newLines.splice(\n        hunk.additionStart - 1,\n        hunk.additionCount,\n        ...oldLines.slice(\n          hunk.deletionStart - 1,\n          hunk.deletionStart - 1 + hunk.deletionCount\n        )\n      );\n    } else {\n      oldLines.splice(\n        hunk.deletionStart - 1,\n        hunk.deletionCount,\n        ...newLines.slice(\n          hunk.additionStart - 1,\n          hunk.additionStart - 1 + hunk.additionCount\n        )\n      );\n    }\n  }\n  let deletionOffset = 0;\n  let additionOffset = 0;\n  let splitOffset = 0;\n  let unifiedOffset = 0;\n  for (let i = hunkIndex; i < diff.hunks.length; i++) {\n    let hunk = diff.hunks[i];\n    if (hunk == null) {\n      console.error({ hunk, i, hunkIndex, diff });\n      throw new Error(\n        'diffResolveRejectHunk: iterating through hunks, hunk doesnt exist...'\n      );\n    }\n    hunk = { ...hunk };\n    diff.hunks[i] = hunk;\n    if (i === hunkIndex) {\n      const newContent: ContextContent = {\n        type: 'context',\n        lines: [],\n        noEOFCR: false,\n      };\n      for (const content of hunk.hunkContent) {\n        if (content.type === 'context') {\n          newContent.lines.push(...content.lines);\n          newContent.noEOFCR = content.noEOFCR;\n        } else if (type === 'accept') {\n          newContent.lines.push(...content.additions);\n          newContent.noEOFCR = content.noEOFCRAdditions;\n        } else if (type === 'reject') {\n          newContent.lines.push(...content.deletions);\n          newContent.noEOFCR = content.noEOFCRDeletions;\n        }\n      }\n      const lineCount = newContent.lines.length;\n      hunk.hunkContent = [newContent];\n      splitOffset = lineCount - hunk.splitLineCount;\n      hunk.splitLineCount = lineCount;\n      unifiedOffset = lineCount - hunk.unifiedLineCount;\n      hunk.unifiedLineCount = lineCount;\n      deletionOffset = lineCount - hunk.deletionCount;\n      hunk.deletionCount = lineCount;\n      hunk.deletionLines = 0;\n      additionOffset = lineCount - hunk.additionCount;\n      hunk.additionCount = lineCount;\n      hunk.additionLines = 0;\n      diff.splitLineCount += splitOffset;\n      diff.unifiedLineCount += unifiedOffset;\n    } else {\n      hunk.splitLineStart += splitOffset;\n      hunk.unifiedLineStart += unifiedOffset;\n      hunk.additionStart += additionOffset;\n      hunk.deletionStart += deletionOffset;\n    }\n  }\n  return diff;\n}\n"],"mappings":";AAEA,SAAgB,qBACd,MACA,WACA,MACkB;AAClB,QAAO;EACL,GAAG;EACH,OAAO,CAAC,GAAG,KAAK,MAAM;EACtB,UAAU,KAAK,YAAY,OAAO,CAAC,GAAG,KAAK,SAAS,GAAG;EACvD,UAAU,KAAK,YAAY,OAAO,CAAC,GAAG,KAAK,SAAS,GAAG;EAEvD,UACE,KAAK,YAAY,OACb,GAAG,KAAK,SAAS,GAAG,KAAK,GAAG,GAAG,cAC/B;EACP;CAED,MAAM,EAAE,UAAU,aAAa;AAC/B,KAAI,YAAY,QAAQ,YAAY,MAAM;EACxC,MAAM,OAAO,KAAK,MAAM;AACxB,MAAI,QAAQ,MAAM;AAChB,WAAQ,MAAM;IAAE;IAAM;IAAW,CAAC;AAClC,SAAM,IAAI,MACR,8CAA8C,YAC/C;;AAEH,MAAI,SAAS,SACX,UAAS,OACP,KAAK,gBAAgB,GACrB,KAAK,eACL,GAAG,SAAS,MACV,KAAK,gBAAgB,GACrB,KAAK,gBAAgB,IAAI,KAAK,cAC/B,CACF;MAED,UAAS,OACP,KAAK,gBAAgB,GACrB,KAAK,eACL,GAAG,SAAS,MACV,KAAK,gBAAgB,GACrB,KAAK,gBAAgB,IAAI,KAAK,cAC/B,CACF;;CAGL,IAAI,iBAAiB;CACrB,IAAI,iBAAiB;CACrB,IAAI,cAAc;CAClB,IAAI,gBAAgB;AACpB,MAAK,IAAI,IAAI,WAAW,IAAI,KAAK,MAAM,QAAQ,KAAK;EAClD,IAAI,OAAO,KAAK,MAAM;AACtB,MAAI,QAAQ,MAAM;AAChB,WAAQ,MAAM;IAAE;IAAM;IAAG;IAAW;IAAM,CAAC;AAC3C,SAAM,IAAI,MACR,uEACD;;AAEH,SAAO,EAAE,GAAG,MAAM;AAClB,OAAK,MAAM,KAAK;AAChB,MAAI,MAAM,WAAW;GACnB,MAAMA,aAA6B;IACjC,MAAM;IACN,OAAO,EAAE;IACT,SAAS;IACV;AACD,QAAK,MAAM,WAAW,KAAK,YACzB,KAAI,QAAQ,SAAS,WAAW;AAC9B,eAAW,MAAM,KAAK,GAAG,QAAQ,MAAM;AACvC,eAAW,UAAU,QAAQ;cACpB,SAAS,UAAU;AAC5B,eAAW,MAAM,KAAK,GAAG,QAAQ,UAAU;AAC3C,eAAW,UAAU,QAAQ;cACpB,SAAS,UAAU;AAC5B,eAAW,MAAM,KAAK,GAAG,QAAQ,UAAU;AAC3C,eAAW,UAAU,QAAQ;;GAGjC,MAAM,YAAY,WAAW,MAAM;AACnC,QAAK,cAAc,CAAC,WAAW;AAC/B,iBAAc,YAAY,KAAK;AAC/B,QAAK,iBAAiB;AACtB,mBAAgB,YAAY,KAAK;AACjC,QAAK,mBAAmB;AACxB,oBAAiB,YAAY,KAAK;AAClC,QAAK,gBAAgB;AACrB,QAAK,gBAAgB;AACrB,oBAAiB,YAAY,KAAK;AAClC,QAAK,gBAAgB;AACrB,QAAK,gBAAgB;AACrB,QAAK,kBAAkB;AACvB,QAAK,oBAAoB;SACpB;AACL,QAAK,kBAAkB;AACvB,QAAK,oBAAoB;AACzB,QAAK,iBAAiB;AACtB,QAAK,iBAAiB;;;AAG1B,QAAO"}