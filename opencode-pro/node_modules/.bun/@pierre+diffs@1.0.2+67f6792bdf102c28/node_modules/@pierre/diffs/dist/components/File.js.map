{"version":3,"file":"File.js","names":["options: FileOptions<LAnnotation>","workerManager?: WorkerPoolManager | undefined","error: unknown"],"sources":["../../src/components/File.ts"],"sourcesContent":["import type { Element as HASTElement } from 'hast';\nimport { toHtml } from 'hast-util-to-html';\n\nimport {\n  DEFAULT_THEMES,\n  DIFFS_TAG_NAME,\n  HEADER_METADATA_SLOT_ID,\n  UNSAFE_CSS_ATTRIBUTE,\n} from '../constants';\nimport {\n  LineSelectionManager,\n  type LineSelectionOptions,\n  type SelectedLineRange,\n  pluckLineSelectionOptions,\n} from '../managers/LineSelectionManager';\nimport {\n  type GetHoveredLineResult,\n  MouseEventManager,\n  type MouseEventManagerBaseOptions,\n  pluckMouseEventOptions,\n} from '../managers/MouseEventManager';\nimport { ResizeManager } from '../managers/ResizeManager';\nimport { type FileRenderResult, FileRenderer } from '../renderers/FileRenderer';\nimport { SVGSpriteSheet } from '../sprite';\nimport type {\n  BaseCodeOptions,\n  FileContents,\n  LineAnnotation,\n  RenderFileMetadata,\n  ThemeTypes,\n} from '../types';\nimport { areFilesEqual } from '../utils/areFilesEqual';\nimport { createAnnotationWrapperNode } from '../utils/createAnnotationWrapperNode';\nimport { createCodeNode } from '../utils/createCodeNode';\nimport { createHoverContentNode } from '../utils/createHoverContentNode';\nimport { createUnsafeCSSStyleNode } from '../utils/createUnsafeCSSStyleNode';\nimport { wrapUnsafeCSS } from '../utils/cssWrappers';\nimport { getLineAnnotationName } from '../utils/getLineAnnotationName';\nimport { prerenderHTMLIfNecessary } from '../utils/prerenderHTMLIfNecessary';\nimport { setPreNodeProperties } from '../utils/setWrapperNodeProps';\nimport type { WorkerPoolManager } from '../worker';\nimport { DiffsContainerLoaded } from './web-components';\n\nexport interface FileRenderProps<LAnnotation> {\n  file: FileContents;\n  fileContainer?: HTMLElement;\n  containerWrapper?: HTMLElement;\n  forceRender?: boolean;\n  lineAnnotations?: LineAnnotation<LAnnotation>[];\n}\n\nexport interface FileHyrdateProps<LAnnotation>\n  extends Omit<FileRenderProps<LAnnotation>, 'fileContainer'> {\n  fileContainer: HTMLElement;\n  prerenderedHTML?: string;\n}\n\nexport interface FileOptions<LAnnotation>\n  extends BaseCodeOptions,\n    MouseEventManagerBaseOptions<'file'>,\n    LineSelectionOptions {\n  disableFileHeader?: boolean;\n  renderCustomMetadata?: RenderFileMetadata;\n  renderAnnotation?(\n    annotation: LineAnnotation<LAnnotation>\n  ): HTMLElement | undefined;\n  renderHoverUtility?(\n    getHoveredRow: () => GetHoveredLineResult<'file'> | undefined\n  ): HTMLElement | null;\n}\n\nlet instanceId = -1;\n\nexport class File<LAnnotation = undefined> {\n  static LoadedCustomComponent: boolean = DiffsContainerLoaded;\n\n  readonly __id: number = ++instanceId;\n  private fileContainer: HTMLElement | undefined;\n  private spriteSVG: SVGElement | undefined;\n  private pre: HTMLPreElement | undefined;\n  private code: HTMLElement | undefined;\n  private unsafeCSSStyle: HTMLStyleElement | undefined;\n  private hoverContent: HTMLElement | undefined;\n  private errorWrapper: HTMLElement | undefined;\n\n  private headerElement: HTMLElement | undefined;\n  private headerMetadata: HTMLElement | undefined;\n\n  private fileRenderer: FileRenderer<LAnnotation>;\n  private resizeManager: ResizeManager;\n  private mouseEventManager: MouseEventManager<'file'>;\n  private lineSelectionManager: LineSelectionManager;\n\n  private annotationElements: HTMLElement[] = [];\n  private lineAnnotations: LineAnnotation<LAnnotation>[] = [];\n\n  private file: FileContents | undefined;\n\n  constructor(\n    public options: FileOptions<LAnnotation> = { theme: DEFAULT_THEMES },\n    private workerManager?: WorkerPoolManager | undefined,\n    private isContainerManaged = false\n  ) {\n    this.fileRenderer = new FileRenderer<LAnnotation>(\n      options,\n      this.handleHighlightRender,\n      this.workerManager\n    );\n    this.resizeManager = new ResizeManager();\n    this.mouseEventManager = new MouseEventManager(\n      'file',\n      pluckMouseEventOptions(options)\n    );\n    this.lineSelectionManager = new LineSelectionManager(\n      pluckLineSelectionOptions(options)\n    );\n    this.workerManager?.subscribeToThemeChanges(this);\n  }\n\n  private handleHighlightRender = (): void => {\n    this.rerender();\n  };\n\n  rerender(): void {\n    if (this.file == null) return;\n    this.render({ file: this.file, forceRender: true });\n  }\n\n  setOptions(options: FileOptions<LAnnotation> | undefined): void {\n    if (options == null) return;\n    this.options = options;\n    this.mouseEventManager.setOptions(pluckMouseEventOptions(options));\n    this.lineSelectionManager.setOptions(pluckLineSelectionOptions(options));\n  }\n\n  private mergeOptions(options: Partial<FileOptions<LAnnotation>>): void {\n    this.options = { ...this.options, ...options };\n  }\n\n  setThemeType(themeType: ThemeTypes): void {\n    const currentThemeType = this.options.themeType ?? 'system';\n    if (currentThemeType === themeType) {\n      return;\n    }\n    this.mergeOptions({ themeType });\n    this.fileRenderer.setThemeType(themeType);\n\n    if (this.headerElement != null) {\n      if (themeType === 'system') {\n        delete this.headerElement.dataset.themeType;\n      } else {\n        this.headerElement.dataset.themeType = themeType;\n      }\n    }\n\n    // Update pre element theme mode\n    if (this.pre != null) {\n      switch (themeType) {\n        case 'system':\n          delete this.pre.dataset.themeType;\n          break;\n        case 'light':\n        case 'dark':\n          this.pre.dataset.themeType = themeType;\n          break;\n      }\n    }\n  }\n\n  getHoveredLine = (): GetHoveredLineResult<'file'> | undefined => {\n    return this.mouseEventManager.getHoveredLine();\n  };\n\n  setLineAnnotations(lineAnnotations: LineAnnotation<LAnnotation>[]): void {\n    this.lineAnnotations = lineAnnotations;\n  }\n\n  setSelectedLines(range: SelectedLineRange | null): void {\n    this.lineSelectionManager.setSelection(range);\n  }\n\n  cleanUp(): void {\n    this.fileRenderer.cleanUp();\n    this.resizeManager.cleanUp();\n    this.mouseEventManager.cleanUp();\n    this.lineSelectionManager.cleanUp();\n    this.workerManager?.unsubscribeToThemeChanges(this);\n    this.workerManager = undefined;\n\n    // Clean up the data\n    this.file = undefined;\n\n    // Clean up the elements\n    if (!this.isContainerManaged) {\n      this.fileContainer?.parentNode?.removeChild(this.fileContainer);\n    }\n    if (this.fileContainer?.shadowRoot != null) {\n      this.fileContainer.shadowRoot.innerHTML = '';\n    }\n    this.fileContainer = undefined;\n    this.pre = undefined;\n    this.headerElement = undefined;\n    this.errorWrapper = undefined;\n    this.unsafeCSSStyle = undefined;\n  }\n\n  hydrate(props: FileHyrdateProps<LAnnotation>): void {\n    const { fileContainer, prerenderedHTML } = props;\n    prerenderHTMLIfNecessary(fileContainer, prerenderedHTML);\n    for (const element of Array.from(\n      fileContainer.shadowRoot?.children ?? []\n    )) {\n      if (element instanceof SVGElement) {\n        this.spriteSVG = element;\n        continue;\n      }\n      if (!(element instanceof HTMLElement)) {\n        continue;\n      }\n      if (element instanceof HTMLPreElement) {\n        this.pre = element;\n        continue;\n      }\n      if (\n        element instanceof HTMLStyleElement &&\n        element.hasAttribute(UNSAFE_CSS_ATTRIBUTE)\n      ) {\n        this.unsafeCSSStyle = element;\n        continue;\n      }\n      if ('diffsHeader' in element.dataset) {\n        this.headerElement = element;\n        continue;\n      }\n    }\n    // If we have no pre tag, then we should render\n    if (this.pre == null) {\n      this.render(props);\n    }\n    // Otherwise orchestrate our setup\n    else {\n      const { file, lineAnnotations } = props;\n      this.fileContainer = fileContainer;\n      delete this.pre.dataset.dehydrated;\n\n      this.lineAnnotations = lineAnnotations ?? this.lineAnnotations;\n      this.file = file;\n      this.fileRenderer.hydrate(file);\n      this.renderAnnotations();\n      this.renderHoverUtility();\n      this.injectUnsafeCSS();\n      this.mouseEventManager.setup(this.pre);\n      this.lineSelectionManager.setup(this.pre);\n      if ((this.options.overflow ?? 'scroll') === 'scroll') {\n        this.resizeManager.setup(this.pre);\n      }\n    }\n  }\n\n  render({\n    file,\n    fileContainer,\n    forceRender = false,\n    containerWrapper,\n    lineAnnotations,\n  }: FileRenderProps<LAnnotation>): void {\n    const annotationsChanged =\n      lineAnnotations != null &&\n      (lineAnnotations.length > 0 || this.lineAnnotations.length > 0)\n        ? lineAnnotations !== this.lineAnnotations\n        : false;\n    if (!forceRender && areFilesEqual(this.file, file) && !annotationsChanged) {\n      return;\n    }\n\n    this.file = file;\n    this.fileRenderer.setOptions(this.options);\n    if (lineAnnotations != null) {\n      this.setLineAnnotations(lineAnnotations);\n    }\n    this.fileRenderer.setLineAnnotations(this.lineAnnotations);\n\n    const { disableFileHeader = false } = this.options;\n    if (disableFileHeader) {\n      // Remove existing header from DOM\n      if (this.headerElement != null) {\n        this.headerElement.parentNode?.removeChild(this.headerElement);\n        this.headerElement = undefined;\n      }\n    }\n\n    fileContainer = this.getOrCreateFileContainerNode(\n      fileContainer,\n      containerWrapper\n    );\n\n    try {\n      const fileResult = this.fileRenderer.renderFile(file);\n      if (fileResult == null) {\n        if (this.workerManager != null && !this.workerManager.isInitialized()) {\n          void this.workerManager.initialize().then(() => this.rerender());\n        }\n        return;\n      }\n      if (fileResult.headerAST != null) {\n        this.applyHeaderToDOM(fileResult.headerAST, fileContainer);\n      }\n      const pre = this.getOrCreatePreNode(fileContainer);\n      this.applyHunksToDOM(fileResult, pre);\n      this.renderAnnotations();\n      this.renderHoverUtility();\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        this.applyErrorToDOM(error, fileContainer);\n      }\n    }\n  }\n\n  private renderAnnotations(): void {\n    if (this.isContainerManaged || this.fileContainer == null) {\n      return;\n    }\n    // Handle annotation elements\n    for (const element of this.annotationElements) {\n      element.parentNode?.removeChild(element);\n    }\n    this.annotationElements.length = 0;\n\n    const { renderAnnotation } = this.options;\n    if (renderAnnotation != null && this.lineAnnotations.length > 0) {\n      for (const annotation of this.lineAnnotations) {\n        const content = renderAnnotation(annotation);\n        if (content == null) continue;\n        const el = createAnnotationWrapperNode(\n          getLineAnnotationName(annotation)\n        );\n        el.appendChild(content);\n        this.annotationElements.push(el);\n        this.fileContainer.appendChild(el);\n      }\n    }\n  }\n\n  private renderHoverUtility() {\n    const { renderHoverUtility } = this.options;\n    if (this.fileContainer == null || renderHoverUtility == null) return;\n    if (this.hoverContent == null) {\n      this.hoverContent = createHoverContentNode();\n      this.fileContainer.appendChild(this.hoverContent);\n    }\n    const element = renderHoverUtility(this.mouseEventManager.getHoveredLine);\n    this.hoverContent.innerHTML = '';\n    if (element != null) {\n      this.hoverContent.appendChild(element);\n    }\n  }\n\n  private injectUnsafeCSS(): void {\n    if (this.fileContainer?.shadowRoot == null) {\n      return;\n    }\n    const { unsafeCSS } = this.options;\n\n    if (unsafeCSS == null || unsafeCSS === '') {\n      if (this.unsafeCSSStyle != null) {\n        this.unsafeCSSStyle.parentNode?.removeChild(this.unsafeCSSStyle);\n        this.unsafeCSSStyle = undefined;\n      }\n      return;\n    }\n\n    // Create or update the style element\n    if (this.unsafeCSSStyle == null) {\n      this.unsafeCSSStyle = createUnsafeCSSStyleNode();\n      this.fileContainer.shadowRoot.appendChild(this.unsafeCSSStyle);\n    }\n    // Wrap in @layer unsafe to match SSR behavior\n    this.unsafeCSSStyle.innerText = wrapUnsafeCSS(unsafeCSS);\n  }\n\n  private applyHunksToDOM(result: FileRenderResult, pre: HTMLPreElement): void {\n    this.cleanupErrorWrapper();\n    this.applyPreNodeAttributes(pre, result);\n    pre.innerHTML = '';\n    // Create code elements and insert HTML content\n    this.code = createCodeNode();\n    this.code.innerHTML = this.fileRenderer.renderPartialHTML(result.codeAST);\n    pre.appendChild(this.code);\n    this.injectUnsafeCSS();\n    this.mouseEventManager.setup(pre);\n    this.lineSelectionManager.setup(pre);\n    this.lineSelectionManager.setDirty();\n    if ((this.options.overflow ?? 'scroll') === 'scroll') {\n      this.resizeManager.setup(pre);\n    } else {\n      this.resizeManager.cleanUp();\n    }\n  }\n\n  private applyHeaderToDOM(\n    headerAST: HASTElement,\n    container: HTMLElement\n  ): void {\n    const { file } = this;\n    if (file == null) return;\n    this.cleanupErrorWrapper();\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = toHtml(headerAST);\n    const newHeader = tempDiv.firstElementChild;\n    if (!(newHeader instanceof HTMLElement)) {\n      return;\n    }\n    if (this.headerElement != null) {\n      container.shadowRoot?.replaceChild(newHeader, this.headerElement);\n    } else {\n      container.shadowRoot?.prepend(newHeader);\n    }\n    this.headerElement = newHeader;\n\n    if (this.isContainerManaged) return;\n\n    const { renderCustomMetadata } = this.options;\n    if (this.headerMetadata != null) {\n      this.headerMetadata.parentNode?.removeChild(this.headerMetadata);\n    }\n    const content = renderCustomMetadata?.(file) ?? undefined;\n    if (content != null) {\n      this.headerMetadata = document.createElement('div');\n      this.headerMetadata.slot = HEADER_METADATA_SLOT_ID;\n      if (content instanceof Element) {\n        this.headerMetadata.appendChild(content);\n      } else {\n        this.headerMetadata.innerText = `${content}`;\n      }\n      container.appendChild(this.headerMetadata);\n    }\n  }\n\n  private getOrCreateFileContainerNode(\n    fileContainer?: HTMLElement,\n    parentNode?: HTMLElement\n  ): HTMLElement {\n    this.fileContainer =\n      fileContainer ??\n      this.fileContainer ??\n      document.createElement(DIFFS_TAG_NAME);\n    if (parentNode != null && this.fileContainer.parentNode !== parentNode) {\n      parentNode.appendChild(this.fileContainer);\n    }\n    if (this.spriteSVG == null) {\n      const fragment = document.createElement('div');\n      fragment.innerHTML = SVGSpriteSheet;\n      const firstChild = fragment.firstChild;\n      if (firstChild instanceof SVGElement) {\n        this.spriteSVG = firstChild;\n        this.fileContainer.shadowRoot?.appendChild(this.spriteSVG);\n      }\n    }\n    return this.fileContainer;\n  }\n\n  private getOrCreatePreNode(container: HTMLElement): HTMLPreElement {\n    // If we haven't created a pre element yet, lets go ahead and do that\n    if (this.pre == null) {\n      this.pre = document.createElement('pre');\n      container.shadowRoot?.appendChild(this.pre);\n    }\n    // If we have a new parent container for the pre element, lets go ahead and\n    // move it into the new container\n    else if (this.pre.parentNode !== container) {\n      container.shadowRoot?.appendChild(this.pre);\n    }\n    return this.pre;\n  }\n\n  private applyPreNodeAttributes(\n    pre: HTMLPreElement,\n    { totalLines, themeStyles, baseThemeType }: FileRenderResult\n  ): void {\n    const {\n      overflow = 'scroll',\n      themeType = 'system',\n      disableLineNumbers = false,\n    } = this.options;\n    setPreNodeProperties({\n      pre,\n      split: false,\n      themeStyles,\n      overflow,\n      disableLineNumbers,\n      themeType: baseThemeType ?? themeType,\n      diffIndicators: 'none',\n      disableBackground: true,\n      totalLines,\n    });\n  }\n\n  private applyErrorToDOM(error: Error, container: HTMLElement) {\n    this.cleanupErrorWrapper();\n    const pre = this.getOrCreatePreNode(container);\n    pre.innerHTML = '';\n    pre.parentNode?.removeChild(pre);\n    this.pre = undefined;\n    const shadowRoot =\n      container.shadowRoot ?? container.attachShadow({ mode: 'open' });\n    this.errorWrapper ??= document.createElement('div');\n    this.errorWrapper.dataset.errorWrapper = '';\n    this.errorWrapper.innerHTML = '';\n    shadowRoot.appendChild(this.errorWrapper);\n    const errorMessage = document.createElement('div');\n    errorMessage.dataset.errorMessage = '';\n    errorMessage.innerText = error.message;\n    this.errorWrapper.appendChild(errorMessage);\n    const errorStack = document.createElement('pre');\n    errorStack.dataset.errorStack = '';\n    errorStack.innerText = error.stack ?? 'No Error Stack';\n    this.errorWrapper.appendChild(errorStack);\n  }\n\n  private cleanupErrorWrapper() {\n    this.errorWrapper?.parentNode?.removeChild(this.errorWrapper);\n    this.errorWrapper = undefined;\n  }\n}\n"],"mappings":"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"}