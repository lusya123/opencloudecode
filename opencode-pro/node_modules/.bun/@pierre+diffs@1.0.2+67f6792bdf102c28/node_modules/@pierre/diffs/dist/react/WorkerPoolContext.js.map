{"version":3,"file":"WorkerPoolContext.js","names":["WorkerPoolContext: Context<WorkerPoolManager | undefined>"],"sources":["../../src/react/WorkerPoolContext.tsx"],"sourcesContent":["'use client';\n\nimport {\n  type Context,\n  type ReactNode,\n  createContext,\n  useContext,\n  useEffect,\n  useInsertionEffect,\n  useState,\n} from 'react';\n\nimport {\n  type SetupWorkerPoolProps,\n  type WorkerInitializationRenderOptions,\n  type WorkerPoolManager,\n  type WorkerPoolOptions,\n  getOrCreateWorkerPoolSingleton,\n  terminateWorkerPoolSingleton,\n} from '../worker';\n\nexport type { WorkerPoolOptions, WorkerInitializationRenderOptions };\n\nexport const WorkerPoolContext: Context<WorkerPoolManager | undefined> =\n  createContext<WorkerPoolManager | undefined>(undefined);\n\nlet instanceCount = 0;\n\ninterface WorkerPoolContextProps extends SetupWorkerPoolProps {\n  children: ReactNode;\n}\n\nexport function WorkerPoolContextProvider({\n  children,\n  poolOptions,\n  highlighterOptions,\n}: WorkerPoolContextProps): React.JSX.Element {\n  const [poolManager] = useState(() => {\n    if (typeof window === 'undefined') {\n      return undefined;\n    }\n    return getOrCreateWorkerPoolSingleton({\n      poolOptions,\n      highlighterOptions,\n    });\n  });\n  // We use insertion effect for the instance counting to essentially debounce\n  // potentially conflicting mount/unmounts\n  useInsertionEffect(() => {\n    instanceCount++;\n    return () => {\n      instanceCount--;\n    };\n  }, []);\n  useEffect(() => {\n    return () => {\n      if (instanceCount === 0) {\n        terminateWorkerPoolSingleton();\n      }\n    };\n  }, []);\n  return (\n    <WorkerPoolContext.Provider value={poolManager}>\n      {children}\n    </WorkerPoolContext.Provider>\n  );\n}\n\nexport function useWorkerPool(): WorkerPoolManager | undefined {\n  return useContext(WorkerPoolContext);\n}\n"],"mappings":";;;;;;;;AAuBA,MAAaA,oBACX,cAA6C,OAAU;AAEzD,IAAI,gBAAgB;AAMpB,SAAgB,0BAA0B,EACxC,UACA,aACA,sBAC4C;CAC5C,MAAM,CAAC,eAAe,eAAe;AACnC,MAAI,OAAO,WAAW,YACpB;AAEF,SAAO,+BAA+B;GACpC;GACA;GACD,CAAC;GACF;AAGF,0BAAyB;AACvB;AACA,eAAa;AACX;;IAED,EAAE,CAAC;AACN,iBAAgB;AACd,eAAa;AACX,OAAI,kBAAkB,EACpB,+BAA8B;;IAGjC,EAAE,CAAC;AACN,QACE,oBAAC,kBAAkB;EAAS,OAAO;EAChC;GAC0B;;AAIjC,SAAgB,gBAA+C;AAC7D,QAAO,WAAW,kBAAkB"}