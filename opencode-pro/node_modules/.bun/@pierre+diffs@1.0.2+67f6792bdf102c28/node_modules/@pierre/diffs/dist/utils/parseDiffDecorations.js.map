{"version":3,"file":"parseDiffDecorations.js","names":[],"sources":["../../src/utils/parseDiffDecorations.ts"],"sourcesContent":["import { type ChangeObject } from 'diff';\n\nimport type { DecorationItem } from '../types';\n\ninterface CreateDiffSpanDecorationProps {\n  line: number;\n  spanStart: number;\n  spanLength: number;\n}\n\nexport function createDiffSpanDecoration({\n  line,\n  spanStart,\n  spanLength,\n}: CreateDiffSpanDecorationProps): DecorationItem {\n  return {\n    start: { line, character: spanStart },\n    end: { line, character: spanStart + spanLength },\n    properties: { 'data-diff-span': '' },\n    alwaysWrap: true,\n  };\n}\n\ninterface PushOrJoinSpanProps {\n  item: ChangeObject<string>;\n  arr: [0 | 1, string][];\n  enableJoin: boolean;\n  isNeutral?: boolean;\n  isLastItem?: boolean;\n}\n\n// For diff decoration spans, we want to be sure that if there is a single\n// white-space gap between diffs that we join them together into a longer diff span.\n// Spans are basically just a tuple - 1 means the content should be\n// highlighted, 0 means it should not, we still need to the span data to figure\n// out span positions\nexport function pushOrJoinSpan({\n  item,\n  arr,\n  enableJoin,\n  isNeutral = false,\n  isLastItem = false,\n}: PushOrJoinSpanProps): void {\n  const lastItem = arr[arr.length - 1];\n  if (lastItem == null || isLastItem || !enableJoin) {\n    arr.push([isNeutral ? 0 : 1, item.value]);\n    return;\n  }\n  const isLastItemNeutral = lastItem[0] === 0;\n  if (\n    isNeutral === isLastItemNeutral ||\n    // If we have a single space neutral item, lets join it to a previous\n    // space non-neutral item to avoid single space gaps\n    (isNeutral && item.value.length === 1 && !isLastItemNeutral)\n  ) {\n    lastItem[1] += item.value;\n    return;\n  }\n  arr.push([isNeutral ? 0 : 1, item.value]);\n}\n"],"mappings":";;;AAUA,SAAgB,yBAAyB,EACvC,MACA,WACA,cACgD;AAChD,QAAO;EACL,OAAO;GAAE;GAAM,WAAW;GAAW;EACrC,KAAK;GAAE;GAAM,WAAW,YAAY;GAAY;EAChD,YAAY,EAAE,kBAAkB,IAAI;EACpC,YAAY;EACb;;AAgBH,SAAgB,eAAe,EAC7B,MACA,KACA,YACA,YAAY,OACZ,aAAa,SACe;CAC5B,MAAM,WAAW,IAAI,IAAI,SAAS;AAClC,KAAI,YAAY,QAAQ,cAAc,CAAC,YAAY;AACjD,MAAI,KAAK,CAAC,YAAY,IAAI,GAAG,KAAK,MAAM,CAAC;AACzC;;CAEF,MAAM,oBAAoB,SAAS,OAAO;AAC1C,KACE,cAAc,qBAGb,aAAa,KAAK,MAAM,WAAW,KAAK,CAAC,mBAC1C;AACA,WAAS,MAAM,KAAK;AACpB;;AAEF,KAAI,KAAK,CAAC,YAAY,IAAI,GAAG,KAAK,MAAM,CAAC"}