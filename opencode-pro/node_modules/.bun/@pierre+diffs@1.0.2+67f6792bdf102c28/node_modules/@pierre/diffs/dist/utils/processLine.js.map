{"version":3,"file":"processLine.js","names":[],"sources":["../../src/utils/processLine.ts"],"sourcesContent":["import type { ElementContent, Element as HASTElement } from 'hast';\n\nimport type { SharedRenderState } from '../types';\nimport { createHastElement, createTextNodeElement } from './hast_utils';\n\nexport function processLine(\n  node: HASTElement,\n  line: number,\n  state: SharedRenderState\n): ElementContent {\n  const lineInfo =\n    typeof state.lineInfo === 'function'\n      ? state.lineInfo(line)\n      : state.lineInfo[line];\n  if (lineInfo == null) {\n    console.error({ node, line, state });\n    throw new Error(`processLine: line ${line}, contains no state.lineInfo`);\n  }\n  // We need to convert the current line to a div but keep all the decorations\n  // that may be applied\n  node.tagName = 'span';\n  node.properties['data-column-content'] = '';\n\n  // NOTE(amadeus): We need to push newline characters into empty rows or else\n  // copy/pasta will have issues\n  if (node.children.length === 0) {\n    node.children.push(createTextNodeElement('\\n'));\n  }\n  const children = [\n    createHastElement({\n      tagName: 'span',\n      children: [\n        createHastElement({\n          tagName: 'span',\n          children: [{ type: 'text', value: `${lineInfo.lineNumber}` }],\n          properties: { 'data-line-number-content': '' },\n        }),\n      ],\n      properties: { 'data-column-number': '' },\n    }),\n    node,\n  ];\n  return createHastElement({\n    tagName: 'div',\n    children,\n    properties: {\n      'data-line': lineInfo.lineNumber,\n      'data-alt-line': lineInfo.altLineNumber,\n      'data-line-type': lineInfo.type,\n      'data-line-index': lineInfo.lineIndex,\n    },\n  });\n}\n"],"mappings":";;;AAKA,SAAgB,YACd,MACA,MACA,OACgB;CAChB,MAAM,WACJ,OAAO,MAAM,aAAa,aACtB,MAAM,SAAS,KAAK,GACpB,MAAM,SAAS;AACrB,KAAI,YAAY,MAAM;AACpB,UAAQ,MAAM;GAAE;GAAM;GAAM;GAAO,CAAC;AACpC,QAAM,IAAI,MAAM,qBAAqB,KAAK,8BAA8B;;AAI1E,MAAK,UAAU;AACf,MAAK,WAAW,yBAAyB;AAIzC,KAAI,KAAK,SAAS,WAAW,EAC3B,MAAK,SAAS,KAAK,sBAAsB,KAAK,CAAC;AAgBjD,QAAO,kBAAkB;EACvB,SAAS;EACT,UAhBe,CACf,kBAAkB;GAChB,SAAS;GACT,UAAU,CACR,kBAAkB;IAChB,SAAS;IACT,UAAU,CAAC;KAAE,MAAM;KAAQ,OAAO,GAAG,SAAS;KAAc,CAAC;IAC7D,YAAY,EAAE,4BAA4B,IAAI;IAC/C,CAAC,CACH;GACD,YAAY,EAAE,sBAAsB,IAAI;GACzC,CAAC,EACF,KACD;EAIC,YAAY;GACV,aAAa,SAAS;GACtB,iBAAiB,SAAS;GAC1B,kBAAkB,SAAS;GAC3B,mBAAmB,SAAS;GAC7B;EACF,CAAC"}