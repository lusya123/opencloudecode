{"version":3,"file":"renderFileWithHighlighter.js","names":["hastConfig: CodeToHastOptions<DiffsThemeNames>"],"sources":["../../src/utils/renderFileWithHighlighter.ts"],"sourcesContent":["import { DEFAULT_THEMES } from '../constants';\nimport type {\n  CodeToHastOptions,\n  DiffsHighlighter,\n  DiffsThemeNames,\n  FileContents,\n  RenderFileOptions,\n  ThemedFileResult,\n} from '../types';\nimport { cleanLastNewline } from './cleanLastNewline';\nimport { createTransformerWithState } from './createTransformerWithState';\nimport { formatCSSVariablePrefix } from './formatCSSVariablePrefix';\nimport { getFiletypeFromFileName } from './getFiletypeFromFileName';\nimport { getHighlighterThemeStyles } from './getHighlighterThemeStyles';\nimport { getLineNodes } from './getLineNodes';\n\nexport function renderFileWithHighlighter(\n  file: FileContents,\n  highlighter: DiffsHighlighter,\n  { theme = DEFAULT_THEMES, tokenizeMaxLineLength }: RenderFileOptions,\n  forcePlainText = false\n): ThemedFileResult {\n  const { state, transformers } = createTransformerWithState();\n  const lang = forcePlainText\n    ? 'text'\n    : (file.lang ?? getFiletypeFromFileName(file.name));\n  const baseThemeType = (() => {\n    if (typeof theme === 'string') {\n      return highlighter.getTheme(theme).type;\n    }\n    return undefined;\n  })();\n  const themeStyles = getHighlighterThemeStyles({\n    theme,\n    highlighter,\n  });\n  state.lineInfo = (shikiLineNumber: number) => ({\n    type: 'context',\n    lineIndex: shikiLineNumber - 1,\n    lineNumber: shikiLineNumber,\n  });\n  const hastConfig: CodeToHastOptions<DiffsThemeNames> = (() => {\n    if (typeof theme === 'string') {\n      return {\n        lang,\n        theme,\n        transformers,\n        defaultColor: false,\n        cssVariablePrefix: formatCSSVariablePrefix(),\n        tokenizeMaxLineLength,\n      };\n    }\n    return {\n      lang,\n      themes: theme,\n      transformers,\n      defaultColor: false,\n      cssVariablePrefix: formatCSSVariablePrefix(),\n      tokenizeMaxLineLength,\n    };\n  })();\n  return {\n    code: getLineNodes(\n      highlighter.codeToHast(cleanLastNewline(file.contents), hastConfig)\n    ),\n    themeStyles,\n    baseThemeType: baseThemeType,\n  };\n}\n"],"mappings":";;;;;;;;;AAgBA,SAAgB,0BACd,MACA,aACA,EAAE,QAAQ,gBAAgB,yBAC1B,iBAAiB,OACC;CAClB,MAAM,EAAE,OAAO,iBAAiB,4BAA4B;CAC5D,MAAM,OAAO,iBACT,SACC,KAAK,QAAQ,wBAAwB,KAAK,KAAK;CACpD,MAAM,uBAAuB;AAC3B,MAAI,OAAO,UAAU,SACnB,QAAO,YAAY,SAAS,MAAM,CAAC;KAGnC;CACJ,MAAM,cAAc,0BAA0B;EAC5C;EACA;EACD,CAAC;AACF,OAAM,YAAY,qBAA6B;EAC7C,MAAM;EACN,WAAW,kBAAkB;EAC7B,YAAY;EACb;CACD,MAAMA,oBAAwD;AAC5D,MAAI,OAAO,UAAU,SACnB,QAAO;GACL;GACA;GACA;GACA,cAAc;GACd,mBAAmB,yBAAyB;GAC5C;GACD;AAEH,SAAO;GACL;GACA,QAAQ;GACR;GACA,cAAc;GACd,mBAAmB,yBAAyB;GAC5C;GACD;KACC;AACJ,QAAO;EACL,MAAM,aACJ,YAAY,WAAW,iBAAiB,KAAK,SAAS,EAAE,WAAW,CACpE;EACD;EACe;EAChB"}