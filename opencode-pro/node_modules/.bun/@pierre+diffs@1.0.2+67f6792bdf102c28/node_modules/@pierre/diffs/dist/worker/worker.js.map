{"version":3,"file":"worker.js","names":["DEFAULT_THEMES: ThemesType","ResolvedLanguages: Map<SupportedLanguages, ResolvedLanguage>","AttachedLanguages: Set<string>","ResolvedThemes: Map<DiffsThemeNames, ThemeRegistrationResolved>","AttachedThemes: Set<string>","resolvedTheme: ThemeRegistrationResolved | undefined","firstChild: RootContent | HASTElement | Root | null","state: SharedRenderState","transformers: ShikiTransformer[]","children: ElementContent[]","tokenStyleNormalizer: ShikiTransformer","style: Record<string, string>","EXTENSION_TO_FILE_FORMAT: ExtensionFormatMap","highlighter","firstChild: RootContent | Element | Root | null","highlighter","hunks: RenderDiffFilesResult[]","deletionSpans: [0 | 1, string][]","additionSpans: [0 | 1, string][]","oldInfo: Record<number, LineInfo | undefined>","newInfo: Record<number, LineInfo | undefined>","oldDecorations: DecorationItem[]","newDecorations: DecorationItem[]","hastConfig: CodeToHastOptions<DiffsThemeNames>","highlighter","hastConfig: CodeToHastOptions<DiffsThemeNames>","highlighter: DiffsHighlighter | undefined","renderOptions: WorkerRenderingOptions","highlighter","response: RenderErrorResponse"],"sources":["../../src/constants.ts","../../src/highlighter/languages/constants.ts","../../src/highlighter/languages/attachResolvedLanguages.ts","../../src/highlighter/themes/constants.ts","../../src/highlighter/themes/attachResolvedThemes.ts","../../src/utils/cleanLastNewline.ts","../../src/utils/hast_utils.ts","../../src/utils/processLine.ts","../../src/utils/createTransformerWithState.ts","../../src/utils/formatCSSVariablePrefix.ts","../../src/utils/getFiletypeFromFileName.ts","../../src/utils/getHighlighterThemeStyles.ts","../../src/utils/getLineNodes.ts","../../src/utils/parseDiffDecorations.ts","../../src/utils/renderDiffWithHighlighter.ts","../../src/utils/renderFileWithHighlighter.ts","../../src/worker/worker.ts"],"sourcesContent":["import type { ThemesType } from './types';\n\nexport const DIFFS_TAG_NAME = 'diffs-container' as const;\n\n// Misc patch/content parsing regexes\nexport const COMMIT_METADATA_SPLIT: RegExp = /(?=^From [a-f0-9]+ .+$)/m;\nexport const GIT_DIFF_FILE_BREAK_REGEX: RegExp = /(?=^diff --git)/gm;\nexport const UNIFIED_DIFF_FILE_BREAK_REGEX: RegExp = /(?=^---\\s+\\S)/gm;\nexport const FILE_CONTEXT_BLOB: RegExp = /(?=^@@ )/gm;\nexport const HUNK_HEADER: RegExp =\n  /^@@ -(\\d+)(?:,(\\d+))? \\+(\\d+)(?:,(\\d+))? @@(?: (.*))?/m;\nexport const SPLIT_WITH_NEWLINES: RegExp = /(?<=\\n)/;\nexport const FILENAME_HEADER_REGEX: RegExp = /^(---|\\+\\+\\+)\\s+([^\\t\\r\\n]+)/;\nexport const FILENAME_HEADER_REGEX_GIT: RegExp =\n  /^(---|\\+\\+\\+)\\s+[ab]\\/([^\\t\\r\\n]+)/;\nexport const ALTERNATE_FILE_NAMES_GIT: RegExp =\n  /^diff --git (?:\"a\\/(.+?)\"|a\\/(.+?)) (?:\"b\\/(.+?)\"|b\\/(.+?))$/;\nexport const FILE_MODE_FROM_INDEX: RegExp =\n  /^index (?:[0-9a-f]+)\\.\\.(?:[0-9a-f]+)(?: (\\d+))?/;\n\nexport const HEADER_METADATA_SLOT_ID = 'header-metadata';\n\nexport const DEFAULT_THEMES: ThemesType = {\n  dark: 'pierre-dark',\n  light: 'pierre-light',\n};\n\nexport const UNSAFE_CSS_ATTRIBUTE = 'data-unsafe-css';\nexport const CORE_CSS_ATTRIBUTE = 'data-core-css';\n","import type { SupportedLanguages } from '../../types';\nimport type { ResolvedLanguage } from '../../worker';\n\nexport const ResolvedLanguages: Map<SupportedLanguages, ResolvedLanguage> =\n  new Map();\n\nexport const ResolvingLanguages: Map<\n  SupportedLanguages,\n  Promise<ResolvedLanguage>\n> = new Map();\n\nexport const AttachedLanguages: Set<string> = new Set();\n","import type { DiffsHighlighter } from '../../types';\nimport type { ResolvedLanguage } from '../../worker';\nimport { AttachedLanguages, ResolvedLanguages } from './constants';\n\nexport function attachResolvedLanguages(\n  resolvedLanguages: ResolvedLanguage | ResolvedLanguage[],\n  highlighter: DiffsHighlighter\n): void {\n  resolvedLanguages = Array.isArray(resolvedLanguages)\n    ? resolvedLanguages\n    : [resolvedLanguages];\n\n  for (const resolvedLang of resolvedLanguages) {\n    if (AttachedLanguages.has(resolvedLang.name)) continue;\n    let lang = ResolvedLanguages.get(resolvedLang.name);\n    if (lang == null) {\n      lang = resolvedLang;\n      ResolvedLanguages.set(resolvedLang.name, lang);\n    }\n    AttachedLanguages.add(lang.name);\n    highlighter.loadLanguageSync(lang.data);\n  }\n}\n","import type { ThemeRegistrationResolved } from 'shiki';\n\nimport type { DiffsThemeNames } from '../../types';\n\nexport const ResolvedThemes: Map<DiffsThemeNames, ThemeRegistrationResolved> =\n  new Map();\n\nexport const ResolvingThemes: Map<\n  DiffsThemeNames,\n  Promise<ThemeRegistrationResolved>\n> = new Map();\n\nexport const RegisteredCustomThemes: Map<\n  string,\n  () => Promise<ThemeRegistrationResolved>\n> = new Map();\n\nexport const AttachedThemes: Set<string> = new Set();\n","import type {\n  DiffsHighlighter,\n  DiffsThemeNames,\n  ThemeRegistrationResolved,\n} from '../../types';\nimport { AttachedThemes, ResolvedThemes } from './constants';\n\nexport function attachResolvedThemes(\n  themes:\n    | DiffsThemeNames\n    | ThemeRegistrationResolved\n    | (DiffsThemeNames | ThemeRegistrationResolved)[],\n  highlighter: DiffsHighlighter\n): void {\n  themes = Array.isArray(themes) ? themes : [themes];\n  for (let themeRef of themes) {\n    let resolvedTheme: ThemeRegistrationResolved | undefined;\n    if (typeof themeRef === 'string') {\n      resolvedTheme = ResolvedThemes.get(themeRef);\n      if (resolvedTheme == null) {\n        throw new Error(\n          `loadResolvedThemes: ${themeRef} is not resolved, you must resolve it before calling loadResolvedThemes`\n        );\n      }\n    } else {\n      resolvedTheme = themeRef;\n      themeRef = themeRef.name;\n      if (!ResolvedThemes.has(themeRef)) {\n        ResolvedThemes.set(themeRef, resolvedTheme);\n      }\n    }\n    if (AttachedThemes.has(themeRef)) continue;\n    AttachedThemes.add(themeRef);\n    highlighter.loadThemeSync(resolvedTheme);\n  }\n}\n","export function cleanLastNewline(contents: string): string {\n  return contents.replace(/\\n$|\\r\\n$/, '');\n}\n","import type {\n  ElementContent,\n  Element as HASTElement,\n  Properties,\n  Root,\n  RootContent,\n  Text,\n} from 'hast';\n\nimport type { SVGSpriteNames } from '../sprite';\n\nexport function createTextNodeElement(value: string): Text {\n  return { type: 'text', value };\n}\n\ninterface CreateHastElementProps {\n  tagName:\n    | 'span'\n    | 'div'\n    | 'code'\n    | 'pre'\n    | 'slot'\n    | 'svg'\n    | 'use'\n    | 'style'\n    | 'template';\n  children?: ElementContent[];\n  properties?: Properties;\n}\n\nexport function createHastElement({\n  tagName,\n  children = [],\n  properties = {},\n}: CreateHastElementProps): HASTElement {\n  return {\n    type: 'element',\n    tagName,\n    properties,\n    children,\n  };\n}\n\ninterface CreateIconProps {\n  name: SVGSpriteNames;\n  width?: number;\n  height?: number;\n  properties?: Properties;\n}\n\nexport function createIconElement({\n  name,\n  width = 16,\n  height = 16,\n  properties,\n}: CreateIconProps): HASTElement {\n  return createHastElement({\n    tagName: 'svg',\n    properties: { width, height, viewBox: '0 0 16 16', ...properties },\n    children: [\n      createHastElement({\n        tagName: 'use',\n        properties: { href: `#${name.replace(/^#/, '')}` },\n      }),\n    ],\n  });\n}\n\nexport function findCodeElement(\n  nodes: Root | HASTElement\n): HASTElement | undefined {\n  let firstChild: RootContent | HASTElement | Root | null = nodes.children[0];\n  while (firstChild != null) {\n    if (firstChild.type === 'element' && firstChild.tagName === 'code') {\n      return firstChild;\n    }\n    if ('children' in firstChild) {\n      firstChild = firstChild.children[0];\n    } else {\n      firstChild = null;\n    }\n  }\n  return undefined;\n}\n","import type { ElementContent, Element as HASTElement } from 'hast';\n\nimport type { SharedRenderState } from '../types';\nimport { createHastElement, createTextNodeElement } from './hast_utils';\n\nexport function processLine(\n  node: HASTElement,\n  line: number,\n  state: SharedRenderState\n): ElementContent {\n  const lineInfo =\n    typeof state.lineInfo === 'function'\n      ? state.lineInfo(line)\n      : state.lineInfo[line];\n  if (lineInfo == null) {\n    console.error({ node, line, state });\n    throw new Error(`processLine: line ${line}, contains no state.lineInfo`);\n  }\n  // We need to convert the current line to a div but keep all the decorations\n  // that may be applied\n  node.tagName = 'span';\n  node.properties['data-column-content'] = '';\n\n  // NOTE(amadeus): We need to push newline characters into empty rows or else\n  // copy/pasta will have issues\n  if (node.children.length === 0) {\n    node.children.push(createTextNodeElement('\\n'));\n  }\n  const children = [\n    createHastElement({\n      tagName: 'span',\n      children: [\n        createHastElement({\n          tagName: 'span',\n          children: [{ type: 'text', value: `${lineInfo.lineNumber}` }],\n          properties: { 'data-line-number-content': '' },\n        }),\n      ],\n      properties: { 'data-column-number': '' },\n    }),\n    node,\n  ];\n  return createHastElement({\n    tagName: 'div',\n    children,\n    properties: {\n      'data-line': lineInfo.lineNumber,\n      'data-alt-line': lineInfo.altLineNumber,\n      'data-line-type': lineInfo.type,\n      'data-line-index': lineInfo.lineIndex,\n    },\n  });\n}\n","import {\n  type ShikiTransformerStyleToClass,\n  transformerStyleToClass,\n} from '@shikijs/transformers';\nimport type { ElementContent } from 'hast';\n\nimport type { SharedRenderState, ShikiTransformer } from '../types';\nimport { findCodeElement } from './hast_utils';\nimport { processLine } from './processLine';\n\ninterface CreateTransformerWithStateReturn {\n  state: SharedRenderState;\n  transformers: ShikiTransformer[];\n  toClass: ShikiTransformerStyleToClass;\n}\n\nexport function createTransformerWithState(\n  useCSSClasses = false\n): CreateTransformerWithStateReturn {\n  const state: SharedRenderState = {\n    lineInfo: {},\n  };\n  const transformers: ShikiTransformer[] = [\n    {\n      line(node) {\n        // Remove the default class\n        delete node.properties.class;\n        return node;\n      },\n      pre(pre) {\n        const code = findCodeElement(pre);\n        const children: ElementContent[] = [];\n        if (code != null) {\n          let index = 1;\n          for (const node of code.children) {\n            if (node.type !== 'element') continue;\n            children.push(processLine(node, index, state));\n            index++;\n          }\n          code.children = children;\n        }\n        return pre;\n      },\n    },\n  ];\n  if (useCSSClasses) {\n    transformers.push(tokenStyleNormalizer, toClass);\n  }\n  return { state, transformers, toClass };\n}\n\nconst toClass = transformerStyleToClass({ classPrefix: 'hl-' });\n\n// Create a transformer that converts token color/fontStyle to htmlStyle\n// This needs to run BEFORE transformerStyleToClass\nconst tokenStyleNormalizer: ShikiTransformer = {\n  name: 'token-style-normalizer',\n  tokens(lines) {\n    for (const line of lines) {\n      for (const token of line) {\n        // Skip if htmlStyle is already set\n        if (token.htmlStyle != null) continue;\n\n        const style: Record<string, string> = {};\n\n        if (token.color != null) {\n          style.color = token.color;\n        }\n        if (token.bgColor != null) {\n          style['background-color'] = token.bgColor;\n        }\n        if (token.fontStyle != null && token.fontStyle !== 0) {\n          // FontStyle is a bitmask: 1 = italic, 2 = bold, 4 = underline\n          if ((token.fontStyle & 1) !== 0) {\n            style['font-style'] = 'italic';\n          }\n          if ((token.fontStyle & 2) !== 0) {\n            style['font-weight'] = 'bold';\n          }\n          if ((token.fontStyle & 4) !== 0) {\n            style['text-decoration'] = 'underline';\n          }\n        }\n\n        // Only set htmlStyle if we have any styles\n        if (Object.keys(style).length > 0) {\n          token.htmlStyle = style;\n        }\n      }\n    }\n  },\n};\n","export function formatCSSVariablePrefix(prefix: string = 'diffs') {\n  return `--${prefix}-`;\n}\n","import type { ExtensionFormatMap, SupportedLanguages } from '../types';\n\nexport const EXTENSION_TO_FILE_FORMAT: ExtensionFormatMap = {\n  '1c': '1c',\n  abap: 'abap',\n  as: 'actionscript-3',\n  ada: 'ada',\n  adb: 'ada',\n  ads: 'ada',\n  adoc: 'asciidoc',\n  asciidoc: 'asciidoc',\n  'component.html': 'angular-html',\n  'component.ts': 'angular-ts',\n  conf: 'nginx',\n  htaccess: 'apache',\n  cls: 'tex',\n  trigger: 'apex',\n  apl: 'apl',\n  applescript: 'applescript',\n  scpt: 'applescript',\n  ara: 'ara',\n  asm: 'asm',\n  s: 'riscv',\n  astro: 'astro',\n  awk: 'awk',\n  bal: 'ballerina',\n  sh: 'zsh',\n  bash: 'zsh',\n  bat: 'cmd',\n  cmd: 'cmd',\n  be: 'berry',\n  beancount: 'beancount',\n  bib: 'bibtex',\n  bicep: 'bicep',\n  'blade.php': 'blade',\n  bsl: 'bsl',\n  c: 'c',\n  h: 'objective-cpp',\n  cs: 'csharp',\n  cpp: 'cpp',\n  hpp: 'cpp',\n  cc: 'cpp',\n  cxx: 'cpp',\n  hh: 'cpp',\n  cdc: 'cdc',\n  cairo: 'cairo',\n  clar: 'clarity',\n  clj: 'clojure',\n  cljs: 'clojure',\n  cljc: 'clojure',\n  soy: 'soy',\n  cmake: 'cmake',\n  'CMakeLists.txt': 'cmake',\n  cob: 'cobol',\n  cbl: 'cobol',\n  cobol: 'cobol',\n  CODEOWNERS: 'codeowners',\n  ql: 'ql',\n  coffee: 'coffeescript',\n  lisp: 'lisp',\n  cl: 'lisp',\n  lsp: 'lisp',\n  log: 'log',\n  v: 'verilog',\n  cql: 'cql',\n  cr: 'crystal',\n  css: 'css',\n  csv: 'csv',\n  cue: 'cue',\n  cypher: 'cypher',\n  cyp: 'cypher',\n  d: 'd',\n  dart: 'dart',\n  dax: 'dax',\n  desktop: 'desktop',\n  diff: 'diff',\n  patch: 'diff',\n  Dockerfile: 'dockerfile',\n  dockerfile: 'dockerfile',\n  env: 'dotenv',\n  dm: 'dream-maker',\n  edge: 'edge',\n  el: 'emacs-lisp',\n  ex: 'elixir',\n  exs: 'elixir',\n  elm: 'elm',\n  erb: 'erb',\n  erl: 'erlang',\n  hrl: 'erlang',\n  f: 'fortran-fixed-form',\n  for: 'fortran-fixed-form',\n  fs: 'fsharp',\n  fsi: 'fsharp',\n  fsx: 'fsharp',\n  f03: 'f03',\n  f08: 'f08',\n  f18: 'f18',\n  f77: 'f77',\n  f90: 'fortran-free-form',\n  f95: 'fortran-free-form',\n  fnl: 'fennel',\n  fish: 'fish',\n  ftl: 'ftl',\n  tres: 'gdresource',\n  res: 'gdresource',\n  gd: 'gdscript',\n  gdshader: 'gdshader',\n  gs: 'genie',\n  feature: 'gherkin',\n  COMMIT_EDITMSG: 'git-commit',\n  'git-rebase-todo': 'git-rebase',\n  gjs: 'glimmer-js',\n  gleam: 'gleam',\n  gts: 'glimmer-ts',\n  glsl: 'glsl',\n  vert: 'glsl',\n  frag: 'glsl',\n  shader: 'shaderlab',\n  gp: 'gnuplot',\n  plt: 'gnuplot',\n  gnuplot: 'gnuplot',\n  go: 'go',\n  graphql: 'graphql',\n  gql: 'graphql',\n  groovy: 'groovy',\n  gvy: 'groovy',\n  hack: 'hack',\n  haml: 'haml',\n  hbs: 'handlebars',\n  handlebars: 'handlebars',\n  hs: 'haskell',\n  lhs: 'haskell',\n  hx: 'haxe',\n  hcl: 'hcl',\n  hjson: 'hjson',\n  hlsl: 'hlsl',\n  fx: 'hlsl',\n  html: 'html',\n  htm: 'html',\n  http: 'http',\n  rest: 'http',\n  hxml: 'hxml',\n  hy: 'hy',\n  imba: 'imba',\n  ini: 'ini',\n  cfg: 'ini',\n  jade: 'pug',\n  pug: 'pug',\n  java: 'java',\n  js: 'javascript',\n  mjs: 'javascript',\n  cjs: 'javascript',\n  jinja: 'jinja',\n  jinja2: 'jinja',\n  j2: 'jinja',\n  jison: 'jison',\n  jl: 'julia',\n  json: 'json',\n  json5: 'json5',\n  jsonc: 'jsonc',\n  jsonl: 'jsonl',\n  jsonnet: 'jsonnet',\n  libsonnet: 'jsonnet',\n  jssm: 'jssm',\n  jsx: 'jsx',\n  kt: 'kotlin',\n  kts: 'kts',\n  kql: 'kusto',\n  tex: 'tex',\n  ltx: 'tex',\n  lean: 'lean4',\n  less: 'less',\n  liquid: 'liquid',\n  lit: 'lit',\n  ll: 'llvm',\n  logo: 'logo',\n  lua: 'lua',\n  luau: 'luau',\n  Makefile: 'makefile',\n  mk: 'makefile',\n  makefile: 'makefile',\n  md: 'markdown',\n  markdown: 'markdown',\n  marko: 'marko',\n  m: 'wolfram',\n  mat: 'matlab',\n  mdc: 'mdc',\n  mdx: 'mdx',\n  wiki: 'wikitext',\n  mediawiki: 'wikitext',\n  mmd: 'mermaid',\n  mermaid: 'mermaid',\n  mips: 'mipsasm',\n  mojo: 'mojo',\n  'ðŸ”¥': 'mojo',\n  move: 'move',\n  nar: 'narrat',\n  nf: 'nextflow',\n  nim: 'nim',\n  nims: 'nim',\n  nimble: 'nim',\n  nix: 'nix',\n  nu: 'nushell',\n  mm: 'objective-cpp',\n  ml: 'ocaml',\n  mli: 'ocaml',\n  mll: 'ocaml',\n  mly: 'ocaml',\n  pas: 'pascal',\n  p: 'pascal',\n  pl: 'prolog',\n  pm: 'perl',\n  t: 'perl',\n  raku: 'raku',\n  p6: 'raku',\n  pl6: 'raku',\n  php: 'php',\n  phtml: 'php',\n  pls: 'plsql',\n  sql: 'sql',\n  po: 'po',\n  polar: 'polar',\n  pcss: 'postcss',\n  pot: 'pot',\n  potx: 'potx',\n  pq: 'powerquery',\n  pqm: 'powerquery',\n  ps1: 'powershell',\n  psm1: 'powershell',\n  psd1: 'powershell',\n  prisma: 'prisma',\n  pro: 'prolog',\n  P: 'prolog',\n  properties: 'properties',\n  proto: 'protobuf',\n  pp: 'puppet',\n  purs: 'purescript',\n  py: 'python',\n  pyw: 'python',\n  pyi: 'python',\n  qml: 'qml',\n  qmldir: 'qmldir',\n  qss: 'qss',\n  r: 'r',\n  R: 'r',\n  rkt: 'racket',\n  rktl: 'racket',\n  razor: 'razor',\n  cshtml: 'razor',\n  rb: 'ruby',\n  rbw: 'ruby',\n  reg: 'reg',\n  regex: 'regexp',\n  rel: 'rel',\n  rs: 'rust',\n  rst: 'rst',\n  rake: 'ruby',\n  gemspec: 'ruby',\n  sas: 'sas',\n  sass: 'sass',\n  scala: 'scala',\n  sc: 'scala',\n  scm: 'scheme',\n  ss: 'scheme',\n  sld: 'scheme',\n  scss: 'scss',\n  sdbl: 'sdbl',\n  shadergraph: 'shader',\n  st: 'smalltalk',\n  sol: 'solidity',\n  sparql: 'sparql',\n  rq: 'sparql',\n  spl: 'splunk',\n  config: 'ssh-config',\n  do: 'stata',\n  ado: 'stata',\n  dta: 'stata',\n  styl: 'stylus',\n  stylus: 'stylus',\n  svelte: 'svelte',\n  swift: 'swift',\n  sv: 'system-verilog',\n  svh: 'system-verilog',\n  service: 'systemd',\n  socket: 'systemd',\n  device: 'systemd',\n  timer: 'systemd',\n  talon: 'talonscript',\n  tasl: 'tasl',\n  tcl: 'tcl',\n  templ: 'templ',\n  tf: 'tf',\n  tfvars: 'tfvars',\n  toml: 'toml',\n  ts: 'typescript',\n  tsp: 'typespec',\n  tsv: 'tsv',\n  tsx: 'tsx',\n  ttl: 'turtle',\n  twig: 'twig',\n  typ: 'typst',\n  vv: 'v',\n  vala: 'vala',\n  vapi: 'vala',\n  vb: 'vb',\n  vbs: 'vb',\n  bas: 'vb',\n  vh: 'verilog',\n  vhd: 'vhdl',\n  vhdl: 'vhdl',\n  vim: 'vimscript',\n  vue: 'vue',\n  'vine.ts': 'vue-vine',\n  vy: 'vyper',\n  wasm: 'wasm',\n  wat: 'wasm',\n  wy: 'æ–‡è¨€',\n  wgsl: 'wgsl',\n  wit: 'wit',\n  wl: 'wolfram',\n  nb: 'wolfram',\n  xml: 'xml',\n  xsl: 'xsl',\n  xslt: 'xsl',\n  yaml: 'yaml',\n  yml: 'yml',\n  zs: 'zenscript',\n  zig: 'zig',\n  zsh: 'zsh',\n  sty: 'tex',\n};\n\nexport function getFiletypeFromFileName(fileName: string): SupportedLanguages {\n  // Handle special files without extensions first\n  if (EXTENSION_TO_FILE_FORMAT[fileName] != null) {\n    return EXTENSION_TO_FILE_FORMAT[fileName];\n  }\n\n  // Try compound extensions first (e.g., .blade.php, .component.ts)\n  const compoundMatch = fileName.match(/\\.([^/\\\\]+\\.[^/\\\\]+)$/);\n  if (\n    compoundMatch != null &&\n    EXTENSION_TO_FILE_FORMAT[compoundMatch[1]] != null\n  ) {\n    return EXTENSION_TO_FILE_FORMAT[compoundMatch[1]] ?? 'text';\n  }\n\n  // Fall back to simple extension\n  const simpleMatch = fileName.match(/\\.([^.]+)$/);\n  return EXTENSION_TO_FILE_FORMAT[simpleMatch?.[1] ?? ''] ?? 'text';\n}\n\nexport function extendFileFormatMap(map: ExtensionFormatMap): void {\n  for (const key in map) {\n    EXTENSION_TO_FILE_FORMAT[key] = map[key];\n  }\n}\n","import { DEFAULT_THEMES } from '../constants';\nimport type {\n  DiffsHighlighter,\n  DiffsThemeNames,\n  ThemeRegistrationResolved,\n  ThemesType,\n} from '../types';\nimport { formatCSSVariablePrefix } from './formatCSSVariablePrefix';\n\ninterface GetHighlighterThemeStylesProps {\n  theme?: DiffsThemeNames | ThemesType;\n  highlighter: DiffsHighlighter;\n  prefix?: string;\n}\n\n// FIXME(amadeus): We'll probably need to\n// re-think this when it comes to removing inline\n// styles\nexport function getHighlighterThemeStyles({\n  theme = DEFAULT_THEMES,\n  highlighter,\n  prefix,\n}: GetHighlighterThemeStylesProps): string {\n  let styles = '';\n  if (typeof theme === 'string') {\n    const themeData = highlighter.getTheme(theme);\n    styles += `color:${themeData.fg};`;\n    styles += `background-color:${themeData.bg};`;\n    styles += `${formatCSSVariablePrefix(prefix)}fg:${themeData.fg};`;\n    styles += `${formatCSSVariablePrefix(prefix)}bg:${themeData.bg};`;\n    styles += getThemeVariables(themeData, prefix);\n  } else {\n    let themeData = highlighter.getTheme(theme.dark);\n    styles += `${formatCSSVariablePrefix(prefix)}dark:${themeData.fg};`;\n    styles += `${formatCSSVariablePrefix(prefix)}dark-bg:${themeData.bg};`;\n    styles += getThemeVariables(themeData, prefix, 'dark');\n\n    themeData = highlighter.getTheme(theme.light);\n    styles += `${formatCSSVariablePrefix(prefix)}light:${themeData.fg};`;\n    styles += `${formatCSSVariablePrefix(prefix)}light-bg:${themeData.bg};`;\n    styles += getThemeVariables(themeData, prefix, 'light');\n  }\n  return styles;\n}\n\nfunction getThemeVariables(\n  themeData: ThemeRegistrationResolved,\n  prefix?: string,\n  modePrefix?: string\n) {\n  modePrefix = modePrefix != null ? `${modePrefix}-` : '';\n  let styles = '';\n  const additionGreen =\n    themeData.colors?.['gitDecoration.addedResourceForeground'] ??\n    themeData.colors?.['terminal.ansiGreen'];\n  if (additionGreen != null) {\n    styles += `${formatCSSVariablePrefix(prefix)}${modePrefix}addition-color:${additionGreen};`;\n  }\n  const deletionRed =\n    themeData.colors?.['gitDecoration.deletedResourceForeground'] ??\n    themeData.colors?.['terminal.ansiRed'];\n  if (deletionRed != null) {\n    styles += `${formatCSSVariablePrefix(prefix)}${modePrefix}deletion-color:${deletionRed};`;\n  }\n  const modifiedBlue =\n    themeData.colors?.['gitDecoration.modifiedResourceForeground'] ??\n    themeData.colors?.['terminal.ansiBlue'];\n  if (modifiedBlue != null) {\n    styles += `${formatCSSVariablePrefix(prefix)}${modePrefix}modified-color:${modifiedBlue};`;\n  }\n  return styles;\n}\n","import type { ElementContent, Root, RootContent } from 'hast';\n\nexport function getLineNodes(nodes: Root): ElementContent[] {\n  let firstChild: RootContent | Element | Root | null = nodes.children[0];\n  while (firstChild != null) {\n    if (firstChild.type === 'element' && firstChild.tagName === 'code') {\n      return firstChild.children;\n    }\n    if ('children' in firstChild) {\n      firstChild = firstChild.children[0];\n    } else {\n      firstChild = null;\n    }\n  }\n  console.error(nodes);\n  throw new Error('getLineNodes: Unable to find children');\n}\n","import { type ChangeObject } from 'diff';\n\nimport type { DecorationItem } from '../types';\n\ninterface CreateDiffSpanDecorationProps {\n  line: number;\n  spanStart: number;\n  spanLength: number;\n}\n\nexport function createDiffSpanDecoration({\n  line,\n  spanStart,\n  spanLength,\n}: CreateDiffSpanDecorationProps): DecorationItem {\n  return {\n    start: { line, character: spanStart },\n    end: { line, character: spanStart + spanLength },\n    properties: { 'data-diff-span': '' },\n    alwaysWrap: true,\n  };\n}\n\ninterface PushOrJoinSpanProps {\n  item: ChangeObject<string>;\n  arr: [0 | 1, string][];\n  enableJoin: boolean;\n  isNeutral?: boolean;\n  isLastItem?: boolean;\n}\n\n// For diff decoration spans, we want to be sure that if there is a single\n// white-space gap between diffs that we join them together into a longer diff span.\n// Spans are basically just a tuple - 1 means the content should be\n// highlighted, 0 means it should not, we still need to the span data to figure\n// out span positions\nexport function pushOrJoinSpan({\n  item,\n  arr,\n  enableJoin,\n  isNeutral = false,\n  isLastItem = false,\n}: PushOrJoinSpanProps): void {\n  const lastItem = arr[arr.length - 1];\n  if (lastItem == null || isLastItem || !enableJoin) {\n    arr.push([isNeutral ? 0 : 1, item.value]);\n    return;\n  }\n  const isLastItemNeutral = lastItem[0] === 0;\n  if (\n    isNeutral === isLastItemNeutral ||\n    // If we have a single space neutral item, lets join it to a previous\n    // space non-neutral item to avoid single space gaps\n    (isNeutral && item.value.length === 1 && !isLastItemNeutral)\n  ) {\n    lastItem[1] += item.value;\n    return;\n  }\n  arr.push([isNeutral ? 0 : 1, item.value]);\n}\n","import { diffChars, diffWordsWithSpace } from 'diff';\n\nimport { DEFAULT_THEMES } from '../constants';\nimport type {\n  CodeToHastOptions,\n  DecorationItem,\n  DiffsHighlighter,\n  DiffsThemeNames,\n  FileContents,\n  FileDiffMetadata,\n  Hunk,\n  LineDiffTypes,\n  LineInfo,\n  RenderDiffFilesResult,\n  RenderDiffOptions,\n  SupportedLanguages,\n  ThemedDiffResult,\n} from '../types';\nimport { cleanLastNewline } from './cleanLastNewline';\nimport { createTransformerWithState } from './createTransformerWithState';\nimport { formatCSSVariablePrefix } from './formatCSSVariablePrefix';\nimport { getFiletypeFromFileName } from './getFiletypeFromFileName';\nimport { getHighlighterThemeStyles } from './getHighlighterThemeStyles';\nimport { getLineNodes } from './getLineNodes';\nimport {\n  createDiffSpanDecoration,\n  pushOrJoinSpan,\n} from './parseDiffDecorations';\n\nexport function renderDiffWithHighlighter(\n  diff: FileDiffMetadata,\n  highlighter: DiffsHighlighter,\n  options: RenderDiffOptions,\n  forcePlainText = false\n): ThemedDiffResult {\n  const baseThemeType = (() => {\n    const theme = options.theme ?? DEFAULT_THEMES;\n    if (typeof theme === 'string') {\n      return highlighter.getTheme(theme).type;\n    }\n    return undefined;\n  })();\n  const themeStyles = getHighlighterThemeStyles({\n    theme: options.theme,\n    highlighter,\n  });\n  // If we've received a diff with both files\n  if (diff.newLines != null && diff.oldLines != null) {\n    const {\n      oldContent,\n      newContent,\n      oldInfo,\n      newInfo,\n      oldDecorations,\n      newDecorations,\n    } = processLines({\n      hunks: diff.hunks,\n      oldLines: diff.oldLines,\n      newLines: diff.newLines,\n      lineDiffType: options.lineDiffType,\n    });\n    const oldFile = {\n      name: diff.prevName ?? diff.name,\n      contents: oldContent,\n    };\n    const newFile = {\n      name: diff.name,\n      contents: newContent,\n    };\n    const code = renderTwoFiles({\n      oldFile,\n      oldInfo,\n      oldDecorations,\n\n      newFile,\n      newInfo,\n      newDecorations,\n\n      highlighter,\n      options,\n      languageOverride: forcePlainText ? 'text' : diff.lang,\n    });\n    return { code, themeStyles, baseThemeType };\n  }\n  const hunks: RenderDiffFilesResult[] = [];\n  let splitLineIndex = 0;\n  let unifiedLineIndex = 0;\n  for (const hunk of diff.hunks) {\n    const {\n      oldContent,\n      newContent,\n      oldInfo,\n      newInfo,\n      oldDecorations,\n      newDecorations,\n      splitLineIndex: newSplitLineIndex,\n      unifiedLineIndex: newUnifiedLineIndex,\n    } = processLines({\n      hunks: [hunk],\n      splitLineIndex,\n      unifiedLineIndex,\n      lineDiffType: options.lineDiffType,\n    });\n    const oldFile = {\n      name: diff.prevName ?? diff.name,\n      contents: oldContent,\n    };\n    const newFile = {\n      name: diff.name,\n      contents: newContent,\n    };\n    hunks.push(\n      renderTwoFiles({\n        oldFile,\n        oldInfo,\n        oldDecorations,\n\n        newFile,\n        newInfo,\n        newDecorations,\n\n        highlighter,\n        options,\n        languageOverride: forcePlainText ? 'text' : diff.lang,\n      })\n    );\n    splitLineIndex = newSplitLineIndex;\n    unifiedLineIndex = newUnifiedLineIndex;\n  }\n\n  const code = (() => {\n    if (hunks.length <= 1) {\n      const hunk = hunks[0] ?? { oldLines: [], newLines: [] };\n      if (hunk.newLines.length === 0 || hunk.oldLines.length === 0) {\n        return hunk;\n      }\n    }\n    return { hunks };\n  })();\n\n  return { code, themeStyles, baseThemeType };\n}\n\ninterface ProcessLineDiffProps {\n  oldLine: string | undefined;\n  newLine: string | undefined;\n  oldLineIndex: number;\n  newLineIndex: number;\n  oldDecorations: DecorationItem[];\n  newDecorations: DecorationItem[];\n  lineDiffType: LineDiffTypes;\n}\n\nfunction computeLineDiffDecorations({\n  oldLine,\n  newLine,\n  oldLineIndex,\n  newLineIndex,\n  oldDecorations,\n  newDecorations,\n  lineDiffType,\n}: ProcessLineDiffProps) {\n  if (oldLine == null || newLine == null || lineDiffType === 'none') {\n    return;\n  }\n  oldLine = cleanLastNewline(oldLine);\n  newLine = cleanLastNewline(newLine);\n  // NOTE(amadeus): Because we visually trim trailing newlines when rendering,\n  // we also gotta make sure the diff parsing doesn't include the newline\n  // character that could be there...\n  const lineDiff =\n    lineDiffType === 'char'\n      ? diffChars(oldLine, newLine)\n      : diffWordsWithSpace(oldLine, newLine);\n  const deletionSpans: [0 | 1, string][] = [];\n  const additionSpans: [0 | 1, string][] = [];\n  const enableJoin = lineDiffType === 'word-alt';\n  for (const item of lineDiff) {\n    const isLastItem = item === lineDiff[lineDiff.length - 1];\n    if (!item.added && !item.removed) {\n      pushOrJoinSpan({\n        item,\n        arr: deletionSpans,\n        enableJoin,\n        isNeutral: true,\n        isLastItem,\n      });\n      pushOrJoinSpan({\n        item,\n        arr: additionSpans,\n        enableJoin,\n        isNeutral: true,\n        isLastItem,\n      });\n    } else if (item.removed) {\n      pushOrJoinSpan({ item, arr: deletionSpans, enableJoin, isLastItem });\n    } else {\n      pushOrJoinSpan({ item, arr: additionSpans, enableJoin, isLastItem });\n    }\n  }\n  let spanIndex = 0;\n  for (const span of deletionSpans) {\n    if (span[0] === 1) {\n      oldDecorations.push(\n        createDiffSpanDecoration({\n          // Decoration indexes start at 0\n          line: oldLineIndex - 1,\n          spanStart: spanIndex,\n          spanLength: span[1].length,\n        })\n      );\n    }\n    spanIndex += span[1].length;\n  }\n  spanIndex = 0;\n  for (const span of additionSpans) {\n    if (span[0] === 1) {\n      newDecorations.push(\n        createDiffSpanDecoration({\n          // Decoration indexes start at 0\n          line: newLineIndex - 1,\n          spanStart: spanIndex,\n          spanLength: span[1].length,\n        })\n      );\n    }\n    spanIndex += span[1].length;\n  }\n}\n\ninterface ProcessLinesProps {\n  hunks: Hunk[];\n  oldLines?: string[];\n  newLines?: string[];\n  splitLineIndex?: number;\n  unifiedLineIndex?: number;\n  newLineIndex?: number;\n  oldLineIndex?: number;\n  lineDiffType: LineDiffTypes;\n}\n\nfunction processLines({\n  hunks,\n  oldLines,\n  newLines,\n  splitLineIndex = 0,\n  unifiedLineIndex = 0,\n  lineDiffType,\n}: ProcessLinesProps) {\n  const oldInfo: Record<number, LineInfo | undefined> = {};\n  const newInfo: Record<number, LineInfo | undefined> = {};\n  const oldDecorations: DecorationItem[] = [];\n  const newDecorations: DecorationItem[] = [];\n  let newLineIndex = 1;\n  let oldLineIndex = 1;\n  let newLineNumber = 1;\n  let oldLineNumber = 1;\n  let oldContent = '';\n  let newContent = '';\n  for (const hunk of hunks) {\n    // If there's content prior to the hunk, lets fill it up\n    while (\n      oldLines != null &&\n      newLines != null &&\n      newLineIndex < hunk.additionStart &&\n      oldLineIndex < hunk.deletionStart\n    ) {\n      oldInfo[oldLineIndex] = {\n        type: 'context-expanded',\n        lineNumber: oldLineNumber,\n        altLineNumber: newLineNumber,\n        lineIndex: `${unifiedLineIndex},${splitLineIndex}`,\n      };\n      newInfo[newLineIndex] = {\n        type: 'context-expanded',\n        lineNumber: newLineNumber,\n        altLineNumber: oldLineNumber,\n        lineIndex: `${unifiedLineIndex},${splitLineIndex}`,\n      };\n      oldContent += oldLines[oldLineIndex - 1];\n      newContent += newLines[newLineIndex - 1];\n      oldLineIndex++;\n      newLineIndex++;\n      oldLineNumber++;\n      newLineNumber++;\n      splitLineIndex++;\n      unifiedLineIndex++;\n    }\n    oldLineNumber = hunk.deletionStart;\n    newLineNumber = hunk.additionStart;\n\n    // Lets process the actual hunk content\n    for (const hunkContent of hunk.hunkContent) {\n      if (hunkContent.type === 'context') {\n        for (const line of hunkContent.lines) {\n          oldInfo[oldLineIndex] = {\n            type: 'context',\n            lineNumber: oldLineNumber,\n            altLineNumber: newLineNumber,\n            lineIndex: `${unifiedLineIndex},${splitLineIndex}`,\n          };\n          newInfo[newLineIndex] = {\n            type: 'context',\n            lineNumber: newLineNumber,\n            altLineNumber: oldLineNumber,\n            lineIndex: `${unifiedLineIndex},${splitLineIndex}`,\n          };\n          oldContent += line;\n          newContent += line;\n          oldLineIndex++;\n          newLineIndex++;\n          newLineNumber++;\n          oldLineNumber++;\n          splitLineIndex++;\n          unifiedLineIndex++;\n        }\n      } else {\n        const len = Math.max(\n          hunkContent.additions.length,\n          hunkContent.deletions.length\n        );\n        let i = 0;\n        // NOTE(amadeus): Since we iterate through deletions and additions\n        // simultaneously, we have to create a secondary iterator for\n        // unifiedLineIndex, and then when we're done, add the combined lengths\n        // of additions/deletions to the main variable\n        let _unifiedLineIndex = unifiedLineIndex;\n        while (i < len) {\n          const oldLine = hunkContent.deletions[i];\n          const newLine = hunkContent.additions[i];\n          computeLineDiffDecorations({\n            newLine,\n            oldLine,\n            oldLineIndex,\n            newLineIndex,\n            oldDecorations,\n            newDecorations,\n            lineDiffType,\n          });\n          if (oldLine != null) {\n            oldInfo[oldLineIndex] = {\n              type: 'change-deletion',\n              lineNumber: oldLineNumber,\n              lineIndex: `${_unifiedLineIndex},${splitLineIndex}`,\n            };\n            oldContent += oldLine;\n            oldLineIndex++;\n            oldLineNumber++;\n          }\n          if (newLine != null) {\n            newInfo[newLineIndex] = {\n              type: 'change-addition',\n              lineNumber: newLineNumber,\n              lineIndex: `${_unifiedLineIndex + hunkContent.deletions.length},${splitLineIndex}`,\n            };\n            newContent += newLine;\n            newLineIndex++;\n            newLineNumber++;\n          }\n          splitLineIndex++;\n          _unifiedLineIndex++;\n          i++;\n        }\n        unifiedLineIndex +=\n          hunkContent.additions.length + hunkContent.deletions.length;\n      }\n    }\n\n    if (\n      oldLines == null ||\n      newLines == null ||\n      hunk !== hunks[hunks.length - 1]\n    )\n      continue;\n    // If we are on the last hunk, we should fully iterate through the rest\n    // of the lines\n    while (oldLineIndex <= oldLines.length || newLineIndex <= oldLines.length) {\n      const oldLine = oldLines[oldLineIndex - 1];\n      const newLine = newLines[newLineIndex - 1];\n      if (oldLine == null && newLine == null) {\n        break;\n      }\n      if (oldLine != null) {\n        oldInfo[oldLineIndex] = {\n          type: 'context-expanded',\n          lineNumber: oldLineNumber,\n          altLineNumber: newLineNumber,\n          lineIndex: `${unifiedLineIndex},${splitLineIndex}`,\n        };\n        oldContent += oldLine;\n        oldLineIndex++;\n        oldLineNumber++;\n      }\n      if (newLine != null) {\n        newInfo[newLineIndex] = {\n          type: 'context-expanded',\n          lineNumber: newLineNumber,\n          altLineNumber: oldLineNumber,\n          lineIndex: `${unifiedLineIndex},${splitLineIndex}`,\n        };\n        newContent += newLine;\n        newLineIndex++;\n        newLineNumber++;\n      }\n      splitLineIndex++;\n      unifiedLineIndex++;\n    }\n  }\n  return {\n    oldContent: cleanLastNewline(oldContent),\n    newContent: cleanLastNewline(newContent),\n    oldInfo,\n    newInfo,\n    oldDecorations,\n    newDecorations,\n    splitLineIndex,\n    unifiedLineIndex,\n  };\n}\n\ninterface RenderTwoFilesProps {\n  oldFile: FileContents;\n  newFile: FileContents;\n  oldInfo: Record<number, LineInfo | undefined>;\n  newInfo: Record<number, LineInfo | undefined>;\n  oldDecorations: DecorationItem[];\n  newDecorations: DecorationItem[];\n  options: RenderDiffOptions;\n  highlighter: DiffsHighlighter;\n  languageOverride: SupportedLanguages | undefined;\n}\n\nfunction renderTwoFiles({\n  oldFile,\n  newFile,\n  oldInfo,\n  newInfo,\n  highlighter,\n  oldDecorations,\n  newDecorations,\n  languageOverride,\n  options: { theme: themeOrThemes = DEFAULT_THEMES, ...options },\n}: RenderTwoFilesProps) {\n  const oldLang = languageOverride ?? getFiletypeFromFileName(oldFile.name);\n  const newLang = languageOverride ?? getFiletypeFromFileName(newFile.name);\n  const { state, transformers } = createTransformerWithState();\n  const hastConfig: CodeToHastOptions<DiffsThemeNames> = (() => {\n    return typeof themeOrThemes === 'string'\n      ? {\n          ...options,\n          // language will be overwritten for each highlight\n          lang: 'text',\n          theme: themeOrThemes,\n          transformers,\n          decorations: undefined,\n          defaultColor: false,\n          cssVariablePrefix: formatCSSVariablePrefix(),\n        }\n      : {\n          ...options,\n          // language will be overwritten for each highlight\n          lang: 'text',\n          themes: themeOrThemes,\n          transformers,\n          decorations: undefined,\n          defaultColor: false,\n          cssVariablePrefix: formatCSSVariablePrefix(),\n        };\n  })();\n\n  const oldLines = (() => {\n    if (oldFile.contents === '') {\n      return [];\n    }\n    hastConfig.lang = oldLang;\n    state.lineInfo = oldInfo;\n    hastConfig.decorations = oldDecorations;\n    return getLineNodes(highlighter.codeToHast(oldFile.contents, hastConfig));\n  })();\n  const newLines = (() => {\n    if (newFile.contents === '') {\n      return [];\n    }\n    hastConfig.lang = newLang;\n    hastConfig.decorations = newDecorations;\n    state.lineInfo = newInfo;\n    return getLineNodes(highlighter.codeToHast(newFile.contents, hastConfig));\n  })();\n\n  return { oldLines, newLines };\n}\n","import { DEFAULT_THEMES } from '../constants';\nimport type {\n  CodeToHastOptions,\n  DiffsHighlighter,\n  DiffsThemeNames,\n  FileContents,\n  RenderFileOptions,\n  ThemedFileResult,\n} from '../types';\nimport { cleanLastNewline } from './cleanLastNewline';\nimport { createTransformerWithState } from './createTransformerWithState';\nimport { formatCSSVariablePrefix } from './formatCSSVariablePrefix';\nimport { getFiletypeFromFileName } from './getFiletypeFromFileName';\nimport { getHighlighterThemeStyles } from './getHighlighterThemeStyles';\nimport { getLineNodes } from './getLineNodes';\n\nexport function renderFileWithHighlighter(\n  file: FileContents,\n  highlighter: DiffsHighlighter,\n  { theme = DEFAULT_THEMES, tokenizeMaxLineLength }: RenderFileOptions,\n  forcePlainText = false\n): ThemedFileResult {\n  const { state, transformers } = createTransformerWithState();\n  const lang = forcePlainText\n    ? 'text'\n    : (file.lang ?? getFiletypeFromFileName(file.name));\n  const baseThemeType = (() => {\n    if (typeof theme === 'string') {\n      return highlighter.getTheme(theme).type;\n    }\n    return undefined;\n  })();\n  const themeStyles = getHighlighterThemeStyles({\n    theme,\n    highlighter,\n  });\n  state.lineInfo = (shikiLineNumber: number) => ({\n    type: 'context',\n    lineIndex: shikiLineNumber - 1,\n    lineNumber: shikiLineNumber,\n  });\n  const hastConfig: CodeToHastOptions<DiffsThemeNames> = (() => {\n    if (typeof theme === 'string') {\n      return {\n        lang,\n        theme,\n        transformers,\n        defaultColor: false,\n        cssVariablePrefix: formatCSSVariablePrefix(),\n        tokenizeMaxLineLength,\n      };\n    }\n    return {\n      lang,\n      themes: theme,\n      transformers,\n      defaultColor: false,\n      cssVariablePrefix: formatCSSVariablePrefix(),\n      tokenizeMaxLineLength,\n    };\n  })();\n  return {\n    code: getLineNodes(\n      highlighter.codeToHast(cleanLastNewline(file.contents), hastConfig)\n    ),\n    themeStyles,\n    baseThemeType: baseThemeType,\n  };\n}\n","import { createJavaScriptRegexEngine } from '@shikijs/engine-javascript';\nimport { createHighlighterCoreSync } from 'shiki/core';\n\nimport { DEFAULT_THEMES } from '../constants';\nimport { attachResolvedLanguages } from '../highlighter/languages/attachResolvedLanguages';\nimport { attachResolvedThemes } from '../highlighter/themes/attachResolvedThemes';\nimport type {\n  DiffsHighlighter,\n  RenderDiffOptions,\n  RenderFileOptions,\n  ThemedDiffResult,\n  ThemedFileResult,\n} from '../types';\nimport { renderDiffWithHighlighter } from '../utils/renderDiffWithHighlighter';\nimport { renderFileWithHighlighter } from '../utils/renderFileWithHighlighter';\nimport type {\n  InitializeSuccessResponse,\n  InitializeWorkerRequest,\n  RenderDiffRequest,\n  RenderDiffSuccessResponse,\n  RenderErrorResponse,\n  RenderFileRequest,\n  RenderFileSuccessResponse,\n  SetRenderOptionsWorkerRequest,\n  WorkerRenderingOptions,\n  WorkerRequest,\n  WorkerRequestId,\n} from './types';\n\nlet highlighter: DiffsHighlighter | undefined;\nlet renderOptions: WorkerRenderingOptions = {\n  theme: DEFAULT_THEMES,\n  tokenizeMaxLineLength: 1000,\n  lineDiffType: 'word-alt',\n};\n\nself.addEventListener('error', (event) => {\n  console.error('[Shiki Worker] Unhandled error:', event.error);\n});\n\n// Handle incoming messages from the main thread\nself.addEventListener('message', (event: MessageEvent<WorkerRequest>) => {\n  const request = event.data;\n\n  try {\n    switch (request.type) {\n      case 'initialize':\n        handleInitialize(request);\n        break;\n      case 'set-render-options':\n        handleSetRenderOptions(request);\n        break;\n      case 'file':\n        handleRenderFile(request);\n        break;\n      case 'diff':\n        handleRenderDiff(request);\n        break;\n      default:\n        throw new Error(\n          `Unknown request type: ${(request as WorkerRequest).type}`\n        );\n    }\n  } catch (error) {\n    console.error('Worker error:', error);\n    sendError(request.id, error);\n  }\n});\n\nfunction handleInitialize({\n  id,\n  renderOptions: options,\n  resolvedThemes,\n  resolvedLanguages,\n}: InitializeWorkerRequest) {\n  const highlighter = getHighlighter();\n  attachResolvedThemes(resolvedThemes, highlighter);\n  if (resolvedLanguages != null) {\n    attachResolvedLanguages(resolvedLanguages, highlighter);\n  }\n  renderOptions = options;\n  postMessage({\n    type: 'success',\n    id,\n    requestType: 'initialize',\n    sentAt: Date.now(),\n  } satisfies InitializeSuccessResponse);\n}\n\nfunction handleSetRenderOptions({\n  id,\n  renderOptions: options,\n  resolvedThemes,\n}: SetRenderOptionsWorkerRequest) {\n  const highlighter = getHighlighter();\n  attachResolvedThemes(resolvedThemes, highlighter);\n  renderOptions = options;\n  postMessage({\n    type: 'success',\n    id,\n    requestType: 'set-render-options',\n    sentAt: Date.now(),\n  });\n}\n\nfunction handleRenderFile({ id, file, resolvedLanguages }: RenderFileRequest) {\n  const highlighter = getHighlighter();\n  // Load resolved languages if provided\n  if (resolvedLanguages != null) {\n    attachResolvedLanguages(resolvedLanguages, highlighter);\n  }\n  const fileOptions = {\n    theme: renderOptions.theme,\n    tokenizeMaxLineLength: renderOptions.tokenizeMaxLineLength,\n  };\n  sendFileSuccess(\n    id,\n    renderFileWithHighlighter(file, highlighter, fileOptions),\n    fileOptions\n  );\n}\n\nfunction handleRenderDiff({ id, diff, resolvedLanguages }: RenderDiffRequest) {\n  const highlighter = getHighlighter();\n  // Load resolved languages if provided\n  if (resolvedLanguages != null) {\n    attachResolvedLanguages(resolvedLanguages, highlighter);\n  }\n  const result = renderDiffWithHighlighter(diff, highlighter, renderOptions);\n  sendDiffSuccess(id, result, renderOptions);\n}\n\nfunction getHighlighter(): DiffsHighlighter {\n  highlighter ??= createHighlighterCoreSync({\n    themes: [],\n    langs: [],\n    engine: createJavaScriptRegexEngine(),\n  }) as DiffsHighlighter;\n  return highlighter;\n}\n\nfunction sendFileSuccess(\n  id: WorkerRequestId,\n  result: ThemedFileResult,\n  options: RenderFileOptions\n) {\n  postMessage({\n    type: 'success',\n    requestType: 'file',\n    id,\n    result,\n    options,\n    sentAt: Date.now(),\n  } satisfies RenderFileSuccessResponse);\n}\n\nfunction sendDiffSuccess(\n  id: WorkerRequestId,\n  result: ThemedDiffResult,\n  options: RenderDiffOptions\n) {\n  postMessage({\n    type: 'success',\n    requestType: 'diff',\n    id,\n    result,\n    options,\n    sentAt: Date.now(),\n  } satisfies RenderDiffSuccessResponse);\n}\n\nfunction sendError(id: WorkerRequestId, error: unknown) {\n  const response: RenderErrorResponse = {\n    type: 'error',\n    id,\n    error: error instanceof Error ? error.message : String(error),\n    stack: error instanceof Error ? error.stack : undefined,\n  };\n  postMessage(response);\n}\n"],"mappings":";;;;;;AAsBA,MAAaA,iBAA6B;CACxC,MAAM;CACN,OAAO;CACR;;;;ACtBD,MAAaC,oCACX,IAAI,KAAK;AAOX,MAAaC,oCAAiC,IAAI,KAAK;;;;ACPvD,SAAgB,wBACd,mBACA,eACM;AACN,qBAAoB,MAAM,QAAQ,kBAAkB,GAChD,oBACA,CAAC,kBAAkB;AAEvB,MAAK,MAAM,gBAAgB,mBAAmB;AAC5C,MAAI,kBAAkB,IAAI,aAAa,KAAK,CAAE;EAC9C,IAAI,OAAO,kBAAkB,IAAI,aAAa,KAAK;AACnD,MAAI,QAAQ,MAAM;AAChB,UAAO;AACP,qBAAkB,IAAI,aAAa,MAAM,KAAK;;AAEhD,oBAAkB,IAAI,KAAK,KAAK;AAChC,gBAAY,iBAAiB,KAAK,KAAK;;;;;;AChB3C,MAAaC,iCACX,IAAI,KAAK;AAYX,MAAaC,iCAA8B,IAAI,KAAK;;;;ACVpD,SAAgB,qBACd,QAIA,eACM;AACN,UAAS,MAAM,QAAQ,OAAO,GAAG,SAAS,CAAC,OAAO;AAClD,MAAK,IAAI,YAAY,QAAQ;EAC3B,IAAIC;AACJ,MAAI,OAAO,aAAa,UAAU;AAChC,mBAAgB,eAAe,IAAI,SAAS;AAC5C,OAAI,iBAAiB,KACnB,OAAM,IAAI,MACR,uBAAuB,SAAS,yEACjC;SAEE;AACL,mBAAgB;AAChB,cAAW,SAAS;AACpB,OAAI,CAAC,eAAe,IAAI,SAAS,CAC/B,gBAAe,IAAI,UAAU,cAAc;;AAG/C,MAAI,eAAe,IAAI,SAAS,CAAE;AAClC,iBAAe,IAAI,SAAS;AAC5B,gBAAY,cAAc,cAAc;;;;;;ACjC5C,SAAgB,iBAAiB,UAA0B;AACzD,QAAO,SAAS,QAAQ,aAAa,GAAG;;;;;ACU1C,SAAgB,sBAAsB,OAAqB;AACzD,QAAO;EAAE,MAAM;EAAQ;EAAO;;AAkBhC,SAAgB,kBAAkB,EAChC,SACA,WAAW,EAAE,EACb,aAAa,EAAE,IACuB;AACtC,QAAO;EACL,MAAM;EACN;EACA;EACA;EACD;;AA4BH,SAAgB,gBACd,OACyB;CACzB,IAAIC,aAAsD,MAAM,SAAS;AACzE,QAAO,cAAc,MAAM;AACzB,MAAI,WAAW,SAAS,aAAa,WAAW,YAAY,OAC1D,QAAO;AAET,MAAI,cAAc,WAChB,cAAa,WAAW,SAAS;MAEjC,cAAa;;;;;;AC1EnB,SAAgB,YACd,MACA,MACA,OACgB;CAChB,MAAM,WACJ,OAAO,MAAM,aAAa,aACtB,MAAM,SAAS,KAAK,GACpB,MAAM,SAAS;AACrB,KAAI,YAAY,MAAM;AACpB,UAAQ,MAAM;GAAE;GAAM;GAAM;GAAO,CAAC;AACpC,QAAM,IAAI,MAAM,qBAAqB,KAAK,8BAA8B;;AAI1E,MAAK,UAAU;AACf,MAAK,WAAW,yBAAyB;AAIzC,KAAI,KAAK,SAAS,WAAW,EAC3B,MAAK,SAAS,KAAK,sBAAsB,KAAK,CAAC;AAgBjD,QAAO,kBAAkB;EACvB,SAAS;EACT,UAhBe,CACf,kBAAkB;GAChB,SAAS;GACT,UAAU,CACR,kBAAkB;IAChB,SAAS;IACT,UAAU,CAAC;KAAE,MAAM;KAAQ,OAAO,GAAG,SAAS;KAAc,CAAC;IAC7D,YAAY,EAAE,4BAA4B,IAAI;IAC/C,CAAC,CACH;GACD,YAAY,EAAE,sBAAsB,IAAI;GACzC,CAAC,EACF,KACD;EAIC,YAAY;GACV,aAAa,SAAS;GACtB,iBAAiB,SAAS;GAC1B,kBAAkB,SAAS;GAC3B,mBAAmB,SAAS;GAC7B;EACF,CAAC;;;;;ACnCJ,SAAgB,2BACd,gBAAgB,OACkB;CAClC,MAAMC,QAA2B,EAC/B,UAAU,EAAE,EACb;CACD,MAAMC,eAAmC,CACvC;EACE,KAAK,MAAM;AAET,UAAO,KAAK,WAAW;AACvB,UAAO;;EAET,IAAI,KAAK;GACP,MAAM,OAAO,gBAAgB,IAAI;GACjC,MAAMC,WAA6B,EAAE;AACrC,OAAI,QAAQ,MAAM;IAChB,IAAI,QAAQ;AACZ,SAAK,MAAM,QAAQ,KAAK,UAAU;AAChC,SAAI,KAAK,SAAS,UAAW;AAC7B,cAAS,KAAK,YAAY,MAAM,OAAO,MAAM,CAAC;AAC9C;;AAEF,SAAK,WAAW;;AAElB,UAAO;;EAEV,CACF;AACD,KAAI,cACF,cAAa,KAAK,sBAAsB,QAAQ;AAElD,QAAO;EAAE;EAAO;EAAc;EAAS;;AAGzC,MAAM,UAAU,wBAAwB,EAAE,aAAa,OAAO,CAAC;AAI/D,MAAMC,uBAAyC;CAC7C,MAAM;CACN,OAAO,OAAO;AACZ,OAAK,MAAM,QAAQ,MACjB,MAAK,MAAM,SAAS,MAAM;AAExB,OAAI,MAAM,aAAa,KAAM;GAE7B,MAAMC,QAAgC,EAAE;AAExC,OAAI,MAAM,SAAS,KACjB,OAAM,QAAQ,MAAM;AAEtB,OAAI,MAAM,WAAW,KACnB,OAAM,sBAAsB,MAAM;AAEpC,OAAI,MAAM,aAAa,QAAQ,MAAM,cAAc,GAAG;AAEpD,SAAK,MAAM,YAAY,OAAO,EAC5B,OAAM,gBAAgB;AAExB,SAAK,MAAM,YAAY,OAAO,EAC5B,OAAM,iBAAiB;AAEzB,SAAK,MAAM,YAAY,OAAO,EAC5B,OAAM,qBAAqB;;AAK/B,OAAI,OAAO,KAAK,MAAM,CAAC,SAAS,EAC9B,OAAM,YAAY;;;CAK3B;;;;AC3FD,SAAgB,wBAAwB,SAAiB,SAAS;AAChE,QAAO,KAAK,OAAO;;;;;ACCrB,MAAaC,2BAA+C;CAC1D,MAAM;CACN,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,MAAM;CACN,UAAU;CACV,kBAAkB;CAClB,gBAAgB;CAChB,MAAM;CACN,UAAU;CACV,KAAK;CACL,SAAS;CACT,KAAK;CACL,aAAa;CACb,MAAM;CACN,KAAK;CACL,KAAK;CACL,GAAG;CACH,OAAO;CACP,KAAK;CACL,KAAK;CACL,IAAI;CACJ,MAAM;CACN,KAAK;CACL,KAAK;CACL,IAAI;CACJ,WAAW;CACX,KAAK;CACL,OAAO;CACP,aAAa;CACb,KAAK;CACL,GAAG;CACH,GAAG;CACH,IAAI;CACJ,KAAK;CACL,KAAK;CACL,IAAI;CACJ,KAAK;CACL,IAAI;CACJ,KAAK;CACL,OAAO;CACP,MAAM;CACN,KAAK;CACL,MAAM;CACN,MAAM;CACN,KAAK;CACL,OAAO;CACP,kBAAkB;CAClB,KAAK;CACL,KAAK;CACL,OAAO;CACP,YAAY;CACZ,IAAI;CACJ,QAAQ;CACR,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,GAAG;CACH,KAAK;CACL,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,QAAQ;CACR,KAAK;CACL,GAAG;CACH,MAAM;CACN,KAAK;CACL,SAAS;CACT,MAAM;CACN,OAAO;CACP,YAAY;CACZ,YAAY;CACZ,KAAK;CACL,IAAI;CACJ,MAAM;CACN,IAAI;CACJ,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,GAAG;CACH,KAAK;CACL,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,MAAM;CACN,KAAK;CACL,MAAM;CACN,KAAK;CACL,IAAI;CACJ,UAAU;CACV,IAAI;CACJ,SAAS;CACT,gBAAgB;CAChB,mBAAmB;CACnB,KAAK;CACL,OAAO;CACP,KAAK;CACL,MAAM;CACN,MAAM;CACN,MAAM;CACN,QAAQ;CACR,IAAI;CACJ,KAAK;CACL,SAAS;CACT,IAAI;CACJ,SAAS;CACT,KAAK;CACL,QAAQ;CACR,KAAK;CACL,MAAM;CACN,MAAM;CACN,KAAK;CACL,YAAY;CACZ,IAAI;CACJ,KAAK;CACL,IAAI;CACJ,KAAK;CACL,OAAO;CACP,MAAM;CACN,IAAI;CACJ,MAAM;CACN,KAAK;CACL,MAAM;CACN,MAAM;CACN,MAAM;CACN,IAAI;CACJ,MAAM;CACN,KAAK;CACL,KAAK;CACL,MAAM;CACN,KAAK;CACL,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,OAAO;CACP,QAAQ;CACR,IAAI;CACJ,OAAO;CACP,IAAI;CACJ,MAAM;CACN,OAAO;CACP,OAAO;CACP,OAAO;CACP,SAAS;CACT,WAAW;CACX,MAAM;CACN,KAAK;CACL,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,MAAM;CACN,MAAM;CACN,QAAQ;CACR,KAAK;CACL,IAAI;CACJ,MAAM;CACN,KAAK;CACL,MAAM;CACN,UAAU;CACV,IAAI;CACJ,UAAU;CACV,IAAI;CACJ,UAAU;CACV,OAAO;CACP,GAAG;CACH,KAAK;CACL,KAAK;CACL,KAAK;CACL,MAAM;CACN,WAAW;CACX,KAAK;CACL,SAAS;CACT,MAAM;CACN,MAAM;CACN,MAAM;CACN,MAAM;CACN,KAAK;CACL,IAAI;CACJ,KAAK;CACL,MAAM;CACN,QAAQ;CACR,KAAK;CACL,IAAI;CACJ,IAAI;CACJ,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,GAAG;CACH,IAAI;CACJ,IAAI;CACJ,GAAG;CACH,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,OAAO;CACP,KAAK;CACL,KAAK;CACL,IAAI;CACJ,OAAO;CACP,MAAM;CACN,KAAK;CACL,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,MAAM;CACN,MAAM;CACN,QAAQ;CACR,KAAK;CACL,GAAG;CACH,YAAY;CACZ,OAAO;CACP,IAAI;CACJ,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,QAAQ;CACR,KAAK;CACL,GAAG;CACH,GAAG;CACH,KAAK;CACL,MAAM;CACN,OAAO;CACP,QAAQ;CACR,IAAI;CACJ,KAAK;CACL,KAAK;CACL,OAAO;CACP,KAAK;CACL,IAAI;CACJ,KAAK;CACL,MAAM;CACN,SAAS;CACT,KAAK;CACL,MAAM;CACN,OAAO;CACP,IAAI;CACJ,KAAK;CACL,IAAI;CACJ,KAAK;CACL,MAAM;CACN,MAAM;CACN,aAAa;CACb,IAAI;CACJ,KAAK;CACL,QAAQ;CACR,IAAI;CACJ,KAAK;CACL,QAAQ;CACR,IAAI;CACJ,KAAK;CACL,KAAK;CACL,MAAM;CACN,QAAQ;CACR,QAAQ;CACR,OAAO;CACP,IAAI;CACJ,KAAK;CACL,SAAS;CACT,QAAQ;CACR,QAAQ;CACR,OAAO;CACP,OAAO;CACP,MAAM;CACN,KAAK;CACL,OAAO;CACP,IAAI;CACJ,QAAQ;CACR,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACL,KAAK;CACL,MAAM;CACN,KAAK;CACL,IAAI;CACJ,MAAM;CACN,MAAM;CACN,IAAI;CACJ,KAAK;CACL,KAAK;CACL,IAAI;CACJ,KAAK;CACL,MAAM;CACN,KAAK;CACL,KAAK;CACL,WAAW;CACX,IAAI;CACJ,MAAM;CACN,KAAK;CACL,IAAI;CACJ,MAAM;CACN,KAAK;CACL,IAAI;CACJ,IAAI;CACJ,KAAK;CACL,KAAK;CACL,MAAM;CACN,MAAM;CACN,KAAK;CACL,IAAI;CACJ,KAAK;CACL,KAAK;CACL,KAAK;CACN;AAED,SAAgB,wBAAwB,UAAsC;AAE5E,KAAI,yBAAyB,aAAa,KACxC,QAAO,yBAAyB;CAIlC,MAAM,gBAAgB,SAAS,MAAM,wBAAwB;AAC7D,KACE,iBAAiB,QACjB,yBAAyB,cAAc,OAAO,KAE9C,QAAO,yBAAyB,cAAc,OAAO;AAKvD,QAAO,yBADa,SAAS,MAAM,aAAa,GACF,MAAM,OAAO;;;;;AC3U7D,SAAgB,0BAA0B,EACxC,QAAQ,gBACR,4BACA,UACyC;CACzC,IAAI,SAAS;AACb,KAAI,OAAO,UAAU,UAAU;EAC7B,MAAM,YAAYC,cAAY,SAAS,MAAM;AAC7C,YAAU,SAAS,UAAU,GAAG;AAChC,YAAU,oBAAoB,UAAU,GAAG;AAC3C,YAAU,GAAG,wBAAwB,OAAO,CAAC,KAAK,UAAU,GAAG;AAC/D,YAAU,GAAG,wBAAwB,OAAO,CAAC,KAAK,UAAU,GAAG;AAC/D,YAAU,kBAAkB,WAAW,OAAO;QACzC;EACL,IAAI,YAAYA,cAAY,SAAS,MAAM,KAAK;AAChD,YAAU,GAAG,wBAAwB,OAAO,CAAC,OAAO,UAAU,GAAG;AACjE,YAAU,GAAG,wBAAwB,OAAO,CAAC,UAAU,UAAU,GAAG;AACpE,YAAU,kBAAkB,WAAW,QAAQ,OAAO;AAEtD,cAAYA,cAAY,SAAS,MAAM,MAAM;AAC7C,YAAU,GAAG,wBAAwB,OAAO,CAAC,QAAQ,UAAU,GAAG;AAClE,YAAU,GAAG,wBAAwB,OAAO,CAAC,WAAW,UAAU,GAAG;AACrE,YAAU,kBAAkB,WAAW,QAAQ,QAAQ;;AAEzD,QAAO;;AAGT,SAAS,kBACP,WACA,QACA,YACA;AACA,cAAa,cAAc,OAAO,GAAG,WAAW,KAAK;CACrD,IAAI,SAAS;CACb,MAAM,gBACJ,UAAU,SAAS,4CACnB,UAAU,SAAS;AACrB,KAAI,iBAAiB,KACnB,WAAU,GAAG,wBAAwB,OAAO,GAAG,WAAW,iBAAiB,cAAc;CAE3F,MAAM,cACJ,UAAU,SAAS,8CACnB,UAAU,SAAS;AACrB,KAAI,eAAe,KACjB,WAAU,GAAG,wBAAwB,OAAO,GAAG,WAAW,iBAAiB,YAAY;CAEzF,MAAM,eACJ,UAAU,SAAS,+CACnB,UAAU,SAAS;AACrB,KAAI,gBAAgB,KAClB,WAAU,GAAG,wBAAwB,OAAO,GAAG,WAAW,iBAAiB,aAAa;AAE1F,QAAO;;;;;ACpET,SAAgB,aAAa,OAA+B;CAC1D,IAAIC,aAAkD,MAAM,SAAS;AACrE,QAAO,cAAc,MAAM;AACzB,MAAI,WAAW,SAAS,aAAa,WAAW,YAAY,OAC1D,QAAO,WAAW;AAEpB,MAAI,cAAc,WAChB,cAAa,WAAW,SAAS;MAEjC,cAAa;;AAGjB,SAAQ,MAAM,MAAM;AACpB,OAAM,IAAI,MAAM,wCAAwC;;;;;ACL1D,SAAgB,yBAAyB,EACvC,MACA,WACA,cACgD;AAChD,QAAO;EACL,OAAO;GAAE;GAAM,WAAW;GAAW;EACrC,KAAK;GAAE;GAAM,WAAW,YAAY;GAAY;EAChD,YAAY,EAAE,kBAAkB,IAAI;EACpC,YAAY;EACb;;AAgBH,SAAgB,eAAe,EAC7B,MACA,KACA,YACA,YAAY,OACZ,aAAa,SACe;CAC5B,MAAM,WAAW,IAAI,IAAI,SAAS;AAClC,KAAI,YAAY,QAAQ,cAAc,CAAC,YAAY;AACjD,MAAI,KAAK,CAAC,YAAY,IAAI,GAAG,KAAK,MAAM,CAAC;AACzC;;CAEF,MAAM,oBAAoB,SAAS,OAAO;AAC1C,KACE,cAAc,qBAGb,aAAa,KAAK,MAAM,WAAW,KAAK,CAAC,mBAC1C;AACA,WAAS,MAAM,KAAK;AACpB;;AAEF,KAAI,KAAK,CAAC,YAAY,IAAI,GAAG,KAAK,MAAM,CAAC;;;;;AC7B3C,SAAgB,0BACd,MACA,eACA,SACA,iBAAiB,OACC;CAClB,MAAM,uBAAuB;EAC3B,MAAM,QAAQ,QAAQ,SAAS;AAC/B,MAAI,OAAO,UAAU,SACnB,QAAOC,cAAY,SAAS,MAAM,CAAC;KAGnC;CACJ,MAAM,cAAc,0BAA0B;EAC5C,OAAO,QAAQ;EACf;EACD,CAAC;AAEF,KAAI,KAAK,YAAY,QAAQ,KAAK,YAAY,MAAM;EAClD,MAAM,EACJ,YACA,YACA,SACA,SACA,gBACA,mBACE,aAAa;GACf,OAAO,KAAK;GACZ,UAAU,KAAK;GACf,UAAU,KAAK;GACf,cAAc,QAAQ;GACvB,CAAC;AAsBF,SAAO;GAAE,MAbI,eAAe;IAC1B,SATc;KACd,MAAM,KAAK,YAAY,KAAK;KAC5B,UAAU;KACX;IAOC;IACA;IAEA,SATc;KACd,MAAM,KAAK;KACX,UAAU;KACX;IAOC;IACA;IAEA;IACA;IACA,kBAAkB,iBAAiB,SAAS,KAAK;IAClD,CAAC;GACa;GAAa;GAAe;;CAE7C,MAAMC,QAAiC,EAAE;CACzC,IAAI,iBAAiB;CACrB,IAAI,mBAAmB;AACvB,MAAK,MAAM,QAAQ,KAAK,OAAO;EAC7B,MAAM,EACJ,YACA,YACA,SACA,SACA,gBACA,gBACA,gBAAgB,mBAChB,kBAAkB,wBAChB,aAAa;GACf,OAAO,CAAC,KAAK;GACb;GACA;GACA,cAAc,QAAQ;GACvB,CAAC;EACF,MAAM,UAAU;GACd,MAAM,KAAK,YAAY,KAAK;GAC5B,UAAU;GACX;EACD,MAAM,UAAU;GACd,MAAM,KAAK;GACX,UAAU;GACX;AACD,QAAM,KACJ,eAAe;GACb;GACA;GACA;GAEA;GACA;GACA;GAEA;GACA;GACA,kBAAkB,iBAAiB,SAAS,KAAK;GAClD,CAAC,CACH;AACD,mBAAiB;AACjB,qBAAmB;;AAarB,QAAO;EAAE,aAVW;AAClB,OAAI,MAAM,UAAU,GAAG;IACrB,MAAM,OAAO,MAAM,MAAM;KAAE,UAAU,EAAE;KAAE,UAAU,EAAE;KAAE;AACvD,QAAI,KAAK,SAAS,WAAW,KAAK,KAAK,SAAS,WAAW,EACzD,QAAO;;AAGX,UAAO,EAAE,OAAO;MACd;EAEW;EAAa;EAAe;;AAa7C,SAAS,2BAA2B,EAClC,SACA,SACA,cACA,cACA,gBACA,gBACA,gBACuB;AACvB,KAAI,WAAW,QAAQ,WAAW,QAAQ,iBAAiB,OACzD;AAEF,WAAU,iBAAiB,QAAQ;AACnC,WAAU,iBAAiB,QAAQ;CAInC,MAAM,WACJ,iBAAiB,SACb,UAAU,SAAS,QAAQ,GAC3B,mBAAmB,SAAS,QAAQ;CAC1C,MAAMC,gBAAmC,EAAE;CAC3C,MAAMC,gBAAmC,EAAE;CAC3C,MAAM,aAAa,iBAAiB;AACpC,MAAK,MAAM,QAAQ,UAAU;EAC3B,MAAM,aAAa,SAAS,SAAS,SAAS,SAAS;AACvD,MAAI,CAAC,KAAK,SAAS,CAAC,KAAK,SAAS;AAChC,kBAAe;IACb;IACA,KAAK;IACL;IACA,WAAW;IACX;IACD,CAAC;AACF,kBAAe;IACb;IACA,KAAK;IACL;IACA,WAAW;IACX;IACD,CAAC;aACO,KAAK,QACd,gBAAe;GAAE;GAAM,KAAK;GAAe;GAAY;GAAY,CAAC;MAEpE,gBAAe;GAAE;GAAM,KAAK;GAAe;GAAY;GAAY,CAAC;;CAGxE,IAAI,YAAY;AAChB,MAAK,MAAM,QAAQ,eAAe;AAChC,MAAI,KAAK,OAAO,EACd,gBAAe,KACb,yBAAyB;GAEvB,MAAM,eAAe;GACrB,WAAW;GACX,YAAY,KAAK,GAAG;GACrB,CAAC,CACH;AAEH,eAAa,KAAK,GAAG;;AAEvB,aAAY;AACZ,MAAK,MAAM,QAAQ,eAAe;AAChC,MAAI,KAAK,OAAO,EACd,gBAAe,KACb,yBAAyB;GAEvB,MAAM,eAAe;GACrB,WAAW;GACX,YAAY,KAAK,GAAG;GACrB,CAAC,CACH;AAEH,eAAa,KAAK,GAAG;;;AAezB,SAAS,aAAa,EACpB,OACA,UACA,UACA,iBAAiB,GACjB,mBAAmB,GACnB,gBACoB;CACpB,MAAMC,UAAgD,EAAE;CACxD,MAAMC,UAAgD,EAAE;CACxD,MAAMC,iBAAmC,EAAE;CAC3C,MAAMC,iBAAmC,EAAE;CAC3C,IAAI,eAAe;CACnB,IAAI,eAAe;CACnB,IAAI,gBAAgB;CACpB,IAAI,gBAAgB;CACpB,IAAI,aAAa;CACjB,IAAI,aAAa;AACjB,MAAK,MAAM,QAAQ,OAAO;AAExB,SACE,YAAY,QACZ,YAAY,QACZ,eAAe,KAAK,iBACpB,eAAe,KAAK,eACpB;AACA,WAAQ,gBAAgB;IACtB,MAAM;IACN,YAAY;IACZ,eAAe;IACf,WAAW,GAAG,iBAAiB,GAAG;IACnC;AACD,WAAQ,gBAAgB;IACtB,MAAM;IACN,YAAY;IACZ,eAAe;IACf,WAAW,GAAG,iBAAiB,GAAG;IACnC;AACD,iBAAc,SAAS,eAAe;AACtC,iBAAc,SAAS,eAAe;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEF,kBAAgB,KAAK;AACrB,kBAAgB,KAAK;AAGrB,OAAK,MAAM,eAAe,KAAK,YAC7B,KAAI,YAAY,SAAS,UACvB,MAAK,MAAM,QAAQ,YAAY,OAAO;AACpC,WAAQ,gBAAgB;IACtB,MAAM;IACN,YAAY;IACZ,eAAe;IACf,WAAW,GAAG,iBAAiB,GAAG;IACnC;AACD,WAAQ,gBAAgB;IACtB,MAAM;IACN,YAAY;IACZ,eAAe;IACf,WAAW,GAAG,iBAAiB,GAAG;IACnC;AACD,iBAAc;AACd,iBAAc;AACd;AACA;AACA;AACA;AACA;AACA;;OAEG;GACL,MAAM,MAAM,KAAK,IACf,YAAY,UAAU,QACtB,YAAY,UAAU,OACvB;GACD,IAAI,IAAI;GAKR,IAAI,oBAAoB;AACxB,UAAO,IAAI,KAAK;IACd,MAAM,UAAU,YAAY,UAAU;IACtC,MAAM,UAAU,YAAY,UAAU;AACtC,+BAA2B;KACzB;KACA;KACA;KACA;KACA;KACA;KACA;KACD,CAAC;AACF,QAAI,WAAW,MAAM;AACnB,aAAQ,gBAAgB;MACtB,MAAM;MACN,YAAY;MACZ,WAAW,GAAG,kBAAkB,GAAG;MACpC;AACD,mBAAc;AACd;AACA;;AAEF,QAAI,WAAW,MAAM;AACnB,aAAQ,gBAAgB;MACtB,MAAM;MACN,YAAY;MACZ,WAAW,GAAG,oBAAoB,YAAY,UAAU,OAAO,GAAG;MACnE;AACD,mBAAc;AACd;AACA;;AAEF;AACA;AACA;;AAEF,uBACE,YAAY,UAAU,SAAS,YAAY,UAAU;;AAI3D,MACE,YAAY,QACZ,YAAY,QACZ,SAAS,MAAM,MAAM,SAAS,GAE9B;AAGF,SAAO,gBAAgB,SAAS,UAAU,gBAAgB,SAAS,QAAQ;GACzE,MAAM,UAAU,SAAS,eAAe;GACxC,MAAM,UAAU,SAAS,eAAe;AACxC,OAAI,WAAW,QAAQ,WAAW,KAChC;AAEF,OAAI,WAAW,MAAM;AACnB,YAAQ,gBAAgB;KACtB,MAAM;KACN,YAAY;KACZ,eAAe;KACf,WAAW,GAAG,iBAAiB,GAAG;KACnC;AACD,kBAAc;AACd;AACA;;AAEF,OAAI,WAAW,MAAM;AACnB,YAAQ,gBAAgB;KACtB,MAAM;KACN,YAAY;KACZ,eAAe;KACf,WAAW,GAAG,iBAAiB,GAAG;KACnC;AACD,kBAAc;AACd;AACA;;AAEF;AACA;;;AAGJ,QAAO;EACL,YAAY,iBAAiB,WAAW;EACxC,YAAY,iBAAiB,WAAW;EACxC;EACA;EACA;EACA;EACA;EACA;EACD;;AAeH,SAAS,eAAe,EACtB,SACA,SACA,SACA,SACA,4BACA,gBACA,gBACA,kBACA,SAAS,EAAE,OAAO,gBAAgB,eAAgB,GAAG,aAC/B;CACtB,MAAM,UAAU,oBAAoB,wBAAwB,QAAQ,KAAK;CACzE,MAAM,UAAU,oBAAoB,wBAAwB,QAAQ,KAAK;CACzE,MAAM,EAAE,OAAO,iBAAiB,4BAA4B;CAC5D,MAAMC,oBAAwD;AAC5D,SAAO,OAAO,kBAAkB,WAC5B;GACE,GAAG;GAEH,MAAM;GACN,OAAO;GACP;GACA,aAAa;GACb,cAAc;GACd,mBAAmB,yBAAyB;GAC7C,GACD;GACE,GAAG;GAEH,MAAM;GACN,QAAQ;GACR;GACA,aAAa;GACb,cAAc;GACd,mBAAmB,yBAAyB;GAC7C;KACH;AAqBJ,QAAO;EAAE,iBAnBe;AACtB,OAAI,QAAQ,aAAa,GACvB,QAAO,EAAE;AAEX,cAAW,OAAO;AAClB,SAAM,WAAW;AACjB,cAAW,cAAc;AACzB,UAAO,aAAaR,cAAY,WAAW,QAAQ,UAAU,WAAW,CAAC;MACvE;EAWe,iBAVK;AACtB,OAAI,QAAQ,aAAa,GACvB,QAAO,EAAE;AAEX,cAAW,OAAO;AAClB,cAAW,cAAc;AACzB,SAAM,WAAW;AACjB,UAAO,aAAaA,cAAY,WAAW,QAAQ,UAAU,WAAW,CAAC;MACvE;EAEyB;;;;;ACzd/B,SAAgB,0BACd,MACA,eACA,EAAE,QAAQ,gBAAgB,yBAC1B,iBAAiB,OACC;CAClB,MAAM,EAAE,OAAO,iBAAiB,4BAA4B;CAC5D,MAAM,OAAO,iBACT,SACC,KAAK,QAAQ,wBAAwB,KAAK,KAAK;CACpD,MAAM,uBAAuB;AAC3B,MAAI,OAAO,UAAU,SACnB,QAAOS,cAAY,SAAS,MAAM,CAAC;KAGnC;CACJ,MAAM,cAAc,0BAA0B;EAC5C;EACA;EACD,CAAC;AACF,OAAM,YAAY,qBAA6B;EAC7C,MAAM;EACN,WAAW,kBAAkB;EAC7B,YAAY;EACb;CACD,MAAMC,oBAAwD;AAC5D,MAAI,OAAO,UAAU,SACnB,QAAO;GACL;GACA;GACA;GACA,cAAc;GACd,mBAAmB,yBAAyB;GAC5C;GACD;AAEH,SAAO;GACL;GACA,QAAQ;GACR;GACA,cAAc;GACd,mBAAmB,yBAAyB;GAC5C;GACD;KACC;AACJ,QAAO;EACL,MAAM,aACJD,cAAY,WAAW,iBAAiB,KAAK,SAAS,EAAE,WAAW,CACpE;EACD;EACe;EAChB;;;;;ACtCH,IAAIE;AACJ,IAAIC,gBAAwC;CAC1C,OAAO;CACP,uBAAuB;CACvB,cAAc;CACf;AAED,KAAK,iBAAiB,UAAU,UAAU;AACxC,SAAQ,MAAM,mCAAmC,MAAM,MAAM;EAC7D;AAGF,KAAK,iBAAiB,YAAY,UAAuC;CACvE,MAAM,UAAU,MAAM;AAEtB,KAAI;AACF,UAAQ,QAAQ,MAAhB;GACE,KAAK;AACH,qBAAiB,QAAQ;AACzB;GACF,KAAK;AACH,2BAAuB,QAAQ;AAC/B;GACF,KAAK;AACH,qBAAiB,QAAQ;AACzB;GACF,KAAK;AACH,qBAAiB,QAAQ;AACzB;GACF,QACE,OAAM,IAAI,MACR,yBAA0B,QAA0B,OACrD;;UAEE,OAAO;AACd,UAAQ,MAAM,iBAAiB,MAAM;AACrC,YAAU,QAAQ,IAAI,MAAM;;EAE9B;AAEF,SAAS,iBAAiB,EACxB,IACA,eAAe,SACf,gBACA,qBAC0B;CAC1B,MAAMC,gBAAc,gBAAgB;AACpC,sBAAqB,gBAAgBA,cAAY;AACjD,KAAI,qBAAqB,KACvB,yBAAwB,mBAAmBA,cAAY;AAEzD,iBAAgB;AAChB,aAAY;EACV,MAAM;EACN;EACA,aAAa;EACb,QAAQ,KAAK,KAAK;EACnB,CAAqC;;AAGxC,SAAS,uBAAuB,EAC9B,IACA,eAAe,SACf,kBACgC;AAEhC,sBAAqB,gBADD,gBAAgB,CACa;AACjD,iBAAgB;AAChB,aAAY;EACV,MAAM;EACN;EACA,aAAa;EACb,QAAQ,KAAK,KAAK;EACnB,CAAC;;AAGJ,SAAS,iBAAiB,EAAE,IAAI,MAAM,qBAAwC;CAC5E,MAAMA,gBAAc,gBAAgB;AAEpC,KAAI,qBAAqB,KACvB,yBAAwB,mBAAmBA,cAAY;CAEzD,MAAM,cAAc;EAClB,OAAO,cAAc;EACrB,uBAAuB,cAAc;EACtC;AACD,iBACE,IACA,0BAA0B,MAAMA,eAAa,YAAY,EACzD,YACD;;AAGH,SAAS,iBAAiB,EAAE,IAAI,MAAM,qBAAwC;CAC5E,MAAMA,gBAAc,gBAAgB;AAEpC,KAAI,qBAAqB,KACvB,yBAAwB,mBAAmBA,cAAY;AAGzD,iBAAgB,IADD,0BAA0B,MAAMA,eAAa,cAAc,EAC9C,cAAc;;AAG5C,SAAS,iBAAmC;AAC1C,iBAAgB,0BAA0B;EACxC,QAAQ,EAAE;EACV,OAAO,EAAE;EACT,QAAQ,6BAA6B;EACtC,CAAC;AACF,QAAO;;AAGT,SAAS,gBACP,IACA,QACA,SACA;AACA,aAAY;EACV,MAAM;EACN,aAAa;EACb;EACA;EACA;EACA,QAAQ,KAAK,KAAK;EACnB,CAAqC;;AAGxC,SAAS,gBACP,IACA,QACA,SACA;AACA,aAAY;EACV,MAAM;EACN,aAAa;EACb;EACA;EACA;EACA,QAAQ,KAAK,KAAK;EACnB,CAAqC;;AAGxC,SAAS,UAAU,IAAqB,OAAgB;CACtD,MAAMC,WAAgC;EACpC,MAAM;EACN;EACA,OAAO,iBAAiB,QAAQ,MAAM,UAAU,OAAO,MAAM;EAC7D,OAAO,iBAAiB,QAAQ,MAAM,QAAQ;EAC/C;AACD,aAAY,SAAS"}