{"version":3,"file":"parseDiffFromFile.js","names":[],"sources":["../../src/utils/parseDiffFromFile.ts"],"sourcesContent":["import { createTwoFilesPatch } from 'diff';\n\nimport { SPLIT_WITH_NEWLINES } from '../constants';\nimport type { FileContents, FileDiffMetadata } from '../types';\nimport { parsePatchFiles } from './parsePatchFiles';\n\n/**\n * Parses a diff from two file contents objects.\n *\n * If both `oldFile` and `newFile` have a `cacheKey`, the resulting diff will\n * automatically get a combined cache key in the format `oldKey:newKey`.\n */\nexport function parseDiffFromFile(\n  oldFile: FileContents,\n  newFile: FileContents\n): FileDiffMetadata {\n  const patch = createTwoFilesPatch(\n    oldFile.name,\n    newFile.name,\n    oldFile.contents,\n    newFile.contents,\n    oldFile.header,\n    newFile.header\n  );\n  const fileData = parsePatchFiles(patch)[0]?.files[0];\n  if (fileData == null) {\n    throw new Error(\n      'parseDiffFrom: FileInvalid diff -- probably need to fix something -- if the files are the same maybe?'\n    );\n  }\n  fileData.oldLines = oldFile.contents.split(SPLIT_WITH_NEWLINES);\n  fileData.newLines = newFile.contents.split(SPLIT_WITH_NEWLINES);\n  if (oldFile.cacheKey != null && newFile.cacheKey != null) {\n    fileData.cacheKey = `${oldFile.cacheKey}:${newFile.cacheKey}`;\n  }\n  return fileData;\n}\n"],"mappings":";;;;;;;;;;;AAYA,SAAgB,kBACd,SACA,SACkB;CASlB,MAAM,WAAW,gBARH,oBACZ,QAAQ,MACR,QAAQ,MACR,QAAQ,UACR,QAAQ,UACR,QAAQ,QACR,QAAQ,OACT,CACsC,CAAC,IAAI,MAAM;AAClD,KAAI,YAAY,KACd,OAAM,IAAI,MACR,wGACD;AAEH,UAAS,WAAW,QAAQ,SAAS,MAAM,oBAAoB;AAC/D,UAAS,WAAW,QAAQ,SAAS,MAAM,oBAAoB;AAC/D,KAAI,QAAQ,YAAY,QAAQ,QAAQ,YAAY,KAClD,UAAS,WAAW,GAAG,QAAQ,SAAS,GAAG,QAAQ;AAErD,QAAO"}