import {
  createStaticStore
} from "./chunk-LRBZO5R4.js";
import {
  access,
  noop
} from "./chunk-EPEP5WPS.js";
import {
  isServer
} from "./chunk-5C2DUIQJ.js";
import {
  createEffect,
  onCleanup,
  onMount
} from "./chunk-VL2SL2GY.js";
import "./chunk-G3PMV62Z.js";

// ../../node_modules/.bun/@solid-primitives+audio@1.4.2+95b571dd5236cc92/node_modules/@solid-primitives/audio/dist/index.js
var AudioState;
(function(AudioState2) {
  AudioState2["LOADING"] = "loading";
  AudioState2["PLAYING"] = "playing";
  AudioState2["PAUSED"] = "paused";
  AudioState2["COMPLETE"] = "complete";
  AudioState2["STOPPED"] = "stopped";
  AudioState2["READY"] = "ready";
  AudioState2["ERROR"] = "error";
})(AudioState || (AudioState = {}));
var unwrapSource = (src) => {
  if (src instanceof HTMLAudioElement) {
    return src;
  }
  const player = new Audio();
  setAudioSrc(player, src);
  return player;
};
function setAudioSrc(el, src) {
  el[typeof src === "string" ? "src" : "srcObject"] = src;
}
var makeAudio = (src, handlers = {}) => {
  if (isServer) {
    return {};
  }
  const player = unwrapSource(src);
  onMount(() => {
    for (const [name, handler] of Object.entries(handlers)) {
      player.addEventListener(name, handler);
    }
  });
  onCleanup(() => {
    player.pause();
    for (const [name, handler] of Object.entries(handlers)) {
      player.removeEventListener(name, handler);
    }
  });
  return player;
};
var makeAudioPlayer = (src, handlers = {}) => {
  if (isServer) {
    return {
      pause: noop,
      play: async () => noop(),
      player: {},
      seek: noop,
      setVolume: noop
    };
  }
  const player = makeAudio(src, handlers);
  return {
    player,
    play: () => player.play(),
    pause: () => player.pause(),
    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition
    seek: player.fastSeek ? (time) => player.fastSeek(time) : (time) => player.currentTime = time,
    setVolume: (volume) => player.volume = volume
  };
};
var createAudio = (src, playing, volume) => {
  if (isServer) {
    return [
      {
        state: AudioState.LOADING,
        currentTime: 0,
        duration: 0,
        volume: 0,
        player: {}
      },
      {
        seek: noop,
        setVolume: noop,
        play: async () => noop(),
        pause: noop
      }
    ];
  }
  const player = unwrapSource(access(src));
  const [store, setStore] = createStaticStore({
    state: AudioState.LOADING,
    player,
    currentTime: 0,
    duration: 0,
    volume: 0
  });
  const { play, pause, setVolume: _setVolume, seek } = makeAudioPlayer(store.player, {
    loadeddata: () => {
      setStore({
        state: AudioState.READY,
        duration: player.duration
      });
      if (playing && playing()) {
        play().catch((e) => {
          if (e.name === "NotAllowedError") {
            setStore("state", AudioState.ERROR);
          }
        });
      }
    },
    timeupdate: () => setStore("currentTime", player.currentTime),
    loadstart: () => setStore("state", AudioState.LOADING),
    playing: () => setStore("state", AudioState.PLAYING),
    pause: () => setStore("state", AudioState.PAUSED),
    error: () => setStore("state", AudioState.ERROR),
    ended: () => setStore("state", AudioState.COMPLETE)
  });
  const setVolume = (volume2) => {
    setStore("volume", volume2);
    _setVolume(volume2);
  };
  if (src instanceof Function) {
    createEffect(() => {
      const newSrc = src();
      if (newSrc instanceof HTMLAudioElement) {
        setStore("player", newSrc);
      } else {
        setAudioSrc(store.player, newSrc);
      }
      seek(0);
    });
  }
  if (playing) {
    createEffect(() => playing() ? play() : pause());
  }
  if (volume) {
    createEffect(() => setVolume(volume()));
    setVolume(volume());
  }
  return [store, { seek, play, pause, setVolume }];
};
export {
  AudioState,
  createAudio,
  makeAudio,
  makeAudioPlayer
};
//# sourceMappingURL=@solid-primitives_audio.js.map
