{
  "version": 3,
  "sources": ["../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/areSelectionsEqual.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/managers/LineSelectionManager.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/managers/MouseEventManager.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/managers/ResizeManager.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/highlighter/languages/areLanguagesAttached.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/highlighter/themes/areThemesAttached.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createAnnotationElement.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/getIconForType.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createFileHeaderElement.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createPreElement.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/getHighlighterOptions.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/getLineAnnotationName.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/renderers/FileRenderer.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/sprite.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/areFilesEqual.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createAnnotationWrapperNode.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createCodeNode.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createHoverContentNode.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createUnsafeCSSStyleNode.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/style.css", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/cssWrappers.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/prerenderHTMLIfNecessary.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/setWrapperNodeProps.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/components/web-components.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/components/File.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/managers/ScrollSyncManager.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createEmptyRowBuffer.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createNoNewlineElement.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createSeparator.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/getHunkSeparatorSlotName.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/getTotalLineCountFromHunks.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/renderers/DiffHunksRenderer.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/parseLineType.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/parsePatchFiles.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/parseDiffFromFile.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/components/FileDiff.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/managers/UniversalRenderingManager.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/shiki-stream/tokenizer.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/shiki-stream/stream.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createRowNodes.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createSpanNodeFromToken.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/components/FileStream.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/areObjectsEqual.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/areOptionsEqual.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/createStyleElement.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/diffAcceptRejectHunk.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/getLineEndingType.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/getSingularPatch.ts", "../../../../../node_modules/.bun/@pierre+diffs@1.0.2+67f6792bdf102c28/node_modules/@pierre/diffs/src/utils/setLanguageOverride.ts"],
  "sourcesContent": ["import type { SelectedLineRange } from '../managers/LineSelectionManager';\n\nexport function areSelectionsEqual(\n  selectionA: SelectedLineRange | undefined,\n  selectionB: SelectedLineRange | undefined\n): boolean {\n  return (\n    selectionA?.start === selectionB?.start &&\n    selectionA?.end === selectionB?.end &&\n    selectionA?.side === selectionB?.side &&\n    selectionA?.endSide === selectionB?.endSide\n  );\n}\n", "import type { AnnotationSide } from '../types';\nimport { areSelectionsEqual } from '../utils/areSelectionsEqual';\n\nexport type SelectionSide = AnnotationSide;\n\nexport interface SelectedLineRange {\n  start: number;\n  side?: SelectionSide;\n  end: number;\n  endSide?: SelectionSide;\n}\n\nexport interface LineSelectionOptions {\n  enableLineSelection?: boolean;\n  onLineSelected?: (range: SelectedLineRange | null) => void;\n  onLineSelectionStart?: (range: SelectedLineRange | null) => void;\n  onLineSelectionEnd?: (range: SelectedLineRange | null) => void;\n}\n\ninterface MouseInfo {\n  lineNumber: number;\n  eventSide: AnnotationSide;\n  lineIndex: number;\n}\n\n/**\n * Manages line selection state and interactions for code/diff viewers.\n * Handles:\n * - Click and drag selection\n * - Shift-click to extend selection\n * - DOM attribute updates (data-selected-line)\n */\nexport class LineSelectionManager {\n  private pre: HTMLPreElement | undefined;\n  private selectedRange: SelectedLineRange | null = null;\n  private renderedSelectionRange: SelectedLineRange | null | undefined;\n  private anchor: { line: number; side: SelectionSide } | undefined;\n  private _queuedRender: number | undefined;\n\n  constructor(private options: LineSelectionOptions = {}) {}\n\n  setOptions(options: LineSelectionOptions): void {\n    this.options = { ...this.options, ...options };\n    this.removeEventListeners();\n    if (this.options.enableLineSelection === true) {\n      this.attachEventListeners();\n    }\n  }\n\n  cleanUp(): void {\n    this.removeEventListeners();\n    if (this._queuedRender != null) {\n      cancelAnimationFrame(this._queuedRender);\n      this._queuedRender = undefined;\n    }\n    if (this.pre != null) {\n      delete this.pre.dataset.interactiveLineNumbers;\n    }\n    this.pre = undefined;\n  }\n\n  setup(pre: HTMLPreElement): void {\n    // Assume we are always dirty after a setup...\n    this.setDirty();\n    if (this.pre !== pre) {\n      this.cleanUp();\n    }\n    this.pre = pre;\n    const { enableLineSelection = false } = this.options;\n    if (enableLineSelection) {\n      this.pre.dataset.interactiveLineNumbers = '';\n      this.attachEventListeners();\n    } else {\n      this.removeEventListeners();\n      delete this.pre.dataset.interactiveLineNumbers;\n    }\n\n    this.setSelection(this.selectedRange);\n  }\n\n  setDirty(): void {\n    this.renderedSelectionRange = undefined;\n  }\n\n  isDirty(): boolean {\n    return this.renderedSelectionRange === undefined;\n  }\n\n  setSelection(range: SelectedLineRange | null): void {\n    const isRangeChange = !(\n      range === this.selectedRange ||\n      areSelectionsEqual(range ?? undefined, this.selectedRange ?? undefined)\n    );\n    if (!this.isDirty() && !isRangeChange) return;\n    this.selectedRange = range;\n    this.renderSelection();\n    if (isRangeChange) {\n      this.notifySelectionChange();\n    }\n  }\n\n  getSelection(): SelectedLineRange | null {\n    return this.selectedRange;\n  }\n\n  private attachEventListeners(): void {\n    if (this.pre == null) return;\n    // Lets run a cleanup, just in case\n    this.removeEventListeners();\n    this.pre.addEventListener('mousedown', this.handleMouseDown);\n  }\n\n  private removeEventListeners(): void {\n    if (this.pre == null) return;\n    this.pre.removeEventListener('mousedown', this.handleMouseDown);\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n  }\n\n  private handleMouseDown = (event: MouseEvent): void => {\n    // Only handle left mouse button\n    const mouseEventData =\n      event.button === 0\n        ? this.getMouseEventDataForPath(event.composedPath(), 'click')\n        : undefined;\n    if (mouseEventData == null) {\n      return;\n    }\n    event.preventDefault();\n    const { lineNumber, eventSide, lineIndex } = mouseEventData;\n    if (event.shiftKey && this.selectedRange != null) {\n      const range = this.deriveRowRangeFromDOM(\n        this.selectedRange,\n        this.pre?.dataset.type === 'split'\n      );\n      if (range == null) return;\n      const useStart =\n        range.start <= range.end\n          ? lineIndex >= range.start\n          : lineIndex <= range.end;\n      this.anchor = {\n        line: useStart ? this.selectedRange.start : this.selectedRange.end,\n        side:\n          (useStart\n            ? this.selectedRange.side\n            : (this.selectedRange.endSide ?? this.selectedRange.side)) ??\n          'additions',\n      };\n      this.updateSelection(lineNumber, eventSide);\n      this.notifySelectionStart(this.selectedRange);\n    } else {\n      // Check if clicking on already selected single line to unselect\n      if (\n        this.selectedRange?.start === lineNumber &&\n        this.selectedRange?.end === lineNumber\n      ) {\n        this.updateSelection(null);\n        this.notifySelectionEnd(null);\n        this.notifySelectionChange();\n        return;\n      }\n      this.selectedRange = null;\n      this.anchor = { line: lineNumber, side: eventSide };\n      this.updateSelection(lineNumber, eventSide);\n      this.notifySelectionStart(this.selectedRange);\n    }\n\n    document.addEventListener('mousemove', this.handleMouseMove);\n    document.addEventListener('mouseup', this.handleMouseUp);\n  };\n\n  private handleMouseMove = (event: MouseEvent): void => {\n    const mouseEventData = this.getMouseEventDataForPath(\n      event.composedPath(),\n      'move'\n    );\n    if (mouseEventData == null || this.anchor == null) return;\n    const { lineNumber, eventSide } = mouseEventData;\n    this.updateSelection(lineNumber, eventSide);\n  };\n\n  private handleMouseUp = (): void => {\n    this.anchor = undefined;\n    document.removeEventListener('mousemove', this.handleMouseMove);\n    document.removeEventListener('mouseup', this.handleMouseUp);\n    this.notifySelectionEnd(this.selectedRange);\n    this.notifySelectionChange();\n  };\n\n  private updateSelection(currentLine: null): void;\n  private updateSelection(currentLine: number, side: AnnotationSide): void;\n  private updateSelection(\n    currentLine: number | null,\n    side?: AnnotationSide\n  ): void {\n    if (currentLine == null) {\n      this.selectedRange = null;\n    } else {\n      const anchorSide = this.anchor?.side ?? side;\n      const anchorLine = this.anchor?.line ?? currentLine;\n      this.selectedRange = {\n        start: anchorLine,\n        end: currentLine,\n        side: anchorSide,\n        endSide: anchorSide !== side ? side : undefined,\n      };\n    }\n    this._queuedRender ??= requestAnimationFrame(this.renderSelection);\n  }\n\n  private renderSelection = (): void => {\n    if (this._queuedRender != null) {\n      cancelAnimationFrame(this._queuedRender);\n      this._queuedRender = undefined;\n    }\n    if (\n      this.pre == null ||\n      this.renderedSelectionRange === this.selectedRange\n    ) {\n      return;\n    }\n\n    // First clear existing selections, maybe we\n    // can cache this to better avoid this query?\n    const allSelected = this.pre.querySelectorAll('[data-selected-line]');\n    for (const element of allSelected) {\n      element.removeAttribute('data-selected-line');\n    }\n\n    this.renderedSelectionRange = this.selectedRange;\n    if (this.selectedRange == null) {\n      return;\n    }\n\n    const codeElements = this.pre.querySelectorAll('[data-code]');\n    if (codeElements.length === 0) return;\n    if (codeElements.length > 2) {\n      console.error(codeElements);\n      throw new Error(\n        'LineSelectionManager.applySelectionToDOM: Somehow there are more than 2 code elements...'\n      );\n    }\n    const split = this.pre.dataset.type === 'split';\n    const rowRange = this.deriveRowRangeFromDOM(this.selectedRange, split);\n    if (rowRange == null) {\n      console.error({ rowRange, selectedRange: this.selectedRange });\n      throw new Error(\n        'LineSelectionManager.renderSelection: No valid rowRange'\n      );\n    }\n    const isSingle = rowRange.start === rowRange.end;\n    const first = Math.min(rowRange.start, rowRange.end);\n    const last = Math.max(rowRange.start, rowRange.end);\n    for (const code of codeElements) {\n      for (const element of code.children) {\n        if (!(element instanceof HTMLElement)) continue;\n        const lineIndex = this.getLineIndex(element, split);\n        if ((lineIndex ?? 0) > last) break;\n        if (lineIndex == null || lineIndex < first) continue;\n        let attributeValue = isSingle\n          ? 'single'\n          : lineIndex === first\n            ? 'first'\n            : lineIndex === last\n              ? 'last'\n              : '';\n        element.setAttribute('data-selected-line', attributeValue);\n        // If we have a line annotation following our selected line, we should\n        // mark it as selected as well\n        if (\n          element.nextSibling instanceof HTMLElement &&\n          element.nextSibling.hasAttribute('data-line-annotation')\n        ) {\n          // Depending on the line's attribute value, lets go ahead and correct\n          // it when adding in the annotation row\n          if (isSingle) {\n            // Single technically becomes 2 selected lines\n            attributeValue = 'last';\n            element.setAttribute('data-selected-line', 'first');\n          } else if (lineIndex === first) {\n            // We don't want apply 'first' to the line annotation\n            attributeValue = '';\n          } else if (lineIndex === last) {\n            // the annotation will become the last selected line and therefore\n            // our existing line should no longer be last\n            element.setAttribute('data-selected-line', '');\n          }\n          element.nextSibling.setAttribute(\n            'data-selected-line',\n            attributeValue\n          );\n        }\n      }\n    }\n  };\n\n  private deriveRowRangeFromDOM(\n    range: SelectedLineRange,\n    split: boolean\n  ): { start: number; end: number } | undefined {\n    if (range == null) return undefined;\n    const start = this.findRowIndexForLineNumber(\n      range.start,\n      range.side,\n      split\n    );\n    const end =\n      range.end === range.start &&\n      (range.endSide == null || range.endSide === range.side)\n        ? start\n        : this.findRowIndexForLineNumber(\n            range.end,\n            range.endSide ?? range.side,\n            split\n          );\n    return start != null && end != null ? { start, end } : undefined;\n  }\n\n  private findRowIndexForLineNumber(\n    lineNumber: number,\n    targetSide: SelectionSide = 'additions',\n    split: boolean\n  ): number | undefined {\n    if (this.pre == null) return undefined;\n    const elements = Array.from(\n      this.pre.querySelectorAll(`[data-line=\"${lineNumber}\"]`)\n    );\n    // Given how unified diffs can order things, we need to always process\n    // `[data-line]` elements before `[data-alt-line]`\n    elements.push(\n      ...Array.from(\n        this.pre.querySelectorAll(`[data-alt-line=\"${lineNumber}\"]`)\n      )\n    );\n    if (elements.length === 0) return undefined;\n\n    for (const element of elements) {\n      if (!(element instanceof HTMLElement)) {\n        continue;\n      }\n      const side = this.getLineSideFromElement(element);\n      if (side === targetSide) {\n        return this.getLineIndex(element, split);\n      } else if (parseInt(element.dataset.altLine ?? '') === lineNumber) {\n        return this.getLineIndex(element, split);\n      }\n    }\n    console.error(\n      'LineSelectionManager.findRowIndexForLineNumber: Invalid selection',\n      lineNumber,\n      targetSide\n    );\n    return undefined;\n  }\n\n  private notifySelectionChange(): void {\n    const { onLineSelected } = this.options;\n    if (onLineSelected == null) return;\n\n    onLineSelected(this.selectedRange ?? null);\n  }\n\n  private notifySelectionStart(range: SelectedLineRange | null): void {\n    const { onLineSelectionStart } = this.options;\n    if (onLineSelectionStart == null) return;\n    onLineSelectionStart(range);\n  }\n\n  private notifySelectionEnd(range: SelectedLineRange | null): void {\n    const { onLineSelectionEnd } = this.options;\n    if (onLineSelectionEnd == null) return;\n    onLineSelectionEnd(range);\n  }\n\n  private getMouseEventDataForPath(\n    path: (EventTarget | undefined)[],\n    eventType: 'click' | 'move'\n  ): MouseInfo | undefined {\n    let lineNumber: number | undefined;\n    let lineIndex: number | undefined;\n    let isNumberColumn = false;\n    let eventSide: AnnotationSide | undefined;\n    for (const element of path) {\n      if (!(element instanceof HTMLElement)) {\n        continue;\n      }\n      if (element.hasAttribute('data-column-number')) {\n        isNumberColumn = true;\n        continue;\n      }\n      if (element.hasAttribute('data-line')) {\n        lineNumber = this.getLineNumber(element);\n        lineIndex = this.getLineIndex(\n          element,\n          this.pre?.dataset.type === 'split'\n        );\n        if (element.dataset.lineType === 'change-deletion') {\n          eventSide = 'deletions';\n        } else if (element.dataset.lineType === 'change-additions') {\n          eventSide = 'additions';\n        }\n        // if we can't pull out an index or line number, we can't do anything.\n        if (lineIndex == null || lineNumber == null) {\n          lineIndex = undefined;\n          lineNumber = undefined;\n          break;\n        }\n        // If we already have an eventSide, we done computin\n        if (eventSide != null) {\n          break;\n        } else {\n          // context type lines will need to be discovered higher up\n          // at the data-code level\n        }\n        continue;\n      }\n      if (element.hasAttribute('data-code')) {\n        eventSide ??= element.hasAttribute('data-deletions')\n          ? 'deletions'\n          : // context in unified style are assumed to be additions based on\n            // their line numbers\n            'additions';\n        // If we got to the code element, we def done, son\n        break;\n      }\n    }\n    if (\n      (eventType === 'click' && !isNumberColumn) ||\n      lineIndex == null ||\n      lineNumber == null\n    ) {\n      return undefined;\n    }\n    return {\n      lineIndex,\n      lineNumber,\n      // Normally this shouldn't hit unless we broke early for whatever reason,\n      // but for types lets ensure it's additions if undefined\n      eventSide: eventSide ?? 'additions',\n    };\n  }\n\n  private getLineNumber(element: HTMLElement): number | undefined {\n    const lineNumber = parseInt(element.dataset.line ?? '', 10);\n    return !Number.isNaN(lineNumber) ? lineNumber : undefined;\n  }\n\n  private getLineIndex(\n    element: HTMLElement,\n    split: boolean\n  ): number | undefined {\n    const lineIndexes = (element.dataset.lineIndex ?? '')\n      .split(',')\n      .map((value) => parseInt(value))\n      .filter((value) => !Number.isNaN(value));\n\n    if (split && lineIndexes.length === 2) {\n      return lineIndexes[1];\n    } else if (!split) {\n      return lineIndexes[0];\n    }\n    return undefined;\n  }\n\n  private getLineSideFromElement(element: HTMLElement): SelectionSide {\n    if (element.dataset.lineType === 'change-deletion') {\n      return 'deletions';\n    }\n    if (element.dataset.lineType === 'change-addition') {\n      return 'additions';\n    }\n    const parent = element.closest('[data-code]');\n    if (!(parent instanceof HTMLElement)) {\n      return 'additions';\n    }\n    return parent.hasAttribute('data-deletions') ? 'deletions' : 'additions';\n  }\n}\n\nexport function pluckLineSelectionOptions({\n  enableLineSelection,\n  onLineSelected,\n  onLineSelectionStart,\n  onLineSelectionEnd,\n}: LineSelectionOptions): LineSelectionOptions {\n  return {\n    enableLineSelection,\n    onLineSelected,\n    onLineSelectionStart,\n    onLineSelectionEnd,\n  };\n}\n", "import type {\n  AnnotationSide,\n  DiffLineEventBaseProps,\n  ExpansionDirections,\n  LineEventBaseProps,\n} from '../types';\n\nexport type LogTypes = 'click' | 'move' | 'both' | 'none';\n\nexport type MouseEventManagerMode = 'file' | 'diff';\n\nexport interface OnLineClickProps extends LineEventBaseProps {\n  event: PointerEvent;\n}\n\nexport interface OnLineEnterLeaveProps extends LineEventBaseProps {\n  event: MouseEvent;\n}\n\nexport interface OnDiffLineClickProps extends DiffLineEventBaseProps {\n  event: PointerEvent;\n}\n\nexport interface OnDiffLineEnterLeaveProps extends DiffLineEventBaseProps {\n  event: MouseEvent;\n}\n\ntype HandleMouseEventProps =\n  | { eventType: 'click'; event: MouseEvent }\n  | { eventType: 'move'; event: MouseEvent };\n\ntype EventClickProps<TMode extends MouseEventManagerMode> = TMode extends 'file'\n  ? OnLineClickProps\n  : OnDiffLineClickProps;\n\ntype MouseEventEnterLeaveProps<TMode extends MouseEventManagerMode> =\n  TMode extends 'file' ? OnLineEnterLeaveProps : OnDiffLineEnterLeaveProps;\n\ntype EventBaseProps<TMode extends MouseEventManagerMode> = TMode extends 'file'\n  ? LineEventBaseProps\n  : DiffLineEventBaseProps;\n\ninterface ExpandoEventProps {\n  type: 'line-info';\n  hunkIndex: number;\n  direction: ExpansionDirections;\n}\n\nexport type GetHoveredLineResult<TMode extends MouseEventManagerMode> =\n  TMode extends 'file'\n    ? { lineNumber: number }\n    : { lineNumber: number; side: AnnotationSide };\n\ntype GetLineDataResult<TMode extends MouseEventManagerMode> =\n  TMode extends 'file'\n    ? LineEventBaseProps | ExpandoEventProps | undefined\n    : DiffLineEventBaseProps | ExpandoEventProps | undefined;\n\ntype LineEventData<TMode extends MouseEventManagerMode> = TMode extends 'file'\n  ? LineEventBaseProps\n  : DiffLineEventBaseProps;\n\nfunction isLineEventData<TMode extends MouseEventManagerMode>(\n  data: GetLineDataResult<TMode>,\n  mode: TMode\n): data is LineEventData<TMode> {\n  if (data == null) return false;\n  if (mode === 'file') {\n    return data.type === 'line';\n  } else {\n    return data.type === 'diff-line';\n  }\n}\n\nfunction isExpandoEventData(\n  data:\n    | LineEventBaseProps\n    | DiffLineEventBaseProps\n    | ExpandoEventProps\n    | undefined\n): data is ExpandoEventProps {\n  return data?.type === 'line-info';\n}\n\nexport interface MouseEventManagerBaseOptions<\n  TMode extends MouseEventManagerMode,\n> {\n  enableHoverUtility?: boolean;\n  onLineClick?(props: EventClickProps<TMode>): unknown;\n  onLineNumberClick?(props: EventClickProps<TMode>): unknown;\n  onLineEnter?(props: MouseEventEnterLeaveProps<TMode>): unknown;\n  onLineLeave?(props: MouseEventEnterLeaveProps<TMode>): unknown;\n  __debugMouseEvents?: LogTypes;\n}\n\nexport interface MouseEventManagerOptions<TMode extends MouseEventManagerMode>\n  extends MouseEventManagerBaseOptions<TMode> {\n  onHunkExpand?(hunkIndex: number, direction: ExpansionDirections): unknown;\n}\n\nexport class MouseEventManager<TMode extends MouseEventManagerMode> {\n  private hoveredLine: EventBaseProps<TMode> | undefined;\n  private pre: HTMLPreElement | undefined;\n  private hoverSlot: HTMLDivElement | undefined;\n\n  constructor(\n    private mode: TMode,\n    private options: MouseEventManagerOptions<TMode>\n  ) {}\n\n  setOptions(options: MouseEventManagerOptions<TMode>): void {\n    this.options = options;\n  }\n\n  cleanUp(): void {\n    this.pre?.removeEventListener('click', this.handleMouseClick);\n    this.pre?.removeEventListener('mousemove', this.handleMouseMove);\n    this.pre?.removeEventListener('mouseout', this.handleMouseLeave);\n    delete this.pre?.dataset.interactiveLines;\n    delete this.pre?.dataset.interactiveLineNumbers;\n    this.pre = undefined;\n  }\n\n  setup(pre: HTMLPreElement): void {\n    const {\n      __debugMouseEvents,\n      onLineClick,\n      onLineNumberClick,\n      onLineEnter,\n      onLineLeave,\n      onHunkExpand,\n      enableHoverUtility = false,\n    } = this.options;\n\n    this.cleanUp();\n    this.pre = pre;\n\n    if (enableHoverUtility && this.hoverSlot == null) {\n      this.hoverSlot = document.createElement('div');\n      this.hoverSlot.dataset.hoverSlot = '';\n      const slotElement = document.createElement('slot');\n      slotElement.name = 'hover-slot';\n      this.hoverSlot.appendChild(slotElement);\n    } else if (!enableHoverUtility && this.hoverSlot != null) {\n      this.hoverSlot.parentNode?.removeChild(this.hoverSlot);\n      this.hoverSlot = undefined;\n    }\n\n    if (\n      onLineClick != null ||\n      onLineNumberClick != null ||\n      onHunkExpand != null\n    ) {\n      pre.addEventListener('click', this.handleMouseClick);\n      if (onLineClick != null) {\n        pre.dataset.interactiveLines = '';\n      } else if (onLineNumberClick != null) {\n        pre.dataset.interactiveLineNumbers = '';\n      }\n      debugLogIfEnabled(\n        __debugMouseEvents,\n        'click',\n        'FileDiff.DEBUG.attachEventListeners: Attaching click events for:',\n        (() => {\n          const reasons: string[] = [];\n          if (__debugMouseEvents === 'both' || __debugMouseEvents === 'click') {\n            if (onLineClick != null) {\n              reasons.push('onLineClick');\n            }\n            if (onLineNumberClick != null) {\n              reasons.push('onLineNumberClick');\n            }\n            if (onHunkExpand != null) {\n              reasons.push('expandable hunk separators');\n            }\n          }\n          return reasons;\n        })()\n      );\n    }\n    if (onLineEnter != null || onLineLeave != null || enableHoverUtility) {\n      pre.addEventListener('mousemove', this.handleMouseMove);\n      debugLogIfEnabled(\n        __debugMouseEvents,\n        'move',\n        'FileDiff.DEBUG.attachEventListeners: Attaching mouse move event'\n      );\n      pre.addEventListener('mouseleave', this.handleMouseLeave);\n      debugLogIfEnabled(\n        __debugMouseEvents,\n        'move',\n        'FileDiff.DEBUG.attachEventListeners: Attaching mouse leave event'\n      );\n    }\n  }\n\n  getHoveredLine = (): GetHoveredLineResult<TMode> | undefined => {\n    if (this.hoveredLine != null) {\n      if (this.mode === 'diff' && this.hoveredLine.type === 'diff-line') {\n        return {\n          lineNumber: this.hoveredLine.lineNumber,\n          side: this.hoveredLine.annotationSide,\n        } as GetHoveredLineResult<TMode>;\n      }\n      if (this.mode === 'file' && this.hoveredLine.type === 'line') {\n        return {\n          lineNumber: this.hoveredLine.lineNumber,\n        } as GetHoveredLineResult<TMode>;\n      }\n    }\n    return undefined;\n  };\n\n  handleMouseClick = (event: MouseEvent): void => {\n    debugLogIfEnabled(\n      this.options.__debugMouseEvents,\n      'click',\n      'FileDiff.DEBUG.handleMouseClick:',\n      event\n    );\n    this.handleMouseEvent({ eventType: 'click', event });\n  };\n\n  handleMouseMove = (event: MouseEvent): void => {\n    debugLogIfEnabled(\n      this.options.__debugMouseEvents,\n      'move',\n      'FileDiff.DEBUG.handleMouseMove:',\n      event\n    );\n    this.handleMouseEvent({ eventType: 'move', event });\n  };\n\n  handleMouseLeave = (event: MouseEvent): void => {\n    const { __debugMouseEvents } = this.options;\n    debugLogIfEnabled(\n      __debugMouseEvents,\n      'move',\n      'FileDiff.DEBUG.handleMouseLeave: no event'\n    );\n    if (this.hoveredLine == null) {\n      debugLogIfEnabled(\n        __debugMouseEvents,\n        'move',\n        'FileDiff.DEBUG.handleMouseLeave: returned early, no .hoveredLine'\n      );\n      return;\n    }\n    this.hoverSlot?.parentElement?.removeChild(this.hoverSlot);\n    this.options.onLineLeave?.({\n      ...this.hoveredLine,\n      event,\n    } as MouseEventEnterLeaveProps<TMode>);\n    this.hoveredLine = undefined;\n  };\n\n  private handleMouseEvent({ eventType, event }: HandleMouseEventProps) {\n    const { __debugMouseEvents } = this.options;\n    const composedPath = event.composedPath();\n    debugLogIfEnabled(\n      __debugMouseEvents,\n      eventType,\n      'FileDiff.DEBUG.handleMouseEvent:',\n      { eventType, composedPath }\n    );\n    const data = this.getLineData(composedPath);\n    debugLogIfEnabled(\n      __debugMouseEvents,\n      eventType,\n      'FileDiff.DEBUG.handleMouseEvent: getLineData result:',\n      data\n    );\n    const {\n      onLineClick,\n      onLineNumberClick,\n      onLineEnter,\n      onLineLeave,\n      onHunkExpand,\n    } = this.options;\n    switch (eventType) {\n      case 'move': {\n        if (\n          isLineEventData(data, this.mode) &&\n          this.hoveredLine?.lineElement === data.lineElement\n        ) {\n          debugLogIfEnabled(\n            __debugMouseEvents,\n            'move',\n            \"FileDiff.DEBUG.handleMouseEvent: switch, 'move', returned early because same line\"\n          );\n          break;\n        }\n        if (this.hoveredLine != null) {\n          debugLogIfEnabled(\n            __debugMouseEvents,\n            'move',\n            \"FileDiff.DEBUG.handleMouseEvent: switch, 'move', clearing an existing hovered line and firing onLineLeave\"\n          );\n          this.hoverSlot?.parentElement?.removeChild(this.hoverSlot);\n          onLineLeave?.({\n            ...this.hoveredLine,\n            event,\n          } as MouseEventEnterLeaveProps<TMode>);\n          this.hoveredLine = undefined;\n        }\n        if (isLineEventData(data, this.mode)) {\n          debugLogIfEnabled(\n            __debugMouseEvents,\n            'move',\n            \"FileDiff.DEBUG.handleMouseEvent: switch, 'move', setting up a new hoveredLine and firing onLineEnter\"\n          );\n          this.hoveredLine = data;\n          if (this.hoverSlot != null) {\n            data.numberElement?.appendChild(this.hoverSlot);\n          }\n          onLineEnter?.({\n            ...this.hoveredLine,\n            event,\n          } as MouseEventEnterLeaveProps<TMode>);\n        }\n        break;\n      }\n      case 'click':\n        debugLogIfEnabled(\n          __debugMouseEvents,\n          'click',\n          \"FileDiff.DEBUG.handleMouseEvent: switch, 'click', with data:\",\n          data\n        );\n        if (data == null) break;\n        if (isExpandoEventData(data) && onHunkExpand != null) {\n          debugLogIfEnabled(\n            __debugMouseEvents,\n            'click',\n            \"FileDiff.DEBUG.handleMouseEvent: switch, 'click', expanding a hunk\"\n          );\n          onHunkExpand(data.hunkIndex, data.direction);\n          break;\n        }\n        if (isLineEventData(data, this.mode)) {\n          if (onLineNumberClick != null && data.numberColumn) {\n            debugLogIfEnabled(\n              __debugMouseEvents,\n              'click',\n              \"FileDiff.DEBUG.handleMouseEvent: switch, 'click', firing 'onLineNumberClick'\"\n            );\n            onLineNumberClick({ ...data, event } as EventClickProps<TMode>);\n          } else if (onLineClick != null) {\n            debugLogIfEnabled(\n              __debugMouseEvents,\n              'click',\n              \"FileDiff.DEBUG.handleMouseEvent: switch, 'click', firing 'onLineClick'\"\n            );\n            onLineClick({ ...data, event } as EventClickProps<TMode>);\n          } else {\n            debugLogIfEnabled(\n              __debugMouseEvents,\n              'click',\n              \"FileDiff.DEBUG.handleMouseEvent: switch, 'click', fell through, no event to fire\"\n            );\n          }\n        }\n        break;\n    }\n  }\n\n  private getLineData(\n    path: (EventTarget | undefined)[]\n  ): GetLineDataResult<TMode> {\n    let numberColumn = false;\n    const lineElement = path.find((element) => {\n      if (!(element instanceof HTMLElement)) {\n        return false;\n      }\n      numberColumn = numberColumn || 'columnNumber' in element.dataset;\n      return 'line' in element.dataset || 'expandIndex' in element.dataset;\n    });\n    if (!(lineElement instanceof HTMLElement)) return undefined;\n    if (lineElement.dataset.expandIndex != null) {\n      const hunkIndex = parseInt(lineElement.dataset.expandIndex);\n      if (isNaN(hunkIndex)) {\n        return undefined;\n      }\n      let direction: ExpansionDirections | undefined;\n      for (const element of path) {\n        if (element === lineElement) break;\n        if (element instanceof HTMLElement) {\n          direction =\n            direction ??\n            ('expandUp' in element.dataset ? 'up' : undefined) ??\n            ('expandDown' in element.dataset ? 'down' : undefined) ??\n            ('expandBoth' in element.dataset ? 'both' : undefined);\n          if (direction != null) {\n            break;\n          }\n        }\n      }\n      return direction != null\n        ? { type: 'line-info', hunkIndex, direction }\n        : undefined;\n    }\n    const lineNumber = parseInt(lineElement.dataset.line ?? '');\n    if (isNaN(lineNumber)) return;\n    const lineType = lineElement.dataset.lineType;\n    if (\n      lineType !== 'context' &&\n      lineType !== 'context-expanded' &&\n      lineType !== 'change-deletion' &&\n      lineType !== 'change-addition'\n    ) {\n      return undefined;\n    }\n\n    const numberElement = (() => {\n      const numberElement = lineElement.children[0];\n      return numberElement instanceof HTMLElement &&\n        numberElement.dataset.columnNumber != null\n        ? numberElement\n        : undefined;\n    })();\n\n    if (this.mode === 'file') {\n      return {\n        type: 'line',\n        lineElement,\n        lineNumber,\n        numberElement,\n        numberColumn,\n      } as GetLineDataResult<TMode>;\n    }\n\n    const annotationSide: AnnotationSide = (() => {\n      if (lineType === 'change-deletion') {\n        return 'deletions';\n      }\n      if (lineType === 'change-addition') {\n        return 'additions';\n      }\n      const parent = lineElement.closest('[data-code]');\n      if (!(parent instanceof HTMLElement)) {\n        return 'additions';\n      }\n      return 'deletions' in parent.dataset ? 'deletions' : 'additions';\n    })();\n\n    return {\n      type: 'diff-line',\n      annotationSide,\n      lineType,\n      lineElement,\n      numberElement,\n      lineNumber,\n      numberColumn,\n    } as GetLineDataResult<TMode>;\n  }\n}\n\nfunction debugLogIfEnabled(\n  debugLogType: LogTypes | undefined = 'none',\n  logIfType: 'move' | 'click',\n  ...args: unknown[]\n) {\n  switch (debugLogType) {\n    case 'none':\n      return;\n    case 'both':\n      break;\n    case 'click':\n      if (logIfType !== 'click') {\n        return;\n      }\n      break;\n    case 'move':\n      if (logIfType !== 'move') {\n        return;\n      }\n      break;\n  }\n  console.log(...args);\n}\n\nexport function pluckMouseEventOptions<TMode extends MouseEventManagerMode>(\n  {\n    onLineClick,\n    onLineNumberClick,\n    onLineEnter,\n    onLineLeave,\n    enableHoverUtility,\n    __debugMouseEvents,\n  }: MouseEventManagerBaseOptions<TMode>,\n  onHunkExpand?: (hunkIndex: number, direction: ExpansionDirections) => unknown\n): MouseEventManagerOptions<TMode> {\n  return {\n    onLineClick,\n    onLineNumberClick,\n    onLineEnter,\n    onLineLeave,\n    enableHoverUtility,\n    __debugMouseEvents,\n    onHunkExpand,\n  };\n}\n", "import type { ObservedAnnotationNodes, ObservedGridNodes } from '../types';\n\nexport class ResizeManager {\n  private observedNodes = new Map<\n    HTMLElement,\n    ObservedAnnotationNodes | ObservedGridNodes\n  >();\n\n  cleanUp(): void {\n    // Disconnect any existing observer\n    this.resizeObserver?.disconnect();\n    this.observedNodes.clear();\n  }\n\n  private resizeObserver: ResizeObserver | undefined;\n\n  setup(pre: HTMLPreElement): void {\n    this.cleanUp();\n\n    const annotationElements = pre.querySelectorAll(\n      '[data-line-annotation*=\",\"]'\n    );\n\n    this.resizeObserver ??= new ResizeObserver(this.handleResizeObserver);\n    const codeElements = pre.querySelectorAll('code');\n\n    for (const codeElement of codeElements) {\n      let numberElement = codeElement.querySelector('[data-column-number]');\n      if (!(numberElement instanceof HTMLElement)) {\n        numberElement = null;\n      }\n      const item: ObservedGridNodes = {\n        type: 'code',\n        codeElement,\n        numberElement,\n        codeWidth: 'auto',\n        numberWidth: 0,\n      };\n      this.observedNodes.set(codeElement, item);\n      this.resizeObserver.observe(codeElement);\n      if (numberElement != null) {\n        this.observedNodes.set(numberElement, item);\n        this.resizeObserver.observe(numberElement);\n      }\n    }\n\n    if (codeElements.length <= 1) {\n      return;\n    }\n\n    const elementMap = new Map<string, HTMLElement[]>();\n    for (const element of annotationElements) {\n      if (!(element instanceof HTMLElement)) {\n        continue;\n      }\n      const { lineAnnotation = '' } = element.dataset;\n      if (!/^\\d+,\\d+$/.test(lineAnnotation)) {\n        console.error(\n          'DiffFileRenderer.setupResizeObserver: Invalid element or annotation',\n          { lineAnnotation, element }\n        );\n        continue;\n      }\n      let pairs = elementMap.get(lineAnnotation);\n      if (pairs == null) {\n        pairs = [];\n        elementMap.set(lineAnnotation, pairs);\n      }\n      pairs.push(element);\n    }\n\n    for (const [key, pair] of elementMap) {\n      if (pair.length !== 2) {\n        console.error(\n          'DiffFileRenderer.setupResizeObserver: Bad Pair',\n          key,\n          pair\n        );\n        continue;\n      }\n      const [container1, container2] = pair;\n      const child1 = container1.firstElementChild;\n      const child2 = container2.firstElementChild;\n      if (\n        !(container1 instanceof HTMLElement) ||\n        !(container2 instanceof HTMLElement) ||\n        !(child1 instanceof HTMLElement) ||\n        !(child2 instanceof HTMLElement)\n      ) {\n        continue;\n      }\n      const item: ObservedAnnotationNodes = {\n        type: 'annotations',\n        column1: {\n          container: container1,\n          child: child1,\n          childHeight: 0,\n        },\n        column2: {\n          container: container2,\n          child: child2,\n          childHeight: 0,\n        },\n        currentHeight: 'auto',\n      };\n      this.observedNodes.set(child1, item);\n      this.observedNodes.set(child2, item);\n      this.resizeObserver.observe(child1);\n      this.resizeObserver.observe(child2);\n    }\n  }\n\n  private handleResizeObserver = (entries: ResizeObserverEntry[]) => {\n    for (const entry of entries) {\n      const { target, borderBoxSize } = entry;\n      if (!(target instanceof HTMLElement)) {\n        console.error(\n          'FileDiff.handleResizeObserver: Invalid element for ResizeObserver',\n          entry\n        );\n        continue;\n      }\n      const item = this.observedNodes.get(target);\n      if (item == null) {\n        console.error(\n          'FileDiff.handleResizeObserver: Not a valid observed node',\n          entry\n        );\n        continue;\n      }\n      const specs = borderBoxSize[0];\n      if (item.type === 'annotations') {\n        const column = (() => {\n          if (target === item.column1.child) {\n            return item.column1;\n          }\n          if (target === item.column2.child) {\n            return item.column2;\n          }\n          return undefined;\n        })();\n\n        if (column == null) {\n          console.error(\n            `FileDiff.handleResizeObserver: Couldn't find a column for`,\n            { item, target }\n          );\n          continue;\n        }\n\n        column.childHeight = specs.blockSize;\n        const newHeight = Math.max(\n          item.column1.childHeight,\n          item.column2.childHeight\n        );\n        if (newHeight !== item.currentHeight) {\n          item.currentHeight = Math.max(newHeight, 0);\n          item.column1.container.style.setProperty(\n            '--diffs-annotation-min-height',\n            `${item.currentHeight}px`\n          );\n          item.column2.container.style.setProperty(\n            '--diffs-annotation-min-height',\n            `${item.currentHeight}px`\n          );\n        }\n      } else if (item.type === 'code') {\n        if (target === item.codeElement) {\n          if (specs.inlineSize !== item.codeWidth) {\n            item.codeWidth = specs.inlineSize;\n            item.codeElement.style.setProperty(\n              '--diffs-column-content-width',\n              `${Math.max(item.codeWidth - item.numberWidth, 0)}px`\n            );\n            item.codeElement.style.setProperty(\n              '--diffs-column-width',\n              `${item.codeWidth}px`\n            );\n          }\n        } else if (target === item.numberElement) {\n          if (specs.inlineSize !== item.numberWidth) {\n            item.numberWidth = specs.inlineSize;\n            item.codeElement.style.setProperty(\n              '--diffs-column-number-width',\n              `${item.numberWidth}px`\n            );\n            // We probably need to update code width variable if\n            // `numberWidth` changed\n            if (item.codeWidth !== 'auto') {\n              item.codeElement.style.setProperty(\n                '--diffs-column-content-width',\n                `${Math.max(item.codeWidth - item.numberWidth, 0)}px`\n              );\n            }\n          }\n        }\n      }\n    }\n  };\n}\n", "import type { SupportedLanguages } from '../../types';\nimport { AttachedLanguages } from './constants';\n\nexport function areLanguagesAttached(\n  languages: SupportedLanguages | SupportedLanguages[]\n): boolean {\n  for (const language of Array.isArray(languages) ? languages : [languages]) {\n    if (!AttachedLanguages.has(language)) {\n      return false;\n    }\n  }\n  return true;\n}\n", "import type { DiffsThemeNames, ThemesType } from '../../types';\nimport { getThemes } from '../../utils/getThemes';\nimport { AttachedThemes } from './constants';\n\nexport function areThemesAttached(\n  themes: DiffsThemeNames | ThemesType\n): boolean {\n  for (const theme of getThemes(themes)) {\n    if (!AttachedThemes.has(theme)) {\n      return false;\n    }\n  }\n  return true;\n}\n", "import type { Element as HASTElement } from 'hast';\n\nimport type { AnnotationSpan } from '../types';\nimport { createHastElement } from './hast_utils';\n\nexport function createAnnotationElement(span: AnnotationSpan): HASTElement {\n  return createHastElement({\n    tagName: 'div',\n    children: [\n      createHastElement({\n        tagName: 'div',\n        children: span.annotations?.map((slotId) =>\n          createHastElement({ tagName: 'slot', properties: { name: slotId } })\n        ),\n        properties: { 'data-annotation-content': '' },\n      }),\n    ],\n    properties: {\n      'data-line-annotation': `${span.hunkIndex},${span.lineIndex}`,\n    },\n  });\n}\n", "import type { SVGSpriteNames } from '../sprite';\nimport type { ChangeTypes } from '../types';\n\nexport function getIconForType(\n  type: ChangeTypes | 'file'\n): Extract<\n  SVGSpriteNames,\n  | 'diffs-icon-file-code'\n  | 'diffs-icon-symbol-modified'\n  | 'diffs-icon-symbol-deleted'\n  | 'diffs-icon-symbol-added'\n  | 'diffs-icon-symbol-moved'\n> {\n  switch (type) {\n    case 'file':\n      return 'diffs-icon-file-code';\n    case 'change':\n      return 'diffs-icon-symbol-modified';\n    case 'new':\n      return 'diffs-icon-symbol-added';\n    case 'deleted':\n      return 'diffs-icon-symbol-deleted';\n    case 'rename-pure':\n    case 'rename-changed':\n      return 'diffs-icon-symbol-moved';\n  }\n}\n", "import type { ElementContent, Element as HASTElement, Properties } from 'hast';\n\nimport { HEADER_METADATA_SLOT_ID } from '../constants';\nimport type {\n  ChangeTypes,\n  FileContents,\n  FileDiffMetadata,\n  ThemeTypes,\n} from '../types';\nimport { getIconForType } from './getIconForType';\nimport {\n  createHastElement,\n  createIconElement,\n  createTextNodeElement,\n} from './hast_utils';\n\nexport interface CreateFileHeaderElementProps {\n  fileOrDiff: FileDiffMetadata | FileContents;\n  themeStyles: string;\n  themeType: ThemeTypes;\n}\n\nexport function createFileHeaderElement({\n  fileOrDiff,\n  themeStyles,\n  themeType,\n}: CreateFileHeaderElementProps): HASTElement {\n  const fileDiff = 'type' in fileOrDiff ? fileOrDiff : undefined;\n  const properties: Properties = {\n    'data-diffs-header': '',\n    'data-change-type': fileDiff?.type,\n    'data-theme-type': themeType !== 'system' ? themeType : undefined,\n    style: themeStyles,\n  };\n\n  return createHastElement({\n    tagName: 'div',\n    children: [\n      createHeaderElement({\n        name: fileOrDiff.name,\n        prevName: 'prevName' in fileOrDiff ? fileOrDiff.prevName : undefined,\n        iconType: fileDiff?.type ?? 'file',\n      }),\n      createMetadataElement(fileDiff),\n    ],\n    properties,\n  });\n}\n\ninterface CreateHeaderElementOptions {\n  name: string;\n  prevName?: string;\n  iconType: ChangeTypes | 'file';\n}\n\nfunction createHeaderElement({\n  name,\n  prevName,\n  iconType,\n}: CreateHeaderElementOptions): HASTElement {\n  const children: ElementContent[] = [\n    createIconElement({\n      name: getIconForType(iconType),\n      properties: { 'data-change-icon': iconType },\n    }),\n  ];\n  if (prevName != null) {\n    children.push(\n      createHastElement({\n        tagName: 'div',\n        children: [createTextNodeElement(prevName)],\n        properties: {\n          'data-prev-name': '',\n        },\n      })\n    );\n    children.push(\n      createIconElement({\n        name: 'diffs-icon-arrow-right-short',\n        properties: {\n          'data-rename-icon': '',\n        },\n      })\n    );\n  }\n  children.push(\n    createHastElement({\n      tagName: 'div',\n      children: [createTextNodeElement(name)],\n      properties: { 'data-title': '' },\n    })\n  );\n  return createHastElement({\n    tagName: 'div',\n    children,\n    properties: { 'data-header-content': '' },\n  });\n}\n\nfunction createMetadataElement(\n  fileDiff: FileDiffMetadata | undefined\n): HASTElement {\n  const children: ElementContent[] = [];\n  if (fileDiff != null) {\n    let additions = 0;\n    let deletions = 0;\n    for (const hunk of fileDiff.hunks) {\n      additions += hunk.additionLines;\n      deletions += hunk.deletionLines;\n    }\n    if (deletions > 0 || additions === 0) {\n      children.push(\n        createHastElement({\n          tagName: 'span',\n          children: [createTextNodeElement(`-${deletions}`)],\n          properties: { 'data-deletions-count': '' },\n        })\n      );\n    }\n    if (additions > 0 || deletions === 0) {\n      children.push(\n        createHastElement({\n          tagName: 'span',\n          children: [createTextNodeElement(`+${additions}`)],\n          properties: { 'data-additions-count': '' },\n        })\n      );\n    }\n  }\n  children.push(\n    createHastElement({\n      tagName: 'slot',\n      properties: { name: HEADER_METADATA_SLOT_ID },\n    })\n  );\n  return createHastElement({\n    tagName: 'div',\n    children,\n    properties: { 'data-metadata': '' },\n  });\n}\n", "import type { Element as HASTElement, Properties } from 'hast';\n\nimport type { PrePropertiesConfig } from '../types';\nimport { createHastElement } from './hast_utils';\n\nexport function createPreElement(options: PrePropertiesConfig): HASTElement {\n  return createHastElement({\n    tagName: 'pre',\n    properties: createPreWrapperProperties(options),\n  });\n}\n\nexport function createPreWrapperProperties({\n  diffIndicators,\n  disableBackground,\n  disableLineNumbers,\n  overflow,\n  split,\n  themeType,\n  themeStyles,\n  totalLines,\n}: PrePropertiesConfig): Properties {\n  const properties: Properties = {\n    'data-diffs': '',\n    'data-type': split ? 'split' : 'file',\n    'data-overflow': overflow,\n    'data-disable-line-numbers': disableLineNumbers ? '' : undefined,\n    'data-background': !disableBackground ? '' : undefined,\n    'data-indicators':\n      diffIndicators === 'bars' || diffIndicators === 'classic'\n        ? diffIndicators\n        : undefined,\n    'data-theme-type': themeType !== 'system' ? themeType : undefined,\n    // NOTE(amadeus): Alex, here we would probably set a class property\n    // instead, when that's working and supported\n    style: themeStyles,\n    tabIndex: 0,\n  };\n  properties.style += `--diffs-min-number-column-width-default:${`${totalLines}`.length}ch;`;\n\n  return properties;\n}\n", "import type { DiffsThemeNames, SupportedLanguages, ThemesType } from '../types';\nimport { getThemes } from './getThemes';\n\ninterface HighlighterOptionsShape {\n  theme?: DiffsThemeNames | ThemesType;\n}\n\ninterface GetHighlighterOptionsReturn {\n  langs: SupportedLanguages[];\n  themes: DiffsThemeNames[];\n}\n\nexport function getHighlighterOptions(\n  lang: SupportedLanguages | undefined,\n  options: HighlighterOptionsShape\n): GetHighlighterOptionsReturn {\n  return {\n    langs: [lang ?? 'text'],\n    themes: getThemes(options.theme),\n  };\n}\n", "import type { DiffLineAnnotation, LineAnnotation } from '../types';\n\nexport function getLineAnnotationName<T = undefined>(\n  annotation: LineAnnotation<T> | DiffLineAnnotation<T>\n): string {\n  return `annotation-${'side' in annotation ? `${annotation.side}-` : ''}${annotation.lineNumber}`;\n}\n", "import type { ElementContent, Element as HASTElement } from 'hast';\nimport { toHtml } from 'hast-util-to-html';\n\nimport { DEFAULT_THEMES } from '../constants';\nimport { areLanguagesAttached } from '../highlighter/languages/areLanguagesAttached';\nimport {\n  getHighlighterIfLoaded,\n  getSharedHighlighter,\n} from '../highlighter/shared_highlighter';\nimport { areThemesAttached } from '../highlighter/themes/areThemesAttached';\nimport { hasResolvedThemes } from '../highlighter/themes/hasResolvedThemes';\nimport type {\n  BaseCodeOptions,\n  DiffsHighlighter,\n  FileContents,\n  LineAnnotation,\n  RenderFileOptions,\n  RenderFileResult,\n  RenderedFileASTCache,\n  SupportedLanguages,\n  ThemeTypes,\n  ThemedFileResult,\n} from '../types';\nimport { areThemesEqual } from '../utils/areThemesEqual';\nimport { createAnnotationElement } from '../utils/createAnnotationElement';\nimport { createFileHeaderElement } from '../utils/createFileHeaderElement';\nimport { createPreElement } from '../utils/createPreElement';\nimport { getFiletypeFromFileName } from '../utils/getFiletypeFromFileName';\nimport { getHighlighterOptions } from '../utils/getHighlighterOptions';\nimport { getLineAnnotationName } from '../utils/getLineAnnotationName';\nimport { getThemes } from '../utils/getThemes';\nimport { createHastElement } from '../utils/hast_utils';\nimport { renderFileWithHighlighter } from '../utils/renderFileWithHighlighter';\nimport type { WorkerPoolManager } from '../worker';\n\ntype AnnotationLineMap<LAnnotation> = Record<\n  number,\n  LineAnnotation<LAnnotation>[] | undefined\n>;\n\ninterface GetRenderOptionsReturn {\n  options: RenderFileOptions;\n  forceRender: boolean;\n}\n\nexport interface FileRenderResult {\n  codeAST: ElementContent[];\n  preAST: HASTElement;\n  headerAST: HASTElement | undefined;\n  css: string;\n  totalLines: number;\n  themeStyles: string;\n  baseThemeType: 'light' | 'dark' | undefined;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface FileRendererOptions extends BaseCodeOptions {}\n\nexport class FileRenderer<LAnnotation = undefined> {\n  private highlighter: DiffsHighlighter | undefined;\n  private renderCache: RenderedFileASTCache | undefined;\n  private computedLang: SupportedLanguages = 'text';\n  private lineAnnotations: AnnotationLineMap<LAnnotation> = {};\n\n  constructor(\n    public options: FileRendererOptions = { theme: DEFAULT_THEMES },\n    private onRenderUpdate?: () => unknown,\n    private workerManager?: WorkerPoolManager | undefined\n  ) {\n    if (workerManager?.isWorkingPool() !== true) {\n      this.highlighter = areThemesAttached(options.theme ?? DEFAULT_THEMES)\n        ? getHighlighterIfLoaded()\n        : undefined;\n    }\n  }\n\n  setOptions(options: FileRendererOptions): void {\n    this.options = options;\n  }\n\n  private mergeOptions(options: Partial<FileRendererOptions>): void {\n    this.options = { ...this.options, ...options };\n  }\n\n  setThemeType(themeType: ThemeTypes): void {\n    const currentThemeType = this.options.themeType ?? 'system';\n    if (currentThemeType === themeType) {\n      return;\n    }\n    this.mergeOptions({ themeType });\n  }\n\n  setLineAnnotations(lineAnnotations: LineAnnotation<LAnnotation>[]): void {\n    this.lineAnnotations = {};\n    for (const annotation of lineAnnotations) {\n      const arr = this.lineAnnotations[annotation.lineNumber] ?? [];\n      this.lineAnnotations[annotation.lineNumber] = arr;\n      arr.push(annotation);\n    }\n  }\n\n  cleanUp(): void {\n    this.renderCache = undefined;\n    this.highlighter = undefined;\n    this.workerManager = undefined;\n    this.onRenderUpdate = undefined;\n  }\n\n  hydrate(file: FileContents): void {\n    const { options } = this.getRenderOptions(file);\n    let cache = this.workerManager?.getFileResultCache(file);\n    if (cache != null && !areRenderOptionsEqual(options, cache.options)) {\n      cache = undefined;\n    }\n    this.renderCache ??= {\n      file,\n      options,\n      // NOTE(amadeus): If we're hydrating, we can assume there was\n      // pre-rendered HTML, otherwise one should not be hydrating\n      highlighted: true,\n      result: cache?.result,\n    };\n    if (\n      this.workerManager?.isWorkingPool() === true &&\n      this.renderCache.result == null\n    ) {\n      this.workerManager.highlightFileAST(this, file);\n    } else {\n      void this.asyncHighlight(file).then(({ result, options }) => {\n        this.onHighlightSuccess(file, result, options);\n      });\n    }\n  }\n\n  private getRenderOptions(file: FileContents): GetRenderOptionsReturn {\n    const options: RenderFileOptions = (() => {\n      if (this.workerManager?.isWorkingPool() === true) {\n        return this.workerManager.getFileRenderOptions();\n      }\n      const { theme = DEFAULT_THEMES, tokenizeMaxLineLength = 1000 } =\n        this.options;\n      return { theme, tokenizeMaxLineLength };\n    })();\n    const { renderCache } = this;\n    if (renderCache?.result == null) {\n      return { options, forceRender: true };\n    }\n    if (\n      file !== renderCache.file ||\n      !areRenderOptionsEqual(options, renderCache.options)\n    ) {\n      return { options, forceRender: true };\n    }\n    return { options, forceRender: false };\n  }\n\n  renderFile(\n    file: FileContents | undefined = this.renderCache?.file\n  ): FileRenderResult | undefined {\n    if (file == null) {\n      return undefined;\n    }\n    const cache = this.workerManager?.getFileResultCache(file);\n    if (cache != null && this.renderCache == null) {\n      this.renderCache = { file, highlighted: true, ...cache };\n    }\n    const { options, forceRender } = this.getRenderOptions(file);\n    this.renderCache ??= {\n      file,\n      highlighted: false,\n      options,\n      result: undefined,\n    };\n    if (this.workerManager?.isWorkingPool() === true) {\n      this.renderCache.result ??= this.workerManager.getPlainFileAST(file);\n      // TODO(amadeus): Figure out how to only fire this on a per file\n      // basis... (maybe the poolManager can figure it out based on file name\n      // and file contents probably?)\n      if (!this.renderCache.highlighted || forceRender) {\n        this.workerManager.highlightFileAST(this, file);\n      }\n    } else {\n      this.computedLang = file.lang ?? getFiletypeFromFileName(file.name);\n      const hasThemes =\n        this.highlighter != null && areThemesAttached(options.theme);\n      const hasLangs =\n        this.highlighter != null && areLanguagesAttached(this.computedLang);\n\n      // If we have any semblance of a highlighter with the correct theme(s)\n      // attached, we can kick off some form of rendering.  If we don't have\n      // the correct language, then we can render plain text and after kick off\n      // an async job to get the highlighted AST\n      if (\n        this.highlighter != null &&\n        hasThemes &&\n        (forceRender ||\n          (!this.renderCache.highlighted && hasLangs) ||\n          this.renderCache.result == null)\n      ) {\n        const { result, options } = this.renderFileWithHighlighter(\n          file,\n          this.highlighter,\n          !hasLangs\n        );\n        this.renderCache = {\n          file,\n          options,\n          highlighted: hasLangs,\n          result,\n        };\n      }\n\n      // If we get in here it means we'll have to kick off an async highlight\n      // process which will involve initializing the highlighter with new themes\n      // and languages\n      if (!hasThemes || !hasLangs) {\n        void this.asyncHighlight(file).then(({ result, options }) => {\n          this.onHighlightSuccess(file, result, options);\n        });\n      }\n    }\n\n    return this.renderCache.result != null\n      ? this.processFileResult(this.renderCache.file, this.renderCache.result)\n      : undefined;\n  }\n\n  async asyncRender(file: FileContents): Promise<FileRenderResult> {\n    const { result } = await this.asyncHighlight(file);\n    return this.processFileResult(file, result);\n  }\n\n  private async asyncHighlight(file: FileContents): Promise<RenderFileResult> {\n    this.computedLang = file.lang ?? getFiletypeFromFileName(file.name);\n    const hasThemes =\n      this.highlighter != null &&\n      hasResolvedThemes(getThemes(this.options.theme));\n    const hasLangs =\n      this.highlighter != null && areLanguagesAttached(this.computedLang);\n    // If we don't have the required langs or themes, then we need to\n    // initialize the highlighter to load the appropriate languages and themes\n    if (this.highlighter == null || !hasThemes || !hasLangs) {\n      this.highlighter = await this.initializeHighlighter();\n    }\n    return this.renderFileWithHighlighter(file, this.highlighter);\n  }\n\n  private renderFileWithHighlighter(\n    file: FileContents,\n    highlighter: DiffsHighlighter,\n    plainText = false\n  ): RenderFileResult {\n    const { options } = this.getRenderOptions(file);\n    const result = renderFileWithHighlighter(\n      file,\n      highlighter,\n      options,\n      plainText\n    );\n    return { result, options };\n  }\n\n  private processFileResult(\n    file: FileContents,\n    result: ThemedFileResult\n  ): FileRenderResult {\n    const { disableFileHeader = false } = this.options;\n    const codeAST: ElementContent[] = [];\n    let lineIndex = 1;\n    for (const line of result.code) {\n      codeAST.push(line);\n      const annotations = this.lineAnnotations[lineIndex];\n      if (annotations != null) {\n        codeAST.push(\n          createAnnotationElement({\n            type: 'annotation',\n            hunkIndex: 0,\n            lineIndex,\n            annotations: annotations.map((annotation) =>\n              getLineAnnotationName(annotation)\n            ),\n          })\n        );\n      }\n      lineIndex++;\n    }\n\n    return {\n      codeAST,\n      preAST: this.createPreElement(\n        result.code.length,\n        result.themeStyles,\n        result.baseThemeType\n      ),\n      headerAST: !disableFileHeader\n        ? this.renderHeader(file, result.themeStyles, result.baseThemeType)\n        : undefined,\n      totalLines: result.code.length,\n      themeStyles: result.themeStyles,\n      baseThemeType: result.baseThemeType,\n      // FIXME(amadeus): Fix this\n      css: '',\n    };\n  }\n\n  private renderHeader(\n    file: FileContents,\n    themeStyles: string,\n    baseThemeType: 'light' | 'dark' | undefined\n  ) {\n    const { themeType = 'system' } = this.options;\n    return createFileHeaderElement({\n      fileOrDiff: file,\n      themeStyles,\n      themeType: baseThemeType ?? themeType,\n    });\n  }\n\n  renderFullHTML(result: FileRenderResult): string {\n    return toHtml(this.renderFullAST(result));\n  }\n\n  renderFullAST(\n    result: FileRenderResult,\n    children: ElementContent[] = []\n  ): HASTElement {\n    children.push(\n      createHastElement({\n        tagName: 'code',\n        children: result.codeAST,\n        properties: { 'data-code': '' },\n      })\n    );\n    return { ...result.preAST, children };\n  }\n\n  renderPartialHTML(\n    children: ElementContent[],\n    includeCodeNode: boolean = false\n  ): string {\n    if (!includeCodeNode) {\n      return toHtml(children);\n    }\n    return toHtml(\n      createHastElement({\n        tagName: 'code',\n        children,\n        properties: { 'data-code': '' },\n      })\n    );\n  }\n\n  async initializeHighlighter(): Promise<DiffsHighlighter> {\n    this.highlighter = await getSharedHighlighter(\n      getHighlighterOptions(this.computedLang, this.options)\n    );\n    return this.highlighter;\n  }\n\n  onHighlightSuccess(\n    file: FileContents,\n    result: ThemedFileResult,\n    options: RenderFileOptions\n  ): void {\n    if (this.renderCache == null) {\n      return;\n    }\n    const triggerRenderUpdate =\n      this.renderCache.file !== file ||\n      !this.renderCache.highlighted ||\n      !areRenderOptionsEqual(options, this.renderCache.options);\n\n    this.renderCache = {\n      file,\n      options,\n      highlighted: true,\n      result,\n    };\n\n    if (triggerRenderUpdate) {\n      this.onRenderUpdate?.();\n    }\n  }\n\n  onHighlightError(error: unknown): void {\n    console.error(error);\n  }\n\n  private createPreElement(\n    totalLines: number,\n    themeStyles: string,\n    baseThemeType: 'light' | 'dark' | undefined\n  ): HASTElement {\n    const {\n      disableLineNumbers = false,\n      overflow = 'scroll',\n      themeType = 'system',\n    } = this.options;\n    return createPreElement({\n      diffIndicators: 'none',\n      disableBackground: true,\n      disableLineNumbers,\n      overflow,\n      themeStyles,\n      themeType: baseThemeType ?? themeType,\n      split: false,\n      totalLines,\n    });\n  }\n}\n\nfunction areRenderOptionsEqual(\n  optionsA: RenderFileOptions,\n  optionsB: RenderFileOptions\n): boolean {\n  return (\n    areThemesEqual(optionsA.theme, optionsB.theme) &&\n    optionsA.tokenizeMaxLineLength === optionsB.tokenizeMaxLineLength\n  );\n}\n", "export type SVGSpriteNames =\n  | 'diffs-icon-arrow-right-short'\n  | 'diffs-icon-brand-github'\n  | 'diffs-icon-chevron'\n  | 'diffs-icon-chevrons-narrow'\n  | 'diffs-icon-diff-split'\n  | 'diffs-icon-diff-unified'\n  | 'diffs-icon-expand'\n  | 'diffs-icon-expand-all'\n  | 'diffs-icon-file-code'\n  | 'diffs-icon-symbol-added'\n  | 'diffs-icon-symbol-deleted'\n  | 'diffs-icon-symbol-diffstat'\n  | 'diffs-icon-symbol-ignored'\n  | 'diffs-icon-symbol-modified'\n  | 'diffs-icon-symbol-moved'\n  | 'diffs-icon-symbol-ref';\n\nexport const SVGSpriteSheet = `<svg data-icon-sprite aria-hidden=\"true\" width=\"0\" height=\"0\">\n  <symbol id=\"diffs-icon-arrow-right-short\" viewBox=\"0 0 16 16\">\n    <path d=\"M8.47 4.22a.75.75 0 0 0 0 1.06l1.97 1.97H3.75a.75.75 0 0 0 0 1.5h6.69l-1.97 1.97a.75.75 0 1 0 1.06 1.06l3.25-3.25a.75.75 0 0 0 0-1.06L9.53 4.22a.75.75 0 0 0-1.06 0\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-brand-github\" viewBox=\"0 0 16 16\">\n    <path d=\"M8 0c4.42 0 8 3.58 8 8a8.01 8.01 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27s-1.36.09-2 .27c-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-chevron\" viewBox=\"0 0 16 16\">\n    <path d=\"M1.47 4.47a.75.75 0 0 1 1.06 0L8 9.94l5.47-5.47a.75.75 0 1 1 1.06 1.06l-6 6a.75.75 0 0 1-1.06 0l-6-6a.75.75 0 0 1 0-1.06\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-chevrons-narrow\" viewBox=\"0 0 10 16\">\n    <path d=\"M4.47 2.22a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 0 1-1.06 1.06L5 3.81 2.28 6.53a.75.75 0 0 1-1.06-1.06zM1.22 9.47a.75.75 0 0 1 1.06 0L5 12.19l2.72-2.72a.75.75 0 0 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0l-3.25-3.25a.75.75 0 0 1 0-1.06\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-diff-split\" viewBox=\"0 0 16 16\">\n    <path d=\"M14 0H8.5v16H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2m-1.5 6.5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0\"/><path d=\"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h5.5V0zm.5 7.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1\" opacity=\".3\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-diff-unified\" viewBox=\"0 0 16 16\">\n    <path fill-rule=\"evenodd\" d=\"M16 14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8.5h16zm-8-4a.5.5 0 0 0-.5.5v1h-1a.5.5 0 0 0 0 1h1v1a.5.5 0 0 0 1 0v-1h1a.5.5 0 0 0 0-1h-1v-1A.5.5 0 0 0 8 10\" clip-rule=\"evenodd\"/><path fill-rule=\"evenodd\" d=\"M14 0a2 2 0 0 1 2 2v5.5H0V2a2 2 0 0 1 2-2zM6.5 3.5a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1z\" clip-rule=\"evenodd\" opacity=\".4\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-expand\" viewBox=\"0 0 16 16\">\n    <path d=\"M3.47 5.47a.75.75 0 0 1 1.06 0L8 8.94l3.47-3.47a.75.75 0 1 1 1.06 1.06l-4 4a.75.75 0 0 1-1.06 0l-4-4a.75.75 0 0 1 0-1.06\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-expand-all\" viewBox=\"0 0 16 16\">\n    <path d=\"M11.47 9.47a.75.75 0 1 1 1.06 1.06l-4 4a.75.75 0 0 1-1.06 0l-4-4a.75.75 0 1 1 1.06-1.06L8 12.94zM7.526 1.418a.75.75 0 0 1 1.004.052l4 4a.75.75 0 1 1-1.06 1.06L8 3.06 4.53 6.53a.75.75 0 1 1-1.06-1.06l4-4z\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-file-code\" viewBox=\"0 0 16 16\">\n    <path d=\"M10.75 0c.199 0 .39.08.53.22l3.5 3.5c.14.14.22.331.22.53v9A2.75 2.75 0 0 1 12.25 16h-8.5A2.75 2.75 0 0 1 1 13.25V2.75A2.75 2.75 0 0 1 3.75 0zm-7 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h8.5c.69 0 1.25-.56 1.25-1.25V5h-1.25A2.25 2.25 0 0 1 10 2.75V1.5z\"/><path d=\"M7.248 6.19a.75.75 0 0 1 .063 1.058L5.753 9l1.558 1.752a.75.75 0 0 1-1.122.996l-2-2.25a.75.75 0 0 1 0-.996l2-2.25a.75.75 0 0 1 1.06-.063M8.69 7.248a.75.75 0 1 1 1.12-.996l2 2.25a.75.75 0 0 1 0 .996l-2 2.25a.75.75 0 1 1-1.12-.996L10.245 9z\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-symbol-added\" viewBox=\"0 0 16 16\">\n    <path d=\"M8 4a.75.75 0 0 1 .75.75v2.5h2.5a.75.75 0 0 1 0 1.5h-2.5v2.5a.75.75 0 0 1-1.5 0v-2.5h-2.5a.75.75 0 0 1 0-1.5h2.5v-2.5A.75.75 0 0 1 8 4\"/><path d=\"M1.788 4.296c.196-.88.478-1.381.802-1.706s.826-.606 1.706-.802C5.194 1.588 6.387 1.5 8 1.5s2.806.088 3.704.288c.88.196 1.381.478 1.706.802s.607.826.802 1.706c.2.898.288 2.091.288 3.704s-.088 2.806-.288 3.704c-.195.88-.478 1.381-.802 1.706s-.826.607-1.706.802c-.898.2-2.091.288-3.704.288s-2.806-.088-3.704-.288c-.88-.195-1.381-.478-1.706-.802s-.606-.826-.802-1.706C1.588 10.806 1.5 9.613 1.5 8s.088-2.806.288-3.704M8 0C1.412 0 0 1.412 0 8s1.412 8 8 8 8-1.412 8-8-1.412-8-8-8\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-symbol-deleted\" viewBox=\"0 0 16 16\">\n    <path d=\"M4 8a.75.75 0 0 1 .75-.75h6.5a.75.75 0 0 1 0 1.5h-6.5A.75.75 0 0 1 4 8\"/><path d=\"M1.788 4.296c.196-.88.478-1.381.802-1.706s.826-.606 1.706-.802C5.194 1.588 6.387 1.5 8 1.5s2.806.088 3.704.288c.88.196 1.381.478 1.706.802s.607.826.802 1.706c.2.898.288 2.091.288 3.704s-.088 2.806-.288 3.704c-.195.88-.478 1.381-.802 1.706s-.826.607-1.706.802c-.898.2-2.091.288-3.704.288s-2.806-.088-3.704-.288c-.88-.195-1.381-.478-1.706-.802s-.606-.826-.802-1.706C1.588 10.806 1.5 9.613 1.5 8s.088-2.806.288-3.704M8 0C1.412 0 0 1.412 0 8s1.412 8 8 8 8-1.412 8-8-1.412-8-8-8\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-symbol-diffstat\" viewBox=\"0 0 16 16\">\n    <path d=\"M1.788 4.296c.196-.88.478-1.381.802-1.706s.826-.606 1.706-.802C5.194 1.588 6.387 1.5 8 1.5s2.806.088 3.704.288c.88.196 1.381.478 1.706.802s.607.826.802 1.706c.2.898.288 2.091.288 3.704s-.088 2.806-.288 3.704c-.195.88-.478 1.381-.802 1.706s-.826.607-1.706.802c-.898.2-2.091.288-3.704.288s-2.806-.088-3.704-.288c-.88-.195-1.381-.478-1.706-.802s-.606-.826-.802-1.706C1.588 10.806 1.5 9.613 1.5 8s.088-2.806.288-3.704M8 0C1.412 0 0 1.412 0 8s1.412 8 8 8 8-1.412 8-8-1.412-8-8-8\"/><path d=\"M8.75 4.296a.75.75 0 0 0-1.5 0V6.25h-2a.75.75 0 0 0 0 1.5h2v1.5h1.5v-1.5h2a.75.75 0 0 0 0-1.5h-2zM5.25 10a.75.75 0 0 0 0 1.5h5.5a.75.75 0 0 0 0-1.5z\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-symbol-ignored\" viewBox=\"0 0 16 16\">\n    <path d=\"M1.5 8c0 1.613.088 2.806.288 3.704.196.88.478 1.381.802 1.706s.826.607 1.706.802c.898.2 2.091.288 3.704.288s2.806-.088 3.704-.288c.88-.195 1.381-.478 1.706-.802s.607-.826.802-1.706c.2-.898.288-2.091.288-3.704s-.088-2.806-.288-3.704c-.195-.88-.478-1.381-.802-1.706s-.826-.606-1.706-.802C10.806 1.588 9.613 1.5 8 1.5s-2.806.088-3.704.288c-.88.196-1.381.478-1.706.802s-.606.826-.802 1.706C1.588 5.194 1.5 6.387 1.5 8M0 8c0-6.588 1.412-8 8-8s8 1.412 8 8-1.412 8-8 8-8-1.412-8-8m11.53-2.47a.75.75 0 0 0-1.06-1.06l-6 6a.75.75 0 1 0 1.06 1.06z\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-symbol-modified\" viewBox=\"0 0 16 16\">\n    <path d=\"M1.5 8c0 1.613.088 2.806.288 3.704.196.88.478 1.381.802 1.706s.826.607 1.706.802c.898.2 2.091.288 3.704.288s2.806-.088 3.704-.288c.88-.195 1.381-.478 1.706-.802s.607-.826.802-1.706c.2-.898.288-2.091.288-3.704s-.088-2.806-.288-3.704c-.195-.88-.478-1.381-.802-1.706s-.826-.606-1.706-.802C10.806 1.588 9.613 1.5 8 1.5s-2.806.088-3.704.288c-.88.196-1.381.478-1.706.802s-.606.826-.802 1.706C1.588 5.194 1.5 6.387 1.5 8M0 8c0-6.588 1.412-8 8-8s8 1.412 8 8-1.412 8-8 8-8-1.412-8-8m8 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-symbol-moved\" viewBox=\"0 0 16 16\">\n    <path d=\"M1.788 4.296c.196-.88.478-1.381.802-1.706s.826-.606 1.706-.802C5.194 1.588 6.387 1.5 8 1.5s2.806.088 3.704.288c.88.196 1.381.478 1.706.802s.607.826.802 1.706c.2.898.288 2.091.288 3.704s-.088 2.806-.288 3.704c-.195.88-.478 1.381-.802 1.706s-.826.607-1.706.802c-.898.2-2.091.288-3.704.288s-2.806-.088-3.704-.288c-.88-.195-1.381-.478-1.706-.802s-.606-.826-.802-1.706C1.588 10.806 1.5 9.613 1.5 8s.088-2.806.288-3.704M8 0C1.412 0 0 1.412 0 8s1.412 8 8 8 8-1.412 8-8-1.412-8-8-8\"/><path d=\"M8.495 4.695a.75.75 0 0 0-.05 1.06L10.486 8l-2.041 2.246a.75.75 0 0 0 1.11 1.008l2.5-2.75a.75.75 0 0 0 0-1.008l-2.5-2.75a.75.75 0 0 0-1.06-.051m-4 0a.75.75 0 0 0-.05 1.06l2.044 2.248-1.796 1.995a.75.75 0 0 0 1.114 1.004l2.25-2.5a.75.75 0 0 0-.002-1.007l-2.5-2.75a.75.75 0 0 0-1.06-.05\"/>\n  </symbol>\n  <symbol id=\"diffs-icon-symbol-ref\" viewBox=\"0 0 16 16\">\n    <path d=\"M1.5 8c0 1.613.088 2.806.288 3.704.196.88.478 1.381.802 1.706.286.286.71.54 1.41.73V1.86c-.7.19-1.124.444-1.41.73-.324.325-.606.826-.802 1.706C1.588 5.194 1.5 6.387 1.5 8m4 6.397c.697.07 1.522.103 2.5.103 1.613 0 2.806-.088 3.704-.288.88-.195 1.381-.478 1.706-.802s.607-.826.802-1.706c.2-.898.288-2.091.288-3.704s-.088-2.806-.288-3.704c-.195-.88-.478-1.381-.802-1.706s-.826-.606-1.706-.802C10.806 1.588 9.613 1.5 8 1.5c-.978 0-1.803.033-2.5.103zM0 8c0-6.588 1.412-8 8-8s8 1.412 8 8-1.412 8-8 8-8-1.412-8-8m7-2a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1z\"/>\n  </symbol>\n</svg>`;\n", "import type { FileContents } from '../types';\n\nexport function areFilesEqual(\n  fileA: FileContents | undefined,\n  fileB: FileContents | undefined\n): boolean {\n  return (\n    fileA?.cacheKey === fileB?.cacheKey &&\n    fileA?.contents === fileB?.contents &&\n    fileA?.name === fileB?.name &&\n    fileA?.lang === fileB?.lang\n  );\n}\n", "export function createAnnotationWrapperNode(slot: string): HTMLElement {\n  const wrapper = document.createElement('div');\n  wrapper.dataset.annotationSlot = '';\n  wrapper.slot = slot;\n  wrapper.style.whiteSpace = 'normal';\n  return wrapper;\n}\n", "interface CreateCodeNodeProps {\n  pre?: HTMLPreElement;\n  columnType?: 'additions' | 'deletions' | 'unified';\n}\n\nexport function createCodeNode({\n  pre,\n  columnType,\n}: CreateCodeNodeProps = {}): HTMLElement {\n  const code = document.createElement('code');\n  code.dataset.code = '';\n  if (columnType != null) {\n    code.dataset[columnType] = '';\n  }\n  pre?.appendChild(code);\n  return code;\n}\n", "export function createHoverContentNode(): HTMLElement {\n  const hoverContent = document.createElement('div');\n  hoverContent.slot = 'hover-slot';\n  hoverContent.style.position = 'absolute';\n  hoverContent.style.top = '0';\n  hoverContent.style.bottom = '0';\n  hoverContent.style.textAlign = 'center';\n  hoverContent.style.whiteSpace = 'normal';\n  return hoverContent;\n}\n", "import { UNSAFE_CSS_ATTRIBUTE } from '../constants';\n\nexport function createUnsafeCSSStyleNode(): HTMLStyleElement {\n  const node = document.createElement('style');\n  node.setAttribute(UNSAFE_CSS_ATTRIBUTE, '');\n  return node;\n}\n", "@layer base, theme, unsafe;\n\n@layer base {\n  :host {\n    --diffs-bg: #fff;\n    --diffs-fg: #000;\n    --diffs-font-fallback:\n      'SF Mono', Monaco, Consolas, 'Ubuntu Mono', 'Liberation Mono',\n      'Courier New', monospace;\n    --diffs-header-font-fallback:\n      system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue',\n      'Noto Sans', 'Liberation Sans', Arial, sans-serif;\n\n    --diffs-mixer: light-dark(black, white);\n    --diffs-gap-fallback: 8px;\n\n    /*\n    // Available CSS Color Overrides\n    --diffs-bg-buffer-override\n    --diffs-bg-hover-override\n    --diffs-bg-context-override\n    --diffs-bg-separator-override\n\n    --diffs-fg-number-override\n    --diffs-fg-number-addition-override\n    --diffs-fg-number-deletion-override\n\n    --diffs-deletion-color-override\n    --diffs-addition-color-override\n    --diffs-modified-color-override\n\n    --diffs-bg-deletion-override\n    --diffs-bg-deletion-number-override\n    --diffs-bg-deletion-hover-override\n    --diffs-bg-deletion-emphasis-override\n\n    --diffs-bg-addition-override\n    --diffs-bg-addition-number-override\n    --diffs-bg-addition-hover-override\n    --diffs-bg-addition-emphasis-override\n\n    // Line Selection Color Overrides (for enableLineSelection)\n    --diffs-selection-color-override\n    --diffs-bg-selection-override\n    --diffs-bg-selection-number-override\n    --diffs-bg-selection-background-override\n    --diffs-bg-selection-number-background-override\n\n    // Available CSS Layout Overrides\n    --diffs-gap-inline\n    --diffs-gap-block\n    --diffs-gap-style\n    --diffs-tab-size\n  */\n\n    color-scheme: light dark;\n    display: block;\n    font-family: var(\n      --diffs-header-font-family,\n      var(--diffs-header-font-fallback)\n    );\n    font-size: var(--diffs-font-size, 13px);\n    line-height: var(--diffs-line-height, 20px);\n    font-feature-settings: var(--diffs-font-features);\n  }\n\n  /* NOTE(mdo): Some semantic HTML elements (e.g. `pre`, `code`) have default\n * user-agent styles. These must be overridden to use our custom styles. */\n  pre,\n  code,\n  [data-error-wrapper] {\n    margin: 0;\n    padding: 0;\n    display: block;\n    outline: none;\n    font-family: var(--diffs-font-family, var(--diffs-font-fallback));\n  }\n\n  *,\n  *::before,\n  *::after {\n    box-sizing: border-box;\n  }\n\n  [data-icon-sprite] {\n    display: none;\n  }\n\n  /* NOTE(mdo): Headers and separators are within pre/code, so we need to reset\n * their font-family explicitly. */\n  [data-diffs-header],\n  [data-separator] {\n    font-family: var(\n      --diffs-header-font-family,\n      var(--diffs-header-font-fallback)\n    );\n  }\n\n  [data-file-info] {\n    padding: 10px;\n    font-weight: 700;\n    color: var(--fg);\n    /* NOTE(amadeus): we cannot use 'in oklch' because current versions of cursor\n   * and vscode use an older build of chrome that appears to have a bug with\n   * color-mix and 'in oklch', so use 'in lab' instead */\n    background-color: color-mix(in lab, var(--bg) 98%, var(--fg));\n    border-block: 1px solid color-mix(in lab, var(--bg) 95%, var(--fg));\n  }\n\n  [data-diffs-header],\n  [data-diffs],\n  [data-error-wrapper] {\n    --diffs-bg: light-dark(var(--diffs-light-bg), var(--diffs-dark-bg));\n    /* NOTE(amadeus): we cannot use 'in oklch' because current versions of cursor\n   * and vscode use an older build of chrome that appears to have a bug with\n   * color-mix and 'in oklch', so use 'in lab' instead */\n    --diffs-bg-buffer: var(\n      --diffs-bg-buffer-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 92%, var(--diffs-mixer)),\n        color-mix(in lab, var(--diffs-bg) 92%, var(--diffs-mixer))\n      )\n    );\n    --diffs-bg-hover: var(\n      --diffs-bg-hover-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 97%, var(--diffs-mixer)),\n        color-mix(in lab, var(--diffs-bg) 91%, var(--diffs-mixer))\n      )\n    );\n    --diffs-bg-context: var(\n      --diffs-bg-context-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 98.5%, var(--diffs-mixer)),\n        color-mix(in lab, var(--diffs-bg) 92.5%, var(--diffs-mixer))\n      )\n    );\n    --diffs-bg-separator: var(\n      --diffs-bg-separator-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 96%, var(--diffs-mixer)),\n        color-mix(in lab, var(--diffs-bg) 85%, var(--diffs-mixer))\n      )\n    );\n\n    --diffs-fg: light-dark(var(--diffs-light), var(--diffs-dark));\n    --diffs-fg-number: var(\n      --diffs-fg-number-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-fg) 65%, var(--diffs-bg)),\n        color-mix(in lab, var(--diffs-fg) 65%, var(--diffs-bg))\n      )\n    );\n\n    --diffs-deletion-base: var(\n      --diffs-deletion-color-override,\n      light-dark(\n        var(\n          --diffs-light-deletion-color,\n          var(--diffs-deletion-color, rgb(255, 0, 0))\n        ),\n        var(\n          --diffs-dark-deletion-color,\n          var(--diffs-deletion-color, rgb(255, 0, 0))\n        )\n      )\n    );\n    --diffs-addition-base: var(\n      --diffs-addition-color-override,\n      light-dark(\n        var(\n          --diffs-light-addition-color,\n          var(--diffs-addition-color, rgb(0, 255, 0))\n        ),\n        var(\n          --diffs-dark-addition-color,\n          var(--diffs-addition-color, rgb(0, 255, 0))\n        )\n      )\n    );\n    --diffs-modified-base: var(\n      --diffs-modified-color-override,\n      light-dark(\n        var(\n          --diffs-light-modified-color,\n          var(--diffs-modified-color, rgb(0, 0, 255))\n        ),\n        var(\n          --diffs-dark-modified-color,\n          var(--diffs-modified-color, rgb(0, 0, 255))\n        )\n      )\n    );\n\n    /* NOTE(amadeus): we cannot use 'in oklch' because current versions of cursor\n   * and vscode use an older build of chrome that appears to have a bug with\n   * color-mix and 'in oklch', so use 'in lab' instead */\n    --diffs-bg-deletion: var(\n      --diffs-bg-deletion-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 88%, var(--diffs-deletion-base)),\n        color-mix(in lab, var(--diffs-bg) 80%, var(--diffs-deletion-base))\n      )\n    );\n    --diffs-bg-deletion-number: var(\n      --diffs-bg-deletion-number-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 91%, var(--diffs-deletion-base)),\n        color-mix(in lab, var(--diffs-bg) 85%, var(--diffs-deletion-base))\n      )\n    );\n    --diffs-bg-deletion-hover: var(\n      --diffs-bg-deletion-hover-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 80%, var(--diffs-deletion-base)),\n        color-mix(in lab, var(--diffs-bg) 75%, var(--diffs-deletion-base))\n      )\n    );\n    --diffs-bg-deletion-emphasis: var(\n      --diffs-bg-deletion-emphasis-override,\n      light-dark(\n        rgb(from var(--diffs-deletion-base) r g b / 0.15),\n        rgb(from var(--diffs-deletion-base) r g b / 0.2)\n      )\n    );\n\n    --diffs-bg-addition: var(\n      --diffs-bg-addition-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 88%, var(--diffs-addition-base)),\n        color-mix(in lab, var(--diffs-bg) 80%, var(--diffs-addition-base))\n      )\n    );\n    --diffs-bg-addition-number: var(\n      --diffs-bg-addition-number-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 91%, var(--diffs-addition-base)),\n        color-mix(in lab, var(--diffs-bg) 85%, var(--diffs-addition-base))\n      )\n    );\n    --diffs-bg-addition-hover: var(\n      --diffs-bg-addition-hover-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 80%, var(--diffs-addition-base)),\n        color-mix(in lab, var(--diffs-bg) 70%, var(--diffs-addition-base))\n      )\n    );\n    --diffs-bg-addition-emphasis: var(\n      --diffs-bg-addition-emphasis-override,\n      light-dark(\n        rgb(from var(--diffs-addition-base) r g b / 0.15),\n        rgb(from var(--diffs-addition-base) r g b / 0.2)\n      )\n    );\n\n    --diffs-selection-base: var(--diffs-modified-base);\n    --diffs-selection-number-fg: light-dark(\n      color-mix(in lab, var(--diffs-selection-base) 65%, var(--diffs-mixer)),\n      color-mix(in lab, var(--diffs-selection-base) 75%, var(--diffs-mixer))\n    );\n    --diffs-bg-selection: var(\n      --diffs-bg-selection-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 82%, var(--diffs-selection-base)),\n        color-mix(in lab, var(--diffs-bg) 75%, var(--diffs-selection-base))\n      )\n    );\n    --diffs-bg-selection-number: var(\n      --diffs-bg-selection-number-override,\n      light-dark(\n        color-mix(in lab, var(--diffs-bg) 75%, var(--diffs-selection-base)),\n        color-mix(in lab, var(--diffs-bg) 60%, var(--diffs-selection-base))\n      )\n    );\n\n    background-color: var(--diffs-bg);\n    color: var(--diffs-fg);\n  }\n\n  [data-diffs] {\n    --diffs-code-grid: minmax(min-content, max-content) 1fr;\n\n    [data-column-content] span {\n      color: light-dark(var(--diffs-light), var(--diffs-dark));\n      font-weight: var(--diffs-light-font-weight);\n      font-style: var(--diffs-light-font-style);\n    }\n  }\n\n  [data-column-content] {\n    background-color: var(--diffs-line-bg, 'transparent');\n    grid-column: 2 / 3;\n  }\n\n  [data-diffs][data-dehydrated] {\n    --diffs-code-grid: minmax(min-content, max-content) minmax(0, 1fr);\n  }\n\n  @media (prefers-color-scheme: dark) {\n    [data-diffs-header],\n    [data-diffs] {\n      color-scheme: dark;\n    }\n\n    [data-diffs] [data-column-content] span {\n      font-weight: var(--diffs-dark-font-weight);\n      font-style: var(--diffs-dark-font-style);\n    }\n  }\n\n  [data-diffs-header][data-theme-type='light'],\n  [data-diffs][data-theme-type='light'] {\n    color-scheme: light;\n  }\n\n  [data-diffs][data-theme-type='light'] [data-column-content] span {\n    font-weight: var(--diffs-light-font-weight);\n    font-style: var(--diffs-light-font-style);\n  }\n\n  [data-diffs-header][data-theme-type='dark'],\n  [data-diffs][data-theme-type='dark'] {\n    color-scheme: dark;\n  }\n\n  [data-diffs][data-theme-type='dark'] [data-column-content] span {\n    font-weight: var(--diffs-dark-font-weight);\n    font-style: var(--diffs-dark-font-style);\n  }\n\n  [data-type='split'][data-overflow='wrap'] {\n    display: grid;\n    grid-auto-flow: dense;\n    grid-template-columns: repeat(2, var(--diffs-code-grid));\n  }\n\n  [data-type='split'][data-overflow='scroll'] {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 2px;\n  }\n\n  [data-code] {\n    display: block;\n    display: grid;\n    grid-auto-flow: dense;\n    grid-template-columns: var(--diffs-code-grid);\n    overflow: scroll clip;\n    overscroll-behavior-x: none;\n    tab-size: var(--diffs-tab-size, 2);\n    align-self: flex-start;\n    padding-top: var(--diffs-gap-block, var(--diffs-gap-fallback));\n    padding-bottom: max(\n      0px,\n      calc(var(--diffs-gap-block, var(--diffs-gap-fallback)) - 6px)\n    );\n  }\n\n  [data-code]::-webkit-scrollbar {\n    width: 0;\n    height: 6px;\n  }\n\n  [data-code]::-webkit-scrollbar-track {\n    background: transparent;\n  }\n\n  [data-code]::-webkit-scrollbar-thumb {\n    background-color: transparent;\n    border: 1px solid transparent;\n    background-clip: content-box;\n    border-radius: 3px;\n  }\n\n  [data-diffs]:hover [data-code]::-webkit-scrollbar-thumb {\n    background-color: var(--diffs-bg-context);\n  }\n\n  [data-code]::-webkit-scrollbar-corner {\n    background-color: transparent;\n  }\n\n  /*\n   * If we apply these rules globally it will mean that webkit will opt into the\n   * standards compliant version of custom css scrollbars, which we do not want\n   * because the custom stuff will look better\n  */\n  @supports (-moz-appearance: none) {\n    [data-code] {\n      scrollbar-width: thin;\n      scrollbar-color: var(--diffs-bg-context) transparent;\n      padding-bottom: var(--diffs-gap-block, var(--diffs-gap-fallback));\n    }\n  }\n\n  [data-diffs][data-type='split'][data-overflow='wrap'] {\n    padding-block: var(--diffs-gap-block, var(--diffs-gap-fallback));\n  }\n\n  [data-diffs-header] ~ [data-diffs] [data-code],\n  [data-diffs-header] ~ [data-diffs][data-overflow='wrap'] {\n    padding-top: 0;\n  }\n\n  [data-type='split'][data-overflow='wrap'] [data-code] {\n    display: contents;\n  }\n\n  [data-line-annotation],\n  [data-no-newline],\n  [data-line] {\n    position: relative;\n    display: grid;\n    grid-template-columns: subgrid;\n    grid-column: 1 / 3;\n  }\n\n  [data-line-annotation][data-selected-line] {\n    background-color: unset;\n\n    &::before {\n      content: '';\n      position: sticky;\n      top: 0;\n      left: 0;\n      display: block;\n      border-right: var(--diffs-gap-style, 1px solid var(--diffs-bg));\n      background-color: var(--diffs-bg-selection-number);\n    }\n\n    [data-annotation-content] {\n      background-color: var(--diffs-bg-selection);\n    }\n  }\n\n  [data-interactive-lines] [data-line] {\n    cursor: pointer;\n  }\n\n  [data-buffer] {\n    position: sticky;\n    left: 0;\n    grid-column: 1 / 3;\n    user-select: none;\n    /* We multiply by 1.414 (2) to better approximate the diagonal repeat distance */\n    background-image: repeating-linear-gradient(\n      -45deg,\n      transparent,\n      transparent calc(3px * 1.414),\n      var(--diffs-bg-buffer) calc(3px * 1.414),\n      var(--diffs-bg-buffer) calc(4px * 1.414)\n    );\n    min-height: 1lh;\n    width: var(--diffs-column-width, auto);\n  }\n\n  [data-separator] {\n    grid-column: span 2;\n  }\n\n  [data-separator='metadata'],\n  [data-separator]:empty {\n    min-height: 4px;\n    background-color: var(--diffs-bg-separator);\n    display: grid;\n    grid-template-columns: subgrid;\n  }\n\n  [data-separator-wrapper] {\n    user-select: none;\n    fill: currentColor;\n    overflow: hidden;\n  }\n\n  [data-separator='metadata'] [data-separator-wrapper] {\n    grid-column: 2 / 3;\n    width: var(--diffs-column-content-width);\n    position: sticky;\n    left: var(--diffs-column-number-width);\n    padding: 4px 1ch;\n  }\n\n  [data-separator='line-info'] {\n    margin-block: var(--diffs-gap-block, var(--diffs-gap-fallback));\n  }\n\n  [data-separator='line-info'][data-separator-first] {\n    margin-top: 0;\n  }\n\n  [data-separator='line-info'][data-separator-last] {\n    margin-bottom: 0;\n  }\n\n  [data-separator='line-info'] [data-separator-wrapper] {\n    position: sticky;\n    display: flex;\n    align-items: center;\n    gap: 2px;\n    width: auto;\n    width: calc(var(--diffs-column-width) - var(--diffs-gap-fallback));\n    border-radius: 6px;\n  }\n\n  @media (pointer: fine) {\n    [data-separator-wrapper][data-separator-multi-button] {\n      display: grid;\n      grid-template-columns: auto minmax(0, 1fr);\n      grid-template-rows: 15px 15px;\n\n      [data-expand-button] {\n        height: 15px;\n      }\n    }\n\n    [data-type='split']\n      [data-additions]\n      [data-separator-wrapper][data-separator-multi-button] {\n      grid-template-columns: minmax(0, 1fr) auto;\n    }\n\n    [data-type='split'] [data-additions] [data-expand-button] {\n      grid-column: 2;\n    }\n\n    [data-type='split'] [data-additions] [data-separator-content] {\n      grid-column: 1;\n    }\n  }\n\n  [data-expand-button],\n  [data-separator-content] {\n    display: flex;\n    align-items: center;\n    background-color: var(--diffs-bg-separator);\n  }\n\n  [data-expand-button] {\n    justify-content: center;\n    flex-shrink: 0;\n    cursor: pointer;\n    width: 32px;\n    height: 32px;\n    opacity: 0.65;\n  }\n\n  [data-hover-slot] {\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    display: flex;\n    justify-content: flex-end;\n  }\n\n  @media (pointer: fine) {\n    [data-expand-button]:hover {\n      opacity: 1;\n    }\n\n    [data-line]:hover {\n      z-index: 2;\n    }\n  }\n\n  [data-expand-up] [data-icon] {\n    transform: scaleY(-1);\n  }\n\n  [data-separator-content] {\n    flex: 1 1 auto;\n    padding: 0 1ch;\n    height: 32px;\n    opacity: 0.65;\n    overflow: hidden;\n    justify-content: flex-start;\n\n    grid-column: 2;\n    grid-row: 1 / -1;\n  }\n\n  [data-unmodified-lines] {\n    display: block;\n    overflow: hidden;\n    min-width: 0;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    flex: 0 1 auto;\n  }\n\n  [data-type='split'] [data-additions] [data-separator-content] {\n    justify-content: flex-end;\n  }\n\n  [data-type='file']\n    [data-code]\n    [data-separator='line-info']\n    [data-separator-wrapper] {\n    left: var(--diffs-gap-inline, var(--diffs-gap-fallback));\n    margin-left: var(--diffs-gap-inline, var(--diffs-gap-fallback));\n    margin-right: var(--diffs-gap-inline, var(--diffs-gap-fallback));\n    width: calc(\n      var(--diffs-column-width) -\n        (var(--diffs-gap-inline, var(--diffs-gap-fallback)) * 2)\n    );\n  }\n\n  [data-type='split']\n    [data-deletions]\n    [data-separator='line-info']\n    [data-separator-wrapper] {\n    left: var(--diffs-gap-fallback);\n    margin-left: var(--diffs-gap-fallback);\n    border-top-right-radius: 0;\n    border-bottom-right-radius: 0;\n  }\n\n  [data-type='split']\n    [data-additions]\n    [data-separator='line-info']\n    [data-separator-wrapper] {\n    left: 0;\n    margin-right: var(--diffs-gap-inline, var(--diffs-gap-fallback));\n    border-top-left-radius: 0;\n    border-bottom-left-radius: 0;\n    flex-direction: row-reverse;\n  }\n\n  [data-line] {\n    background-color: var(--diffs-bg);\n    color: var(--diffs-fg);\n  }\n\n  [data-type='split'][data-overflow='wrap'] [data-deletions] {\n    [data-line-annotation],\n    [data-buffer],\n    [data-line],\n    [data-separator] {\n      grid-column: 1 / 3;\n    }\n  }\n\n  [data-line-annotation] {\n    min-height: var(--diffs-annotation-min-height, 0);\n    background-color: var(--diffs-bg-context);\n    z-index: 3;\n  }\n\n  [data-type='split'][data-overflow='wrap'] [data-additions] {\n    [data-line-annotation],\n    [data-buffer],\n    [data-line],\n    [data-separator] {\n      margin-left: 2px;\n      grid-column: 3 / 5;\n    }\n  }\n\n  [data-separator='custom'] {\n    display: grid;\n    grid-template-columns: subgrid;\n  }\n\n  [data-column-content],\n  [data-column-number] {\n    position: relative;\n    padding-inline: 1ch;\n  }\n\n  [data-indicators='classic'] [data-column-content] {\n    padding-inline-start: 2ch;\n  }\n\n  [data-indicators='classic'] {\n    [data-line-type='change-addition'] [data-column-content]::before,\n    [data-line-type='change-deletion'] [data-column-content]::before {\n      display: inline-block;\n      width: 1ch;\n      height: 1lh;\n      position: absolute;\n      top: 0;\n      left: 0;\n      user-select: none;\n    }\n\n    [data-line-type='change-addition'] [data-column-content]::before {\n      content: '+';\n      color: var(--diffs-addition-base);\n    }\n\n    [data-line-type='change-deletion'] [data-column-content]::before {\n      content: '-';\n      color: var(--diffs-deletion-base);\n    }\n  }\n\n  [data-indicators='bars'] {\n    [data-line-type='change-deletion'] [data-column-number]::before,\n    [data-line-type='change-addition'] [data-column-number]::before {\n      content: '';\n      display: block;\n      width: 4px;\n      height: 100%;\n      position: absolute;\n      top: 0;\n      left: 0;\n      user-select: none;\n    }\n\n    [data-line-type='change-deletion'] [data-column-number]::before {\n      background-image: linear-gradient(\n        0deg,\n        var(--diffs-bg-deletion) 50%,\n        var(--diffs-deletion-base) 50%\n      );\n      background-repeat: repeat;\n      background-size: 2px 2px;\n      background-size: calc(1lh / round(1lh / 2px)) calc(1lh / round(1lh / 2px));\n    }\n\n    [data-line-type='change-addition'] [data-column-number]::before {\n      background-color: var(--diffs-addition-base);\n    }\n  }\n\n  [data-overflow='wrap'] [data-column-content],\n  [data-overflow='wrap'] [data-annotation-content] {\n    white-space: pre-wrap;\n    word-break: break-word;\n  }\n\n  [data-overflow='scroll'] [data-column-content] {\n    white-space: pre;\n    min-height: 1lh;\n  }\n\n  [data-column-number] {\n    grid-column: 1 / 2;\n    box-sizing: content-box;\n    text-align: right;\n    position: sticky;\n    left: 0;\n    user-select: none;\n    background-color: var(--diffs-bg);\n    color: var(--diffs-fg-number);\n    z-index: 1;\n    min-width: var(\n      --diffs-min-number-column-width,\n      var(--diffs-min-number-column-width-default, 3ch)\n    );\n    padding-left: 2ch;\n    border-right: var(--diffs-gap-style, 1px solid var(--diffs-bg));\n  }\n\n  [data-disable-line-numbers] {\n    &[data-indicators='bars'] [data-column-number] {\n      min-width: 4px;\n      border-right: var(--diffs-gap-style, 1px solid var(--diffs-bg));\n    }\n\n    [data-column-number] {\n      border-right: none;\n      min-width: 0;\n      padding: 0;\n    }\n\n    [data-line-number-content] {\n      display: none;\n    }\n\n    [data-hover-slot] {\n      right: unset;\n      left: 0;\n      justify-content: flex-start;\n    }\n\n    &[data-indicators='bars'] [data-hover-slot] {\n      /* Using 5px here because theres a 1px separator after the bar */\n      left: 5px;\n    }\n  }\n\n  [data-interactive-line-numbers] [data-column-number] {\n    cursor: pointer;\n  }\n\n  [data-diff-span] {\n    border-radius: 3px;\n    box-decoration-break: clone;\n  }\n\n  [data-line-type='change-addition'] {\n    [data-column-number] {\n      color: var(\n        --diffs-fg-number-addition-override,\n        var(--diffs-addition-base)\n      );\n    }\n\n    [data-diff-span] {\n      background-color: var(--diffs-bg-addition-emphasis);\n    }\n  }\n\n  [data-line-type='change-deletion'] {\n    [data-column-number] {\n      color: var(\n        --diffs-fg-number-deletion-override,\n        var(--diffs-deletion-base)\n      );\n    }\n\n    [data-diff-span] {\n      background-color: var(--diffs-bg-deletion-emphasis);\n    }\n  }\n\n  [data-background] [data-line-type='change-addition'] {\n    --diffs-line-bg: var(--diffs-bg-addition);\n\n    [data-column-number] {\n      background-color: var(--diffs-bg-addition-number);\n    }\n  }\n\n  [data-background] [data-line-type='change-deletion'] {\n    --diffs-line-bg: var(--diffs-bg-deletion);\n\n    [data-column-number] {\n      background-color: var(--diffs-bg-deletion-number);\n    }\n  }\n\n  [data-line-type='context-expanded'] {\n    --diffs-line-bg: var(--diffs-bg-context);\n\n    [data-column-number] {\n      background-color: var(--diffs-bg-context);\n    }\n  }\n\n  /* By wrapping hovers in a pointer: fine, we ensure that mobile devices don't\n*  require a double click */\n  @media (pointer: fine) {\n    [data-line]:hover:not([data-selected-line]) {\n      [data-column-number],\n      [data-column-content] {\n        background-color: var(--diffs-bg-hover);\n      }\n    }\n\n    [data-background] [data-line]:hover:not([data-selected-line]) {\n      &[data-line-type='change-deletion'] [data-column-number],\n      &[data-line-type='change-deletion'] [data-column-content] {\n        background-color: var(--diffs-bg-deletion-hover);\n      }\n\n      &[data-line-type='change-addition'] [data-column-number],\n      &[data-line-type='change-addition'] [data-column-content] {\n        background-color: var(--diffs-bg-addition-hover);\n      }\n    }\n  }\n\n  [data-diffs-header] {\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: center;\n    gap: var(--diffs-gap-inline, var(--diffs-gap-fallback));\n    min-height: calc(\n      1lh + (var(--diffs-gap-block, var(--diffs-gap-fallback)) * 3)\n    );\n    padding-inline: 16px;\n  }\n\n  [data-header-content] {\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    gap: var(--diffs-gap-inline, var(--diffs-gap-fallback));\n    min-width: 0;\n    white-space: nowrap;\n  }\n\n  [data-header-content] [data-prev-name],\n  [data-header-content] [data-title] {\n    direction: rtl;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    min-width: 0;\n    white-space: nowrap;\n  }\n\n  [data-prev-name] {\n    opacity: 0.7;\n  }\n\n  [data-rename-icon] {\n    fill: currentColor;\n    flex-shrink: 0;\n    flex-grow: 0;\n  }\n\n  [data-diffs-header] [data-metadata] {\n    display: flex;\n    align-items: center;\n    gap: 1ch;\n    white-space: nowrap;\n  }\n\n  [data-diffs-header] [data-additions-count] {\n    font-family: var(--diffs-font-family, var(--diffs-font-fallback));\n    color: var(--diffs-addition-base);\n  }\n\n  [data-diffs-header] [data-deletions-count] {\n    font-family: var(--diffs-font-family, var(--diffs-font-fallback));\n    color: var(--diffs-deletion-base);\n  }\n\n  [data-no-newline] {\n    user-select: none;\n\n    [data-column-content] {\n      opacity: 0.6;\n    }\n  }\n\n  [data-annotation-content] {\n    position: sticky;\n    left: var(--diffs-column-number-width, 0);\n    grid-column: 2 / -1;\n    width: var(--diffs-column-content-width, auto);\n    align-self: flex-start;\n    z-index: 2;\n    height: 100%;\n  }\n\n  /* Undo some of the stuff that the 'pre' tag does */\n  [data-annotation-slot] {\n    text-wrap-mode: wrap;\n    word-break: normal;\n    white-space-collapse: collapse;\n  }\n\n  [data-change-icon] {\n    fill: currentColor;\n    flex-shrink: 0;\n  }\n\n  [data-change-icon='change'],\n  [data-change-icon='rename-pure'],\n  [data-change-icon='rename-changed'] {\n    color: var(--diffs-modified-base);\n  }\n\n  [data-change-icon='new'] {\n    color: var(--diffs-addition-base);\n  }\n\n  [data-change-icon='deleted'] {\n    color: var(--diffs-deletion-base);\n  }\n\n  [data-change-icon='file'] {\n    opacity: 0.6;\n  }\n\n  /* Line selection highlighting */\n  [data-line-type='context'][data-selected-line] {\n    [data-column-number] {\n      color: var(--diffs-selection-number-fg);\n      background-color: var(--diffs-bg-selection-number);\n    }\n\n    [data-column-content] {\n      background-color: var(--diffs-bg-selection);\n    }\n  }\n\n  [data-line-type='context-expanded'],\n  [data-line-type='change-addition'],\n  [data-line-type='change-deletion'] {\n    &[data-selected-line] {\n      [data-column-content] {\n        background-color: light-dark(\n          color-mix(\n            in lab,\n            var(--diffs-line-bg, var(--diffs-bg)) 82%,\n            var(--diffs-selection-base)\n          ),\n          color-mix(\n            in lab,\n            var(--diffs-line-bg, var(--diffs-bg)) 75%,\n            var(--diffs-selection-base)\n          )\n        );\n      }\n\n      [data-column-number] {\n        color: var(--diffs-selection-number-fg);\n        background-color: light-dark(\n          color-mix(\n            in lab,\n            var(--diffs-line-bg, var(--diffs-bg)) 75%,\n            var(--diffs-selection-base)\n          ),\n          color-mix(\n            in lab,\n            var(--diffs-line-bg, var(--diffs-bg)) 60%,\n            var(--diffs-selection-base)\n          )\n        );\n      }\n    }\n  }\n\n  [data-error-wrapper] {\n    overflow: auto;\n    padding: var(--diffs-gap-block, var(--diffs-gap-fallback))\n      var(--diffs-gap-inline, var(--diffs-gap-fallback));\n    max-height: 400px;\n    scrollbar-width: none;\n\n    [data-error-message] {\n      font-weight: bold;\n      font-size: 18px;\n      color: var(--diffs-deletion-base);\n    }\n\n    [data-error-stack] {\n      color: var(--diffs-fg-number);\n    }\n  }\n}\n", "import rawStyles from '../style.css';\n\nconst LAYER_ORDER = `@layer base, theme, unsafe;`;\n\nexport function wrapCoreCSS(mainCSS: string) {\n  return `${LAYER_ORDER}\n${rawStyles}\n@layer theme {\n  ${mainCSS}\n}`;\n}\n\nexport function wrapUnsafeCSS(unsafeCSS: string) {\n  return `${LAYER_ORDER}\n@layer unsafe {\n  ${unsafeCSS}\n}`;\n}\n", "export function prerenderHTMLIfNecessary(\n  element: HTMLElement,\n  html: string | undefined\n): void {\n  if (html == null) return;\n  const shadowRoot =\n    element.shadowRoot ?? element.attachShadow({ mode: 'open' });\n  if (shadowRoot.innerHTML === '') {\n    shadowRoot.innerHTML = html;\n  }\n}\n", "import type { PrePropertiesConfig } from '../types';\n\nexport interface SetPreNodePropertiesProps extends PrePropertiesConfig {\n  pre: HTMLPreElement;\n}\n\nexport function setPreNodeProperties({\n  diffIndicators,\n  disableBackground,\n  disableLineNumbers,\n  overflow,\n  pre,\n  split,\n  themeStyles,\n  themeType,\n  totalLines,\n}: SetPreNodePropertiesProps): HTMLPreElement {\n  if (themeType === 'system') {\n    delete pre.dataset.themeType;\n  } else {\n    pre.dataset.themeType = themeType;\n  }\n  switch (diffIndicators) {\n    case 'bars':\n    case 'classic':\n      pre.dataset.indicators = diffIndicators;\n      break;\n    case 'none':\n      delete pre.dataset.indicators;\n      break;\n  }\n  if (disableLineNumbers) {\n    pre.dataset.disableLineNumbers = '';\n  } else {\n    delete pre.dataset.disableLineNumbers;\n  }\n  if (disableBackground) {\n    delete pre.dataset.background;\n  } else {\n    pre.dataset.background = '';\n  }\n  pre.dataset.type = split ? 'split' : 'file';\n  pre.dataset.overflow = overflow;\n  pre.dataset.diffs = '';\n  pre.tabIndex = 0;\n  // Set theme color custom properties as inline styles on pre element\n  pre.style = themeStyles;\n  // Set CSS custom property for line number column width\n  pre.style.setProperty(\n    '--diffs-min-number-column-width-default',\n    `${`${totalLines}`.length}ch`\n  );\n  return pre;\n}\n", "import { DIFFS_TAG_NAME } from '../constants';\nimport styles from '../style.css';\n\n// If HTMLElement is undefined it usually means we are in a server environment\n// so best to just not do anything\nif (\n  typeof HTMLElement !== 'undefined' &&\n  customElements.get(DIFFS_TAG_NAME) == null\n) {\n  let sheet: CSSStyleSheet | undefined;\n\n  class FileDiffContainer extends HTMLElement {\n    constructor() {\n      super();\n      // If shadow root is already open, we can sorta assume the\n      // CSS is already in place\n      if (this.shadowRoot != null) {\n        return;\n      }\n      const shadowRoot = this.attachShadow({ mode: 'open' });\n      if (sheet == null) {\n        sheet = new CSSStyleSheet();\n        // Declare layer order first, then wrap base styles in @layer to match SSR behavior\n        sheet.replaceSync(\n          `@layer base, theme, unsafe;\\n@layer base {\\n${styles}\\n}`\n        );\n      }\n      shadowRoot.adoptedStyleSheets = [sheet];\n    }\n    // Not sure if we need to do anything here yet...\n    // connectedCallback() {\n    //   this.dataset.diffsContainer = '';\n    // }\n  }\n\n  customElements.define(DIFFS_TAG_NAME, FileDiffContainer);\n}\n\nexport const DiffsContainerLoaded = true;\n", "import type { Element as HASTElement } from 'hast';\nimport { toHtml } from 'hast-util-to-html';\n\nimport {\n  DEFAULT_THEMES,\n  DIFFS_TAG_NAME,\n  HEADER_METADATA_SLOT_ID,\n  UNSAFE_CSS_ATTRIBUTE,\n} from '../constants';\nimport {\n  LineSelectionManager,\n  type LineSelectionOptions,\n  type SelectedLineRange,\n  pluckLineSelectionOptions,\n} from '../managers/LineSelectionManager';\nimport {\n  type GetHoveredLineResult,\n  MouseEventManager,\n  type MouseEventManagerBaseOptions,\n  pluckMouseEventOptions,\n} from '../managers/MouseEventManager';\nimport { ResizeManager } from '../managers/ResizeManager';\nimport { type FileRenderResult, FileRenderer } from '../renderers/FileRenderer';\nimport { SVGSpriteSheet } from '../sprite';\nimport type {\n  BaseCodeOptions,\n  FileContents,\n  LineAnnotation,\n  RenderFileMetadata,\n  ThemeTypes,\n} from '../types';\nimport { areFilesEqual } from '../utils/areFilesEqual';\nimport { createAnnotationWrapperNode } from '../utils/createAnnotationWrapperNode';\nimport { createCodeNode } from '../utils/createCodeNode';\nimport { createHoverContentNode } from '../utils/createHoverContentNode';\nimport { createUnsafeCSSStyleNode } from '../utils/createUnsafeCSSStyleNode';\nimport { wrapUnsafeCSS } from '../utils/cssWrappers';\nimport { getLineAnnotationName } from '../utils/getLineAnnotationName';\nimport { prerenderHTMLIfNecessary } from '../utils/prerenderHTMLIfNecessary';\nimport { setPreNodeProperties } from '../utils/setWrapperNodeProps';\nimport type { WorkerPoolManager } from '../worker';\nimport { DiffsContainerLoaded } from './web-components';\n\nexport interface FileRenderProps<LAnnotation> {\n  file: FileContents;\n  fileContainer?: HTMLElement;\n  containerWrapper?: HTMLElement;\n  forceRender?: boolean;\n  lineAnnotations?: LineAnnotation<LAnnotation>[];\n}\n\nexport interface FileHyrdateProps<LAnnotation>\n  extends Omit<FileRenderProps<LAnnotation>, 'fileContainer'> {\n  fileContainer: HTMLElement;\n  prerenderedHTML?: string;\n}\n\nexport interface FileOptions<LAnnotation>\n  extends BaseCodeOptions,\n    MouseEventManagerBaseOptions<'file'>,\n    LineSelectionOptions {\n  disableFileHeader?: boolean;\n  renderCustomMetadata?: RenderFileMetadata;\n  renderAnnotation?(\n    annotation: LineAnnotation<LAnnotation>\n  ): HTMLElement | undefined;\n  renderHoverUtility?(\n    getHoveredRow: () => GetHoveredLineResult<'file'> | undefined\n  ): HTMLElement | null;\n}\n\nlet instanceId = -1;\n\nexport class File<LAnnotation = undefined> {\n  static LoadedCustomComponent: boolean = DiffsContainerLoaded;\n\n  readonly __id: number = ++instanceId;\n  private fileContainer: HTMLElement | undefined;\n  private spriteSVG: SVGElement | undefined;\n  private pre: HTMLPreElement | undefined;\n  private code: HTMLElement | undefined;\n  private unsafeCSSStyle: HTMLStyleElement | undefined;\n  private hoverContent: HTMLElement | undefined;\n  private errorWrapper: HTMLElement | undefined;\n\n  private headerElement: HTMLElement | undefined;\n  private headerMetadata: HTMLElement | undefined;\n\n  private fileRenderer: FileRenderer<LAnnotation>;\n  private resizeManager: ResizeManager;\n  private mouseEventManager: MouseEventManager<'file'>;\n  private lineSelectionManager: LineSelectionManager;\n\n  private annotationElements: HTMLElement[] = [];\n  private lineAnnotations: LineAnnotation<LAnnotation>[] = [];\n\n  private file: FileContents | undefined;\n\n  constructor(\n    public options: FileOptions<LAnnotation> = { theme: DEFAULT_THEMES },\n    private workerManager?: WorkerPoolManager | undefined,\n    private isContainerManaged = false\n  ) {\n    this.fileRenderer = new FileRenderer<LAnnotation>(\n      options,\n      this.handleHighlightRender,\n      this.workerManager\n    );\n    this.resizeManager = new ResizeManager();\n    this.mouseEventManager = new MouseEventManager(\n      'file',\n      pluckMouseEventOptions(options)\n    );\n    this.lineSelectionManager = new LineSelectionManager(\n      pluckLineSelectionOptions(options)\n    );\n    this.workerManager?.subscribeToThemeChanges(this);\n  }\n\n  private handleHighlightRender = (): void => {\n    this.rerender();\n  };\n\n  rerender(): void {\n    if (this.file == null) return;\n    this.render({ file: this.file, forceRender: true });\n  }\n\n  setOptions(options: FileOptions<LAnnotation> | undefined): void {\n    if (options == null) return;\n    this.options = options;\n    this.mouseEventManager.setOptions(pluckMouseEventOptions(options));\n    this.lineSelectionManager.setOptions(pluckLineSelectionOptions(options));\n  }\n\n  private mergeOptions(options: Partial<FileOptions<LAnnotation>>): void {\n    this.options = { ...this.options, ...options };\n  }\n\n  setThemeType(themeType: ThemeTypes): void {\n    const currentThemeType = this.options.themeType ?? 'system';\n    if (currentThemeType === themeType) {\n      return;\n    }\n    this.mergeOptions({ themeType });\n    this.fileRenderer.setThemeType(themeType);\n\n    if (this.headerElement != null) {\n      if (themeType === 'system') {\n        delete this.headerElement.dataset.themeType;\n      } else {\n        this.headerElement.dataset.themeType = themeType;\n      }\n    }\n\n    // Update pre element theme mode\n    if (this.pre != null) {\n      switch (themeType) {\n        case 'system':\n          delete this.pre.dataset.themeType;\n          break;\n        case 'light':\n        case 'dark':\n          this.pre.dataset.themeType = themeType;\n          break;\n      }\n    }\n  }\n\n  getHoveredLine = (): GetHoveredLineResult<'file'> | undefined => {\n    return this.mouseEventManager.getHoveredLine();\n  };\n\n  setLineAnnotations(lineAnnotations: LineAnnotation<LAnnotation>[]): void {\n    this.lineAnnotations = lineAnnotations;\n  }\n\n  setSelectedLines(range: SelectedLineRange | null): void {\n    this.lineSelectionManager.setSelection(range);\n  }\n\n  cleanUp(): void {\n    this.fileRenderer.cleanUp();\n    this.resizeManager.cleanUp();\n    this.mouseEventManager.cleanUp();\n    this.lineSelectionManager.cleanUp();\n    this.workerManager?.unsubscribeToThemeChanges(this);\n    this.workerManager = undefined;\n\n    // Clean up the data\n    this.file = undefined;\n\n    // Clean up the elements\n    if (!this.isContainerManaged) {\n      this.fileContainer?.parentNode?.removeChild(this.fileContainer);\n    }\n    if (this.fileContainer?.shadowRoot != null) {\n      this.fileContainer.shadowRoot.innerHTML = '';\n    }\n    this.fileContainer = undefined;\n    this.pre = undefined;\n    this.headerElement = undefined;\n    this.errorWrapper = undefined;\n    this.unsafeCSSStyle = undefined;\n  }\n\n  hydrate(props: FileHyrdateProps<LAnnotation>): void {\n    const { fileContainer, prerenderedHTML } = props;\n    prerenderHTMLIfNecessary(fileContainer, prerenderedHTML);\n    for (const element of Array.from(\n      fileContainer.shadowRoot?.children ?? []\n    )) {\n      if (element instanceof SVGElement) {\n        this.spriteSVG = element;\n        continue;\n      }\n      if (!(element instanceof HTMLElement)) {\n        continue;\n      }\n      if (element instanceof HTMLPreElement) {\n        this.pre = element;\n        continue;\n      }\n      if (\n        element instanceof HTMLStyleElement &&\n        element.hasAttribute(UNSAFE_CSS_ATTRIBUTE)\n      ) {\n        this.unsafeCSSStyle = element;\n        continue;\n      }\n      if ('diffsHeader' in element.dataset) {\n        this.headerElement = element;\n        continue;\n      }\n    }\n    // If we have no pre tag, then we should render\n    if (this.pre == null) {\n      this.render(props);\n    }\n    // Otherwise orchestrate our setup\n    else {\n      const { file, lineAnnotations } = props;\n      this.fileContainer = fileContainer;\n      delete this.pre.dataset.dehydrated;\n\n      this.lineAnnotations = lineAnnotations ?? this.lineAnnotations;\n      this.file = file;\n      this.fileRenderer.hydrate(file);\n      this.renderAnnotations();\n      this.renderHoverUtility();\n      this.injectUnsafeCSS();\n      this.mouseEventManager.setup(this.pre);\n      this.lineSelectionManager.setup(this.pre);\n      if ((this.options.overflow ?? 'scroll') === 'scroll') {\n        this.resizeManager.setup(this.pre);\n      }\n    }\n  }\n\n  render({\n    file,\n    fileContainer,\n    forceRender = false,\n    containerWrapper,\n    lineAnnotations,\n  }: FileRenderProps<LAnnotation>): void {\n    const annotationsChanged =\n      lineAnnotations != null &&\n      (lineAnnotations.length > 0 || this.lineAnnotations.length > 0)\n        ? lineAnnotations !== this.lineAnnotations\n        : false;\n    if (!forceRender && areFilesEqual(this.file, file) && !annotationsChanged) {\n      return;\n    }\n\n    this.file = file;\n    this.fileRenderer.setOptions(this.options);\n    if (lineAnnotations != null) {\n      this.setLineAnnotations(lineAnnotations);\n    }\n    this.fileRenderer.setLineAnnotations(this.lineAnnotations);\n\n    const { disableFileHeader = false } = this.options;\n    if (disableFileHeader) {\n      // Remove existing header from DOM\n      if (this.headerElement != null) {\n        this.headerElement.parentNode?.removeChild(this.headerElement);\n        this.headerElement = undefined;\n      }\n    }\n\n    fileContainer = this.getOrCreateFileContainerNode(\n      fileContainer,\n      containerWrapper\n    );\n\n    try {\n      const fileResult = this.fileRenderer.renderFile(file);\n      if (fileResult == null) {\n        if (this.workerManager != null && !this.workerManager.isInitialized()) {\n          void this.workerManager.initialize().then(() => this.rerender());\n        }\n        return;\n      }\n      if (fileResult.headerAST != null) {\n        this.applyHeaderToDOM(fileResult.headerAST, fileContainer);\n      }\n      const pre = this.getOrCreatePreNode(fileContainer);\n      this.applyHunksToDOM(fileResult, pre);\n      this.renderAnnotations();\n      this.renderHoverUtility();\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        this.applyErrorToDOM(error, fileContainer);\n      }\n    }\n  }\n\n  private renderAnnotations(): void {\n    if (this.isContainerManaged || this.fileContainer == null) {\n      return;\n    }\n    // Handle annotation elements\n    for (const element of this.annotationElements) {\n      element.parentNode?.removeChild(element);\n    }\n    this.annotationElements.length = 0;\n\n    const { renderAnnotation } = this.options;\n    if (renderAnnotation != null && this.lineAnnotations.length > 0) {\n      for (const annotation of this.lineAnnotations) {\n        const content = renderAnnotation(annotation);\n        if (content == null) continue;\n        const el = createAnnotationWrapperNode(\n          getLineAnnotationName(annotation)\n        );\n        el.appendChild(content);\n        this.annotationElements.push(el);\n        this.fileContainer.appendChild(el);\n      }\n    }\n  }\n\n  private renderHoverUtility() {\n    const { renderHoverUtility } = this.options;\n    if (this.fileContainer == null || renderHoverUtility == null) return;\n    if (this.hoverContent == null) {\n      this.hoverContent = createHoverContentNode();\n      this.fileContainer.appendChild(this.hoverContent);\n    }\n    const element = renderHoverUtility(this.mouseEventManager.getHoveredLine);\n    this.hoverContent.innerHTML = '';\n    if (element != null) {\n      this.hoverContent.appendChild(element);\n    }\n  }\n\n  private injectUnsafeCSS(): void {\n    if (this.fileContainer?.shadowRoot == null) {\n      return;\n    }\n    const { unsafeCSS } = this.options;\n\n    if (unsafeCSS == null || unsafeCSS === '') {\n      if (this.unsafeCSSStyle != null) {\n        this.unsafeCSSStyle.parentNode?.removeChild(this.unsafeCSSStyle);\n        this.unsafeCSSStyle = undefined;\n      }\n      return;\n    }\n\n    // Create or update the style element\n    if (this.unsafeCSSStyle == null) {\n      this.unsafeCSSStyle = createUnsafeCSSStyleNode();\n      this.fileContainer.shadowRoot.appendChild(this.unsafeCSSStyle);\n    }\n    // Wrap in @layer unsafe to match SSR behavior\n    this.unsafeCSSStyle.innerText = wrapUnsafeCSS(unsafeCSS);\n  }\n\n  private applyHunksToDOM(result: FileRenderResult, pre: HTMLPreElement): void {\n    this.cleanupErrorWrapper();\n    this.applyPreNodeAttributes(pre, result);\n    pre.innerHTML = '';\n    // Create code elements and insert HTML content\n    this.code = createCodeNode();\n    this.code.innerHTML = this.fileRenderer.renderPartialHTML(result.codeAST);\n    pre.appendChild(this.code);\n    this.injectUnsafeCSS();\n    this.mouseEventManager.setup(pre);\n    this.lineSelectionManager.setup(pre);\n    this.lineSelectionManager.setDirty();\n    if ((this.options.overflow ?? 'scroll') === 'scroll') {\n      this.resizeManager.setup(pre);\n    } else {\n      this.resizeManager.cleanUp();\n    }\n  }\n\n  private applyHeaderToDOM(\n    headerAST: HASTElement,\n    container: HTMLElement\n  ): void {\n    const { file } = this;\n    if (file == null) return;\n    this.cleanupErrorWrapper();\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = toHtml(headerAST);\n    const newHeader = tempDiv.firstElementChild;\n    if (!(newHeader instanceof HTMLElement)) {\n      return;\n    }\n    if (this.headerElement != null) {\n      container.shadowRoot?.replaceChild(newHeader, this.headerElement);\n    } else {\n      container.shadowRoot?.prepend(newHeader);\n    }\n    this.headerElement = newHeader;\n\n    if (this.isContainerManaged) return;\n\n    const { renderCustomMetadata } = this.options;\n    if (this.headerMetadata != null) {\n      this.headerMetadata.parentNode?.removeChild(this.headerMetadata);\n    }\n    const content = renderCustomMetadata?.(file) ?? undefined;\n    if (content != null) {\n      this.headerMetadata = document.createElement('div');\n      this.headerMetadata.slot = HEADER_METADATA_SLOT_ID;\n      if (content instanceof Element) {\n        this.headerMetadata.appendChild(content);\n      } else {\n        this.headerMetadata.innerText = `${content}`;\n      }\n      container.appendChild(this.headerMetadata);\n    }\n  }\n\n  private getOrCreateFileContainerNode(\n    fileContainer?: HTMLElement,\n    parentNode?: HTMLElement\n  ): HTMLElement {\n    this.fileContainer =\n      fileContainer ??\n      this.fileContainer ??\n      document.createElement(DIFFS_TAG_NAME);\n    if (parentNode != null && this.fileContainer.parentNode !== parentNode) {\n      parentNode.appendChild(this.fileContainer);\n    }\n    if (this.spriteSVG == null) {\n      const fragment = document.createElement('div');\n      fragment.innerHTML = SVGSpriteSheet;\n      const firstChild = fragment.firstChild;\n      if (firstChild instanceof SVGElement) {\n        this.spriteSVG = firstChild;\n        this.fileContainer.shadowRoot?.appendChild(this.spriteSVG);\n      }\n    }\n    return this.fileContainer;\n  }\n\n  private getOrCreatePreNode(container: HTMLElement): HTMLPreElement {\n    // If we haven't created a pre element yet, lets go ahead and do that\n    if (this.pre == null) {\n      this.pre = document.createElement('pre');\n      container.shadowRoot?.appendChild(this.pre);\n    }\n    // If we have a new parent container for the pre element, lets go ahead and\n    // move it into the new container\n    else if (this.pre.parentNode !== container) {\n      container.shadowRoot?.appendChild(this.pre);\n    }\n    return this.pre;\n  }\n\n  private applyPreNodeAttributes(\n    pre: HTMLPreElement,\n    { totalLines, themeStyles, baseThemeType }: FileRenderResult\n  ): void {\n    const {\n      overflow = 'scroll',\n      themeType = 'system',\n      disableLineNumbers = false,\n    } = this.options;\n    setPreNodeProperties({\n      pre,\n      split: false,\n      themeStyles,\n      overflow,\n      disableLineNumbers,\n      themeType: baseThemeType ?? themeType,\n      diffIndicators: 'none',\n      disableBackground: true,\n      totalLines,\n    });\n  }\n\n  private applyErrorToDOM(error: Error, container: HTMLElement) {\n    this.cleanupErrorWrapper();\n    const pre = this.getOrCreatePreNode(container);\n    pre.innerHTML = '';\n    pre.parentNode?.removeChild(pre);\n    this.pre = undefined;\n    const shadowRoot =\n      container.shadowRoot ?? container.attachShadow({ mode: 'open' });\n    this.errorWrapper ??= document.createElement('div');\n    this.errorWrapper.dataset.errorWrapper = '';\n    this.errorWrapper.innerHTML = '';\n    shadowRoot.appendChild(this.errorWrapper);\n    const errorMessage = document.createElement('div');\n    errorMessage.dataset.errorMessage = '';\n    errorMessage.innerText = error.message;\n    this.errorWrapper.appendChild(errorMessage);\n    const errorStack = document.createElement('pre');\n    errorStack.dataset.errorStack = '';\n    errorStack.innerText = error.stack ?? 'No Error Stack';\n    this.errorWrapper.appendChild(errorStack);\n  }\n\n  private cleanupErrorWrapper() {\n    this.errorWrapper?.parentNode?.removeChild(this.errorWrapper);\n    this.errorWrapper = undefined;\n  }\n}\n", "export class ScrollSyncManager {\n  isDeletionsScrolling: boolean = false;\n  isAdditionsScrolling: boolean = false;\n  timeoutId: NodeJS.Timeout = -1 as unknown as NodeJS.Timeout;\n  codeDeletions: HTMLElement | undefined;\n  codeAdditions: HTMLElement | undefined;\n\n  cleanUp(): void {\n    this.codeDeletions?.removeEventListener(\n      'scroll',\n      this.handleDeletionsScroll\n    );\n    this.codeAdditions?.removeEventListener(\n      'scroll',\n      this.handleAdditionsScroll\n    );\n    clearTimeout(this.timeoutId);\n    this.codeDeletions = undefined;\n    this.codeAdditions = undefined;\n  }\n\n  setup(\n    pre: HTMLPreElement,\n    codeDeletions?: HTMLElement,\n    codeAdditions?: HTMLElement\n  ): void {\n    // If no code elements were provided, lets try to find them in\n    // the pre element\n    if (codeDeletions == null || codeAdditions == null) {\n      for (const element of pre.children ?? []) {\n        if (!(element instanceof HTMLElement)) {\n          continue;\n        }\n        if ('deletions' in element.dataset) {\n          codeDeletions = element;\n        } else if ('additions' in element.dataset) {\n          codeAdditions = element;\n        }\n      }\n    }\n    if (codeAdditions == null || codeDeletions == null) {\n      this.cleanUp();\n      return;\n    }\n    this.codeDeletions?.removeEventListener(\n      'scroll',\n      this.handleDeletionsScroll\n    );\n    this.codeAdditions?.removeEventListener(\n      'scroll',\n      this.handleAdditionsScroll\n    );\n    this.codeDeletions = codeDeletions;\n    this.codeAdditions = codeAdditions;\n    codeDeletions.addEventListener('scroll', this.handleDeletionsScroll, {\n      passive: true,\n    });\n    codeAdditions.addEventListener('scroll', this.handleAdditionsScroll, {\n      passive: true,\n    });\n  }\n\n  private handleDeletionsScroll = () => {\n    if (this.isAdditionsScrolling) {\n      return;\n    }\n    this.isDeletionsScrolling = true;\n    clearTimeout(this.timeoutId);\n    this.timeoutId = setTimeout(() => {\n      this.isDeletionsScrolling = false;\n    }, 300);\n    this.codeAdditions?.scrollTo({\n      left: this.codeDeletions?.scrollLeft,\n    });\n  };\n\n  private handleAdditionsScroll = () => {\n    if (this.isDeletionsScrolling) {\n      return;\n    }\n    this.isAdditionsScrolling = true;\n    clearTimeout(this.timeoutId);\n    this.timeoutId = setTimeout(() => {\n      this.isAdditionsScrolling = false;\n    }, 300);\n    this.codeDeletions?.scrollTo({\n      left: this.codeAdditions?.scrollLeft,\n    });\n  };\n}\n", "import type { Element as HASTElement } from 'hast';\n\nimport { createHastElement } from './hast_utils';\n\nexport function createEmptyRowBuffer(size: number): HASTElement {\n  return createHastElement({\n    tagName: 'div',\n    properties: {\n      'data-buffer': '',\n      style: `grid-row: span ${size};min-height:calc(${size} * 1lh)`,\n    },\n  });\n}\n", "import type { Element as HASTElement } from 'hast';\n\nimport { createHastElement, createTextNodeElement } from './hast_utils';\n\nexport function createNoNewlineElement(\n  type: 'context' | 'change-addition' | 'change-deletion'\n): HASTElement {\n  return createHastElement({\n    tagName: 'div',\n    children: [\n      createHastElement({\n        tagName: 'span',\n        properties: { 'data-column-number': '' },\n      }),\n      createHastElement({\n        tagName: 'span',\n        children: [createTextNodeElement('No newline at end of file')],\n        properties: { 'data-column-content': '' },\n      }),\n    ],\n    properties: { 'data-no-newline': '', 'data-line-type': type },\n  });\n}\n", "import type { ElementContent, Element as HASTElement } from 'hast';\n\nimport type { ExpansionDirections, HunkSeparators } from '../types';\nimport {\n  createHastElement,\n  createIconElement,\n  createTextNodeElement,\n} from './hast_utils';\n\ninterface CreateSeparatorProps {\n  type: HunkSeparators;\n  content?: string;\n  expandIndex?: number;\n  chunked?: boolean;\n  slotName?: string;\n  isFirstHunk: boolean;\n  isLastHunk: boolean;\n}\n\nfunction createExpandButton(type: ExpansionDirections) {\n  return createHastElement({\n    tagName: 'div',\n    children: [\n      createIconElement({\n        name: type === 'both' ? 'diffs-icon-expand-all' : 'diffs-icon-expand',\n        properties: { 'data-icon': '' },\n      }),\n    ],\n    properties: {\n      'data-expand-button': '',\n      'data-expand-both': type === 'both' ? '' : undefined,\n      'data-expand-up': type === 'up' ? '' : undefined,\n      'data-expand-down': type === 'down' ? '' : undefined,\n    },\n  });\n}\n\nexport function createSeparator({\n  type,\n  content,\n  expandIndex,\n  chunked = false,\n  slotName,\n  isFirstHunk,\n  isLastHunk,\n}: CreateSeparatorProps): HASTElement {\n  const children = [];\n  if (type === 'metadata' && content != null) {\n    children.push(\n      createHastElement({\n        tagName: 'div',\n        children: [createTextNodeElement(content)],\n        properties: { 'data-separator-wrapper': '' },\n      })\n    );\n  }\n  if (type === 'line-info' && content != null) {\n    const contentChildren: ElementContent[] = [];\n    if (expandIndex != null) {\n      if (!chunked) {\n        contentChildren.push(\n          createExpandButton(\n            !isFirstHunk && !isLastHunk ? 'both' : isFirstHunk ? 'down' : 'up'\n          )\n        );\n      } else {\n        if (!isFirstHunk) {\n          contentChildren.push(createExpandButton('up'));\n        }\n        if (!isLastHunk) {\n          contentChildren.push(createExpandButton('down'));\n        }\n      }\n    }\n    contentChildren.push(\n      createHastElement({\n        tagName: 'div',\n        children: [\n          createHastElement({\n            tagName: 'span',\n            children: [createTextNodeElement(content)],\n            properties: { 'data-unmodified-lines': '' },\n          }),\n        ],\n        properties: { 'data-separator-content': '' },\n      })\n    );\n    children.push(\n      createHastElement({\n        tagName: 'div',\n        children: contentChildren,\n        properties: {\n          'data-separator-wrapper': '',\n          'data-separator-multi-button':\n            contentChildren.length > 2 ? '' : undefined,\n        },\n      })\n    );\n  }\n  if (type === 'custom' && slotName != null) {\n    children.push(\n      createHastElement({\n        tagName: 'slot',\n        properties: { name: slotName },\n      })\n    );\n  }\n  return createHastElement({\n    tagName: 'div',\n    children,\n    properties: {\n      'data-separator': children.length === 0 ? '' : type,\n      'data-expand-index': expandIndex,\n      'data-separator-first': isFirstHunk ? '' : undefined,\n      'data-separator-last': isLastHunk ? '' : undefined,\n    },\n  });\n}\n", "export function getHunkSeparatorSlotName(\n  type: 'unified' | 'additions' | 'deletions',\n  hunkIndex: number\n) {\n  return `hunk-separator-${type}-${hunkIndex}`;\n}\n", "import type { Hunk } from '../types';\n\nexport function getTotalLineCountFromHunks(hunks: Hunk[]): number {\n  const lastHunk = hunks[hunks.length - 1];\n  if (lastHunk == null) {\n    return 0;\n  }\n  return Math.max(\n    lastHunk.additionStart + lastHunk.additionCount,\n    lastHunk.deletionStart + lastHunk.deletionCount\n  );\n}\n", "import type { ElementContent, Element as HASTElement } from 'hast';\nimport { toHtml } from 'hast-util-to-html';\n\nimport { DEFAULT_THEMES } from '../constants';\nimport { areLanguagesAttached } from '../highlighter/languages/areLanguagesAttached';\nimport {\n  getHighlighterIfLoaded,\n  getSharedHighlighter,\n} from '../highlighter/shared_highlighter';\nimport { areThemesAttached } from '../highlighter/themes/areThemesAttached';\nimport type {\n  AnnotationLineMap,\n  AnnotationSpan,\n  BaseDiffOptions,\n  DiffLineAnnotation,\n  DiffsHighlighter,\n  ExpansionDirections,\n  FileDiffMetadata,\n  Hunk,\n  HunkData,\n  RenderDiffFilesResult,\n  RenderDiffHunksResult,\n  RenderDiffOptions,\n  RenderDiffResult,\n  RenderedDiffASTCache,\n  SupportedLanguages,\n  ThemeTypes,\n  ThemedDiffResult,\n} from '../types';\nimport { areThemesEqual } from '../utils/areThemesEqual';\nimport { createAnnotationElement } from '../utils/createAnnotationElement';\nimport { createEmptyRowBuffer } from '../utils/createEmptyRowBuffer';\nimport { createFileHeaderElement } from '../utils/createFileHeaderElement';\nimport { createNoNewlineElement } from '../utils/createNoNewlineElement';\nimport { createPreElement } from '../utils/createPreElement';\nimport { createSeparator } from '../utils/createSeparator';\nimport { getFiletypeFromFileName } from '../utils/getFiletypeFromFileName';\nimport { getHighlighterOptions } from '../utils/getHighlighterOptions';\nimport { getHunkSeparatorSlotName } from '../utils/getHunkSeparatorSlotName';\nimport { getLineAnnotationName } from '../utils/getLineAnnotationName';\nimport { getTotalLineCountFromHunks } from '../utils/getTotalLineCountFromHunks';\nimport { createHastElement } from '../utils/hast_utils';\nimport { renderDiffWithHighlighter } from '../utils/renderDiffWithHighlighter';\nimport type { WorkerPoolManager } from '../worker';\n\nconst EXPANDED_REGION: ExpansionRegion = {\n  fromStart: 0,\n  fromEnd: 0,\n};\n\ninterface PushHunkSeparatorProps {\n  type: 'additions' | 'deletions' | 'unified';\n  linesAST: ElementContent[];\n}\n\ninterface RenderRangeProps {\n  rangeLen: number;\n  fromStart: boolean;\n}\n\ninterface PushLineWithAnnotation {\n  newLine?: ElementContent;\n  oldLine?: ElementContent;\n\n  unifiedAST?: ElementContent[];\n  deletionsAST?: ElementContent[];\n  additionsAST?: ElementContent[];\n\n  unifiedSpan?: AnnotationSpan;\n  deletionSpan?: AnnotationSpan;\n  additionSpan?: AnnotationSpan;\n}\n\ninterface RenderCollapsedHunksProps {\n  ast: RenderDiffFilesResult | RenderDiffHunksResult;\n  hunkData: HunkData[];\n  hunkIndex: number;\n  hunkSpecs: string | undefined;\n  isFirstHunk: boolean;\n  isLastHunk: boolean;\n  rangeSize: number;\n\n  lineIndex: number;\n  additionLineNumber: number;\n  deletionLineNumber: number;\n\n  additionsAST: ElementContent[];\n  deletionsAST: ElementContent[];\n  unifiedAST: ElementContent[];\n}\n\ninterface RenderHunkProps {\n  hunk: Hunk;\n  hunkData: HunkData[];\n  hunkIndex: number;\n  lineIndex: number;\n  isLastHunk: boolean;\n  prevHunk: Hunk | undefined;\n\n  ast: RenderDiffFilesResult | RenderDiffHunksResult;\n  unifiedAST: ElementContent[];\n  deletionsAST: ElementContent[];\n  additionsAST: ElementContent[];\n}\n\ninterface GetRenderOptionsReturn {\n  options: RenderDiffOptions;\n  forceRender: boolean;\n}\n\ntype OptionsWithDefaults = Required<\n  Omit<BaseDiffOptions, 'lang' | 'unsafeCSS'>\n>;\n\ninterface ExpansionRegion {\n  fromStart: number;\n  fromEnd: number;\n}\n\nexport interface HunksRenderResult {\n  additionsAST: ElementContent[] | undefined;\n  deletionsAST: ElementContent[] | undefined;\n  unifiedAST: ElementContent[] | undefined;\n  hunkData: HunkData[];\n  css: string;\n  preNode: HASTElement;\n  headerElement: HASTElement | undefined;\n  totalLines: number;\n  themeStyles: string;\n  baseThemeType: 'light' | 'dark' | undefined;\n}\n\nexport class DiffHunksRenderer<LAnnotation = undefined> {\n  private highlighter: DiffsHighlighter | undefined;\n  private diff: FileDiffMetadata | undefined;\n\n  private expandedHunks = new Map<number, ExpansionRegion>();\n\n  private deletionAnnotations: AnnotationLineMap<LAnnotation> = {};\n  private additionAnnotations: AnnotationLineMap<LAnnotation> = {};\n\n  private computedLang: SupportedLanguages = 'text';\n  private renderCache: RenderedDiffASTCache | undefined;\n\n  constructor(\n    public options: BaseDiffOptions = { theme: DEFAULT_THEMES },\n    private onRenderUpdate?: () => unknown,\n    private workerManager?: WorkerPoolManager | undefined\n  ) {\n    if (workerManager?.isWorkingPool() !== true) {\n      this.highlighter = areThemesAttached(options.theme ?? DEFAULT_THEMES)\n        ? getHighlighterIfLoaded()\n        : undefined;\n    }\n  }\n\n  cleanUp(): void {\n    this.highlighter = undefined;\n    this.diff = undefined;\n    this.renderCache = undefined;\n    this.workerManager = undefined;\n    this.onRenderUpdate = undefined;\n  }\n\n  setOptions(options: BaseDiffOptions): void {\n    this.options = options;\n  }\n\n  private mergeOptions(options: Partial<BaseDiffOptions>) {\n    this.options = { ...this.options, ...options };\n  }\n\n  setThemeType(themeType: ThemeTypes): void {\n    if (this.getOptionsWithDefaults().themeType === themeType) {\n      return;\n    }\n    this.mergeOptions({ themeType });\n  }\n\n  expandHunk(index: number, direction: ExpansionDirections): void {\n    const { expansionLineCount } = this.getOptionsWithDefaults();\n    const region = this.expandedHunks.get(index) ?? {\n      fromStart: 0,\n      fromEnd: 0,\n    };\n    if (direction === 'up' || direction === 'both') {\n      region.fromStart += expansionLineCount;\n    }\n    if (direction === 'down' || direction === 'both') {\n      region.fromEnd += expansionLineCount;\n    }\n    this.expandedHunks.set(index, region);\n  }\n\n  setLineAnnotations(lineAnnotations: DiffLineAnnotation<LAnnotation>[]): void {\n    this.additionAnnotations = {};\n    this.deletionAnnotations = {};\n    for (const annotation of lineAnnotations) {\n      const map = ((): AnnotationLineMap<LAnnotation> => {\n        switch (annotation.side) {\n          case 'deletions':\n            return this.deletionAnnotations;\n          case 'additions':\n            return this.additionAnnotations;\n        }\n      })();\n      const arr = map[annotation.lineNumber] ?? [];\n      map[annotation.lineNumber] = arr;\n      arr.push(annotation);\n    }\n  }\n\n  getOptionsWithDefaults(): OptionsWithDefaults {\n    const {\n      diffIndicators = 'bars',\n      diffStyle = 'split',\n      disableBackground = false,\n      disableFileHeader = false,\n      disableLineNumbers = false,\n      expandUnchanged = false,\n      expansionLineCount = 100,\n      hunkSeparators = 'line-info',\n      lineDiffType = 'word-alt',\n      maxLineDiffLength = 1000,\n      overflow = 'scroll',\n      theme = DEFAULT_THEMES,\n      themeType = 'system',\n      tokenizeMaxLineLength = 1000,\n      useCSSClasses = false,\n    } = this.options;\n    return {\n      diffIndicators,\n      diffStyle,\n      disableBackground,\n      disableFileHeader,\n      disableLineNumbers,\n      expandUnchanged,\n      expansionLineCount,\n      hunkSeparators,\n      lineDiffType,\n      maxLineDiffLength,\n      overflow,\n      theme: this.workerManager?.getDiffRenderOptions().theme ?? theme,\n      themeType,\n      tokenizeMaxLineLength,\n      useCSSClasses,\n    };\n  }\n\n  async initializeHighlighter(): Promise<DiffsHighlighter> {\n    this.highlighter = await getSharedHighlighter(\n      getHighlighterOptions(this.computedLang, this.options)\n    );\n    return this.highlighter;\n  }\n\n  hydrate(diff: FileDiffMetadata | undefined): void {\n    if (diff == null) {\n      return;\n    }\n    this.diff = diff;\n    const { options } = this.getRenderOptions(diff);\n    let cache = this.workerManager?.getDiffResultCache(diff);\n    if (cache != null && !areRenderOptionsEqual(options, cache.options)) {\n      cache = undefined;\n    }\n    this.renderCache ??= {\n      diff,\n      // NOTE(amadeus): If we're hydrating, we can assume there was\n      // pre-rendered HTML, otherwise one should not be hydrating\n      highlighted: true,\n      options,\n      result: cache?.result,\n    };\n    if (\n      this.workerManager?.isWorkingPool() === true &&\n      this.renderCache.result == null\n    ) {\n      this.workerManager.highlightDiffAST(this, this.diff);\n    } else {\n      void this.asyncHighlight(diff).then(({ result, options }) => {\n        this.onHighlightSuccess(diff, result, options);\n      });\n    }\n  }\n\n  private getRenderOptions(diff: FileDiffMetadata): GetRenderOptionsReturn {\n    const options: RenderDiffOptions = (() => {\n      if (this.workerManager?.isWorkingPool() === true) {\n        return this.workerManager.getDiffRenderOptions();\n      }\n      const { theme, tokenizeMaxLineLength, lineDiffType } =\n        this.getOptionsWithDefaults();\n      return { theme, tokenizeMaxLineLength, lineDiffType };\n    })();\n    this.getOptionsWithDefaults();\n    const { renderCache } = this;\n    if (renderCache?.result == null) {\n      return { options, forceRender: true };\n    }\n    if (\n      diff !== renderCache.diff ||\n      !areRenderOptionsEqual(options, renderCache.options)\n    ) {\n      return { options, forceRender: true };\n    }\n    return { options, forceRender: false };\n  }\n\n  renderDiff(\n    diff: FileDiffMetadata | undefined = this.renderCache?.diff\n  ): HunksRenderResult | undefined {\n    if (diff == null) {\n      return undefined;\n    }\n    const cache = this.workerManager?.getDiffResultCache(diff);\n    if (cache != null && this.renderCache == null) {\n      this.renderCache = { diff, highlighted: true, ...cache };\n    }\n    const { options, forceRender } = this.getRenderOptions(diff);\n    this.renderCache ??= {\n      diff,\n      highlighted: false,\n      options,\n      result: undefined,\n    };\n    if (this.workerManager?.isWorkingPool() === true) {\n      this.renderCache.result ??= this.workerManager.getPlainDiffAST(diff);\n      if (!this.renderCache.highlighted || forceRender) {\n        this.workerManager.highlightDiffAST(this, diff);\n      }\n    } else {\n      this.computedLang = diff.lang ?? getFiletypeFromFileName(diff.name);\n      const hasThemes =\n        this.highlighter != null && areThemesAttached(options.theme);\n      const hasLangs =\n        this.highlighter != null && areLanguagesAttached(this.computedLang);\n\n      // If we have any semblance of a highlighter with the correct theme(s)\n      // attached, we can kick off some form of rendering.  If we don't have\n      // the correct language, then we can render plain text and after kick off\n      // an async job to get the highlighted AST\n      if (\n        this.highlighter != null &&\n        hasThemes &&\n        (forceRender ||\n          (!this.renderCache.highlighted && hasLangs) ||\n          this.renderCache.result == null)\n      ) {\n        const { result, options } = this.renderDiffWithHighlighter(\n          diff,\n          this.highlighter,\n          !hasLangs\n        );\n        this.renderCache = {\n          diff,\n          options,\n          highlighted: hasLangs,\n          result,\n        };\n      }\n\n      // If we get in here it means we'll have to kick off an async highlight\n      // process which will involve initializing the highlighter with new themes\n      // and languages\n      if (!hasThemes || !hasLangs) {\n        void this.asyncHighlight(diff).then(({ result, options }) => {\n          this.onHighlightSuccess(diff, result, options);\n        });\n      }\n    }\n    return this.renderCache.result != null\n      ? this.processDiffResult(this.renderCache.diff, this.renderCache.result)\n      : undefined;\n  }\n\n  async asyncRender(diff: FileDiffMetadata): Promise<HunksRenderResult> {\n    const { result } = await this.asyncHighlight(diff);\n    return this.processDiffResult(diff, result);\n  }\n\n  private createPreElement(\n    split: boolean,\n    totalLines: number,\n    themeStyles: string,\n    baseThemeType: 'light' | 'dark' | undefined\n  ): HASTElement {\n    const {\n      diffIndicators,\n      disableBackground,\n      disableLineNumbers,\n      overflow,\n      themeType,\n    } = this.getOptionsWithDefaults();\n    return createPreElement({\n      diffIndicators,\n      disableBackground,\n      disableLineNumbers,\n      overflow,\n      themeStyles,\n      split,\n      themeType: baseThemeType ?? themeType,\n      totalLines,\n    });\n  }\n\n  private async asyncHighlight(\n    diff: FileDiffMetadata\n  ): Promise<RenderDiffResult> {\n    this.computedLang = diff.lang ?? getFiletypeFromFileName(diff.name);\n    const hasThemes =\n      this.highlighter != null &&\n      areThemesAttached(this.options.theme ?? DEFAULT_THEMES);\n    const hasLangs =\n      this.highlighter != null && areLanguagesAttached(this.computedLang);\n    // If we don't have the required langs or themes, then we need to\n    // initialize the highlighter to load the appropriate languages and themes\n    if (this.highlighter == null || !hasThemes || !hasLangs) {\n      this.highlighter = await this.initializeHighlighter();\n    }\n    return this.renderDiffWithHighlighter(diff, this.highlighter);\n  }\n\n  private renderDiffWithHighlighter(\n    diff: FileDiffMetadata,\n    highlighter: DiffsHighlighter,\n    plainText = false\n  ): RenderDiffResult {\n    const { options } = this.getRenderOptions(diff);\n    const result = renderDiffWithHighlighter(\n      diff,\n      highlighter,\n      options,\n      plainText\n    );\n    return { result, options };\n  }\n\n  onHighlightSuccess(\n    diff: FileDiffMetadata,\n    result: ThemedDiffResult,\n    options: RenderDiffOptions\n  ): void {\n    // If renderCache was blown away, we can assume we've run cleanUp()\n    if (this.renderCache == null) {\n      return;\n    }\n    const triggerRenderUpdate =\n      this.renderCache.diff !== diff ||\n      !this.renderCache.highlighted ||\n      !areRenderOptionsEqual(this.renderCache.options, options);\n\n    this.renderCache = {\n      diff,\n      options,\n      highlighted: true,\n      result,\n    };\n    if (triggerRenderUpdate) {\n      this.onRenderUpdate?.();\n    }\n  }\n\n  onHighlightError(error: unknown): void {\n    console.error(error);\n  }\n\n  private processDiffResult(\n    fileDiff: FileDiffMetadata,\n    { code, themeStyles, baseThemeType }: ThemedDiffResult\n  ): HunksRenderResult {\n    const { diffStyle, disableFileHeader } = this.getOptionsWithDefaults();\n\n    this.diff = fileDiff;\n    const unified = diffStyle === 'unified';\n\n    let additionsAST: ElementContent[] | undefined = [];\n    let deletionsAST: ElementContent[] | undefined = [];\n    let unifiedAST: ElementContent[] | undefined = [];\n\n    let hunkIndex = 0;\n    const hunkData: HunkData[] = [];\n\n    let prevHunk: Hunk | undefined;\n    let lineIndex = 0;\n    for (const hunk of fileDiff.hunks) {\n      lineIndex += hunk.collapsedBefore;\n      lineIndex = this.renderHunks({\n        ast: code,\n        hunk,\n        prevHunk,\n        hunkIndex,\n        isLastHunk: hunkIndex === fileDiff.hunks.length - 1,\n        additionsAST,\n        deletionsAST,\n        unifiedAST,\n        hunkData,\n        lineIndex,\n      });\n      hunkIndex++;\n      prevHunk = hunk;\n    }\n\n    const totalLines = Math.max(\n      getTotalLineCountFromHunks(fileDiff.hunks),\n      fileDiff.newLines?.length ?? 0,\n      fileDiff.oldLines?.length ?? 0\n    );\n\n    additionsAST =\n      !unified && (code.hunks != null || code.newLines.length > 0)\n        ? additionsAST\n        : undefined;\n    deletionsAST =\n      !unified && (code.hunks != null || code.oldLines.length > 0)\n        ? deletionsAST\n        : undefined;\n    unifiedAST = unifiedAST.length > 0 ? unifiedAST : undefined;\n\n    const preNode = this.createPreElement(\n      deletionsAST != null && additionsAST != null,\n      totalLines,\n      themeStyles,\n      baseThemeType\n    );\n\n    return {\n      additionsAST,\n      deletionsAST,\n      unifiedAST,\n      hunkData,\n      preNode,\n      themeStyles,\n      baseThemeType,\n      headerElement: !disableFileHeader\n        ? this.renderHeader(this.diff, themeStyles, baseThemeType)\n        : undefined,\n      totalLines,\n      // FIXME\n      css: '',\n    };\n  }\n\n  renderFullAST(\n    result: HunksRenderResult,\n    children: ElementContent[] = []\n  ): HASTElement {\n    if (result.unifiedAST != null) {\n      children.push(\n        createHastElement({\n          tagName: 'code',\n          children: result.unifiedAST,\n          properties: {\n            'data-code': '',\n            'data-unified': '',\n          },\n        })\n      );\n    }\n    if (result.deletionsAST != null) {\n      children.push(\n        createHastElement({\n          tagName: 'code',\n          children: result.deletionsAST,\n          properties: {\n            'data-code': '',\n            'data-deletions': '',\n          },\n        })\n      );\n    }\n    if (result.additionsAST != null) {\n      children.push(\n        createHastElement({\n          tagName: 'code',\n          children: result.additionsAST,\n          properties: {\n            'data-code': '',\n            'data-additions': '',\n          },\n        })\n      );\n    }\n    return { ...result.preNode, children };\n  }\n\n  renderFullHTML(\n    result: HunksRenderResult,\n    tempChildren: ElementContent[] = []\n  ): string {\n    return toHtml(this.renderFullAST(result, tempChildren));\n  }\n\n  renderPartialHTML(\n    children: ElementContent[],\n    columnType?: 'unified' | 'deletions' | 'additions'\n  ): string {\n    if (columnType == null) {\n      return toHtml(children);\n    }\n    return toHtml(\n      createHastElement({\n        tagName: 'code',\n        children,\n        properties: {\n          'data-code': '',\n          [`data-${columnType}`]: '',\n        },\n      })\n    );\n  }\n\n  private renderCollapsedHunks({\n    ast,\n    hunkData,\n    hunkIndex,\n    hunkSpecs,\n    isFirstHunk,\n    isLastHunk,\n    rangeSize,\n    lineIndex,\n    additionLineNumber,\n    deletionLineNumber,\n    unifiedAST,\n    deletionsAST,\n    additionsAST,\n  }: RenderCollapsedHunksProps) {\n    if (rangeSize <= 0) {\n      return;\n    }\n    const { hunkSeparators, expandUnchanged, diffStyle, expansionLineCount } =\n      this.getOptionsWithDefaults();\n    const expandable =\n      ast.hunks == null && ast.newLines.length > 0 && ast.oldLines.length > 0;\n    const expandedRegion = this.expandedHunks.get(hunkIndex) ?? EXPANDED_REGION;\n    const chunked = rangeSize > expansionLineCount;\n    const collapsedLines = Math.max(\n      !expandUnchanged\n        ? rangeSize - (expandedRegion.fromEnd + expandedRegion.fromStart)\n        : 0,\n      0\n    );\n\n    const pushHunkSeparator = ({ type, linesAST }: PushHunkSeparatorProps) => {\n      if (hunkSeparators === 'line-info' || hunkSeparators === 'custom') {\n        const slotName = getHunkSeparatorSlotName(type, hunkIndex);\n        linesAST.push(\n          createSeparator({\n            type: hunkSeparators,\n            content: getModifiedLinesString(collapsedLines),\n            expandIndex: expandable ? hunkIndex : undefined,\n            chunked,\n            slotName,\n            isFirstHunk,\n            isLastHunk,\n          })\n        );\n        hunkData.push({\n          slotName,\n          hunkIndex,\n          lines: collapsedLines,\n          type,\n          expandable: expandable\n            ? {\n                up: expandable && !isFirstHunk,\n                down: expandable,\n                chunked,\n              }\n            : undefined,\n        });\n      } else if (hunkSeparators === 'metadata' && hunkSpecs != null) {\n        linesAST.push(\n          createSeparator({\n            type: 'metadata',\n            content: hunkSpecs,\n            isFirstHunk,\n            isLastHunk,\n          })\n        );\n      } else if (hunkSeparators === 'simple' && hunkIndex > 0) {\n        linesAST.push(\n          createSeparator({ type: 'simple', isFirstHunk, isLastHunk: false })\n        );\n      }\n    };\n\n    const renderRange = ({ rangeLen, fromStart }: RenderRangeProps) => {\n      if (ast.newLines == null || ast.oldLines == null) {\n        return;\n      }\n\n      const offset = isLastHunk ? 0 : fromStart ? rangeSize : rangeLen;\n      let dLineNumber = deletionLineNumber - offset;\n      let aLineNumber = additionLineNumber - offset;\n      let lIndex = lineIndex - offset;\n\n      for (let i = 0; i < rangeLen; i++) {\n        const oldLine = ast.oldLines[dLineNumber];\n        const newLine = ast.newLines[aLineNumber];\n        if (oldLine == null || newLine == null) {\n          console.error({ aLineNumber, dLineNumber, ast });\n          throw new Error(\n            'DiffHunksRenderer.renderHunks prefill context invalid. Must include data for old and new lines'\n          );\n        }\n        dLineNumber++;\n        aLineNumber++;\n\n        if (diffStyle === 'unified') {\n          this.pushLineWithAnnotation({\n            newLine,\n            unifiedAST,\n            unifiedSpan: this.getAnnotations(\n              'unified',\n              dLineNumber,\n              aLineNumber,\n              hunkIndex,\n              lIndex\n            ),\n          });\n        } else {\n          this.pushLineWithAnnotation({\n            newLine,\n            oldLine,\n            additionsAST,\n            deletionsAST,\n            ...this.getAnnotations(\n              'split',\n              dLineNumber,\n              aLineNumber,\n              hunkIndex,\n              lIndex\n            ),\n          });\n        }\n        lIndex++;\n      }\n    };\n\n    if (expandable) {\n      renderRange({\n        rangeLen: Math.min(\n          collapsedLines === 0 || expandUnchanged\n            ? rangeSize\n            : expandedRegion.fromStart,\n          rangeSize\n        ),\n        fromStart: true,\n      });\n    }\n\n    if (collapsedLines > 0) {\n      if (diffStyle === 'unified') {\n        pushHunkSeparator({ type: 'unified', linesAST: unifiedAST });\n      } else {\n        pushHunkSeparator({ type: 'deletions', linesAST: deletionsAST });\n        pushHunkSeparator({ type: 'additions', linesAST: additionsAST });\n      }\n    }\n\n    if (collapsedLines > 0 && expandedRegion.fromEnd > 0 && !isLastHunk) {\n      renderRange({\n        rangeLen: Math.min(expandedRegion.fromEnd, rangeSize),\n        fromStart: false,\n      });\n    }\n  }\n\n  private renderHunks({\n    hunk,\n    hunkData,\n    hunkIndex,\n    lineIndex,\n    isLastHunk,\n    prevHunk,\n    ast,\n    deletionsAST,\n    additionsAST,\n    unifiedAST,\n  }: RenderHunkProps): number {\n    const { diffStyle } = this.getOptionsWithDefaults();\n    const unified = diffStyle === 'unified';\n    let additionLineNumber = hunk.additionStart - 1;\n    let deletionLineNumber = hunk.deletionStart - 1;\n\n    this.renderCollapsedHunks({\n      additionLineNumber,\n      additionsAST,\n      ast,\n      deletionLineNumber,\n      deletionsAST,\n      hunkData,\n      hunkIndex,\n      hunkSpecs: hunk.hunkSpecs,\n      isFirstHunk: prevHunk == null,\n      isLastHunk: false,\n      lineIndex,\n      rangeSize: Math.max(hunk.collapsedBefore, 0),\n      unifiedAST,\n    });\n\n    let { oldLines, newLines, oldIndex, newIndex } = (() => {\n      if (ast.hunks != null) {\n        const lineHunk = ast.hunks[hunkIndex];\n        if (lineHunk == null) {\n          console.error({ ast, hunkIndex });\n          throw new Error(\n            `DiffHunksRenderer.renderHunks: lineHunk doesn't exist`\n          );\n        }\n        return {\n          oldLines: lineHunk.oldLines,\n          newLines: lineHunk.newLines,\n          oldIndex: 0,\n          newIndex: 0,\n        };\n      }\n      return {\n        oldLines: ast.oldLines,\n        newLines: ast.newLines,\n        oldIndex: deletionLineNumber,\n        newIndex: additionLineNumber,\n      };\n    })();\n\n    // Render hunk/diff content\n    for (const hunkContent of hunk.hunkContent) {\n      if (hunkContent.type === 'context') {\n        const { length: len } = hunkContent.lines;\n        for (let i = 0; i < len; i++) {\n          const oldLine = oldLines[oldIndex];\n          const newLine = newLines[newIndex];\n          oldIndex++;\n          newIndex++;\n          additionLineNumber++;\n          deletionLineNumber++;\n          if (unified) {\n            if (newLine == null) {\n              throw new Error(\n                'DiffHunksRenderer.renderHunks: newLine doesnt exist for context...'\n              );\n            }\n            this.pushLineWithAnnotation({\n              newLine,\n              unifiedAST,\n              unifiedSpan: this.getAnnotations(\n                'unified',\n                deletionLineNumber,\n                additionLineNumber,\n                hunkIndex,\n                lineIndex\n              ),\n            });\n          } else {\n            if (newLine == null || oldLine == null) {\n              throw new Error(\n                'DiffHunksRenderer.renderHunks: newLine or oldLine doesnt exist for context...'\n              );\n            }\n            this.pushLineWithAnnotation({\n              oldLine,\n              newLine,\n              deletionsAST,\n              additionsAST,\n              ...this.getAnnotations(\n                'split',\n                deletionLineNumber,\n                additionLineNumber,\n                hunkIndex,\n                lineIndex\n              ),\n            });\n          }\n          lineIndex++;\n        }\n        if (hunkContent.noEOFCR) {\n          const node = createNoNewlineElement('context');\n          if (unified) {\n            unifiedAST.push(node);\n          } else {\n            deletionsAST.push(node);\n            additionsAST.push(node);\n          }\n        }\n      } else {\n        const { length: dLen } = hunkContent.deletions;\n        const { length: aLen } = hunkContent.additions;\n        const len = unified ? dLen + aLen : Math.max(dLen, aLen);\n        let spanSize = 0;\n        for (let i = 0; i < len; i++) {\n          const { oldLine, newLine } = (() => {\n            let oldLine: ElementContent | undefined = oldLines[oldIndex];\n            let newLine: ElementContent | undefined = newLines[newIndex];\n            if (unified) {\n              if (i < dLen) {\n                newLine = undefined;\n              } else {\n                oldLine = undefined;\n              }\n            } else {\n              if (i >= dLen) {\n                oldLine = undefined;\n              }\n              if (i >= aLen) {\n                newLine = undefined;\n              }\n            }\n            if (oldLine == null && newLine == null) {\n              console.error({ i, len, ast, hunkContent });\n              throw new Error(\n                'renderHunks: oldLine and newLine are null, something is wrong'\n              );\n            }\n            return { oldLine, newLine };\n          })();\n\n          if (oldLine != null) {\n            oldIndex++;\n            deletionLineNumber++;\n          }\n          if (newLine != null) {\n            newIndex++;\n            additionLineNumber++;\n          }\n\n          if (unified) {\n            this.pushLineWithAnnotation({\n              oldLine,\n              newLine,\n              unifiedAST,\n              unifiedSpan: this.getAnnotations(\n                'unified',\n                oldLine != null ? deletionLineNumber : undefined,\n                newLine != null ? additionLineNumber : undefined,\n                hunkIndex,\n                lineIndex\n              ),\n            });\n            lineIndex++;\n          } else {\n            if (oldLine == null || newLine == null) {\n              spanSize++;\n            }\n            const annotationSpans = this.getAnnotations(\n              'split',\n              oldLine != null ? deletionLineNumber : undefined,\n              newLine != null ? additionLineNumber : undefined,\n              hunkIndex,\n              lineIndex\n            );\n            if (annotationSpans != null) {\n              if (spanSize > 0) {\n                if (aLen > dLen) {\n                  deletionsAST.push(createEmptyRowBuffer(spanSize));\n                } else {\n                  additionsAST.push(createEmptyRowBuffer(spanSize));\n                }\n                spanSize = 0;\n              }\n            }\n            this.pushLineWithAnnotation({\n              newLine,\n              oldLine,\n              deletionsAST,\n              additionsAST,\n              ...annotationSpans,\n            });\n            lineIndex++;\n          }\n        }\n        if (!unified) {\n          if (spanSize > 0) {\n            if (aLen > dLen) {\n              deletionsAST.push(createEmptyRowBuffer(spanSize));\n            } else {\n              additionsAST.push(createEmptyRowBuffer(spanSize));\n            }\n            spanSize = 0;\n          }\n          if (hunkContent.noEOFCRDeletions) {\n            deletionsAST.push(createNoNewlineElement('change-deletion'));\n            if (!hunkContent.noEOFCRAdditions) {\n              additionsAST.push(createEmptyRowBuffer(1));\n            }\n          }\n          if (hunkContent.noEOFCRAdditions) {\n            additionsAST.push(createNoNewlineElement('change-addition'));\n            if (!hunkContent.noEOFCRDeletions) {\n              deletionsAST.push(createEmptyRowBuffer(1));\n            }\n          }\n        }\n      }\n    }\n\n    if (isLastHunk && ast.newLines != null && ast.newLines.length > 0) {\n      this.renderCollapsedHunks({\n        additionLineNumber,\n        additionsAST,\n        ast,\n        deletionLineNumber,\n        deletionsAST,\n        hunkData,\n        hunkIndex: hunkIndex + 1,\n        hunkSpecs: undefined,\n        isFirstHunk: false,\n        isLastHunk: true,\n        lineIndex,\n        rangeSize: Math.max(\n          ast.newLines.length -\n            Math.max(hunk.additionStart + hunk.additionCount - 1, 0),\n          0\n        ),\n        unifiedAST,\n      });\n    }\n    return lineIndex;\n  }\n\n  private pushLineWithAnnotation({\n    newLine,\n    oldLine,\n    unifiedAST,\n    additionsAST,\n    deletionsAST,\n    unifiedSpan,\n    deletionSpan,\n    additionSpan,\n  }: PushLineWithAnnotation) {\n    if (unifiedAST != null) {\n      if (oldLine != null) {\n        unifiedAST.push(oldLine);\n      } else if (newLine != null) {\n        unifiedAST.push(newLine);\n      }\n      if (unifiedSpan != null) {\n        unifiedAST.push(createAnnotationElement(unifiedSpan));\n      }\n    } else if (deletionsAST != null && additionsAST != null) {\n      if (oldLine != null) {\n        deletionsAST.push(oldLine);\n      }\n      if (newLine != null) {\n        additionsAST.push(newLine);\n      }\n      if (deletionSpan != null) {\n        deletionsAST.push(createAnnotationElement(deletionSpan));\n      }\n      if (additionSpan != null) {\n        additionsAST.push(createAnnotationElement(additionSpan));\n      }\n    }\n  }\n\n  private getAnnotations(\n    type: 'unified',\n    oldLineNumber: number | undefined,\n    newLineNumber: number | undefined,\n    hunkIndex: number,\n    lineIndex: number\n  ): AnnotationSpan | undefined;\n  private getAnnotations(\n    type: 'split',\n    oldLineNumber: number | undefined,\n    newLineNumber: number | undefined,\n    hunkIndex: number,\n    lineIndex: number\n  ): { deletionSpan: AnnotationSpan; additionSpan: AnnotationSpan } | undefined;\n  private getAnnotations(\n    type: 'unified' | 'split',\n    oldLineNumber: number | undefined,\n    newLineNumber: number | undefined,\n    hunkIndex: number,\n    lineIndex: number\n  ):\n    | AnnotationSpan\n    | { deletionSpan: AnnotationSpan; additionSpan: AnnotationSpan }\n    | undefined {\n    const deletionSpan: AnnotationSpan = {\n      type: 'annotation',\n      hunkIndex,\n      lineIndex,\n      annotations: [],\n    };\n    if (oldLineNumber != null) {\n      for (const anno of this.deletionAnnotations[oldLineNumber] ?? []) {\n        deletionSpan.annotations.push(getLineAnnotationName(anno));\n      }\n    }\n    const additionSpan: AnnotationSpan = {\n      type: 'annotation',\n      hunkIndex,\n      lineIndex,\n      annotations: [],\n    };\n    if (newLineNumber != null) {\n      for (const anno of this.additionAnnotations[newLineNumber] ?? []) {\n        (type === 'unified' ? deletionSpan : additionSpan).annotations.push(\n          getLineAnnotationName(anno)\n        );\n      }\n    }\n    if (type === 'unified') {\n      if (deletionSpan.annotations.length > 0) {\n        return deletionSpan;\n      }\n      return undefined;\n    }\n    if (\n      additionSpan.annotations.length === 0 &&\n      deletionSpan.annotations.length === 0\n    ) {\n      return undefined;\n    }\n    return { deletionSpan, additionSpan };\n  }\n\n  private renderHeader(\n    diff: FileDiffMetadata,\n    themeStyles: string,\n    baseThemeType: 'light' | 'dark' | undefined\n  ): HASTElement {\n    const { themeType } = this.getOptionsWithDefaults();\n    return createFileHeaderElement({\n      fileOrDiff: diff,\n      themeStyles,\n      themeType: baseThemeType ?? themeType,\n    });\n  }\n}\n\nfunction areRenderOptionsEqual(\n  optionsA: RenderDiffOptions,\n  optionsB: RenderDiffOptions\n): boolean {\n  return (\n    areThemesEqual(optionsA.theme, optionsB.theme) &&\n    optionsA.tokenizeMaxLineLength === optionsB.tokenizeMaxLineLength &&\n    optionsA.lineDiffType === optionsB.lineDiffType\n  );\n}\n\nfunction getModifiedLinesString(lines: number) {\n  return `${lines} unmodified line${lines > 1 ? 's' : ''}`;\n}\n", "import type { HunkLineType } from '../types';\n\nexport interface ParsedLine {\n  line: string;\n  type: Exclude<HunkLineType, 'expanded'>;\n}\n\nexport function parseLineType(line: string): ParsedLine | undefined {\n  const firstChar = line[0];\n  if (\n    firstChar !== '+' &&\n    firstChar !== '-' &&\n    firstChar !== ' ' &&\n    firstChar !== '\\\\'\n  ) {\n    console.error(\n      `parseLineType: Invalid firstChar: \"${firstChar}\", full line: \"${line}\"`\n    );\n    return undefined;\n  }\n  return {\n    line: line.substring(1),\n    type:\n      firstChar === ' '\n        ? 'context'\n        : firstChar === '\\\\'\n          ? 'metadata'\n          : firstChar === '+'\n            ? 'addition'\n            : 'deletion',\n  };\n}\n", "import {\n  ALTERNATE_FILE_NAMES_GIT,\n  COMMIT_METADATA_SPLIT,\n  FILENAME_HEADER_REGEX,\n  FILENAME_HEADER_REGEX_GIT,\n  FILE_CONTEXT_BLOB,\n  FILE_MODE_FROM_INDEX,\n  GIT_DIFF_FILE_BREAK_REGEX,\n  HUNK_HEADER,\n  SPLIT_WITH_NEWLINES,\n  UNIFIED_DIFF_FILE_BREAK_REGEX,\n} from '../constants';\nimport type {\n  ChangeContent,\n  ContextContent,\n  FileDiffMetadata,\n  Hunk,\n  ParsedPatch,\n} from '../types';\nimport { cleanLastNewline } from './cleanLastNewline';\nimport { parseLineType } from './parseLineType';\n\nfunction processPatch(data: string, cacheKeyPrefix?: string): ParsedPatch {\n  const isGitDiff = GIT_DIFF_FILE_BREAK_REGEX.test(data);\n  const rawFiles = data.split(\n    isGitDiff ? GIT_DIFF_FILE_BREAK_REGEX : UNIFIED_DIFF_FILE_BREAK_REGEX\n  );\n  let patchMetadata: string | undefined;\n  const files: FileDiffMetadata[] = [];\n  let currentFile: FileDiffMetadata | undefined;\n  for (const file of rawFiles) {\n    if (isGitDiff && !GIT_DIFF_FILE_BREAK_REGEX.test(file)) {\n      if (patchMetadata == null) {\n        patchMetadata = file;\n      } else {\n        console.error('parsePatchContent: unknown file blob:', file);\n      }\n      // If we get in here, it's most likely the introductory metadata from the\n      // patch, or something is fucked with the diff format\n      continue;\n    } else if (!isGitDiff && !UNIFIED_DIFF_FILE_BREAK_REGEX.test(file)) {\n      if (patchMetadata == null) {\n        patchMetadata = file;\n      } else {\n        console.error('parsePatchContent: unknown file blob:', file);\n      }\n      continue;\n    }\n    let lastHunkEnd = 0;\n    const hunks = file.split(FILE_CONTEXT_BLOB);\n    currentFile = undefined;\n    for (const hunk of hunks) {\n      const lines = hunk.split(SPLIT_WITH_NEWLINES);\n      const firstLine = lines.shift();\n      if (firstLine == null) {\n        console.error('parsePatchContent: invalid hunk', hunk);\n        continue;\n      }\n      const match = firstLine.match(HUNK_HEADER);\n      const hunkContent: (ContextContent | ChangeContent)[] = [];\n      let additionLines = 0;\n      let deletionLines = 0;\n      if (match == null || currentFile == null) {\n        if (currentFile != null) {\n          console.error('parsePatchContent: Invalid hunk', hunk);\n          continue;\n        }\n        currentFile = {\n          name: '',\n          prevName: undefined,\n          type: 'change',\n          hunks: [],\n          splitLineCount: 0,\n          unifiedLineCount: 0,\n          cacheKey:\n            cacheKeyPrefix != null\n              ? `${cacheKeyPrefix}-${files.length}`\n              : undefined,\n        };\n        // Push that first line back into the group of lines so we can properly\n        // parse it out\n        lines.unshift(firstLine);\n        for (const line of lines) {\n          const filenameMatch = line.match(\n            isGitDiff ? FILENAME_HEADER_REGEX_GIT : FILENAME_HEADER_REGEX\n          );\n          if (line.startsWith('diff --git')) {\n            const [, , prevName, , name] =\n              line.trim().match(ALTERNATE_FILE_NAMES_GIT) ?? [];\n            currentFile.name = name.trim();\n            if (prevName !== name) {\n              currentFile.prevName = prevName.trim();\n            }\n          } else if (filenameMatch != null) {\n            const [, type, fileName] = filenameMatch;\n            if (type === '---' && fileName !== '/dev/null') {\n              currentFile.prevName = fileName.trim();\n              currentFile.name = fileName.trim();\n            } else if (type === '+++' && fileName !== '/dev/null') {\n              currentFile.name = fileName.trim();\n            }\n          }\n          // Git diffs have a bunch of additional metadata we can pull from\n          else if (isGitDiff) {\n            if (line.startsWith('new mode ')) {\n              currentFile.mode = line.replace('new mode', '').trim();\n            }\n            if (line.startsWith('old mode ')) {\n              currentFile.oldMode = line.replace('old mode', '').trim();\n            }\n            if (line.startsWith('new file mode')) {\n              currentFile.type = 'new';\n              currentFile.mode = line.replace('new file mode', '').trim();\n            }\n            if (line.startsWith('deleted file mode')) {\n              currentFile.type = 'deleted';\n              currentFile.mode = line.replace('deleted file mode', '').trim();\n            }\n            if (line.startsWith('similarity index')) {\n              if (line.startsWith('similarity index 100%')) {\n                currentFile.type = 'rename-pure';\n              } else {\n                currentFile.type = 'rename-changed';\n              }\n            }\n            if (line.startsWith('index ')) {\n              const [, mode] = line.trim().match(FILE_MODE_FROM_INDEX) ?? [];\n              if (mode != null) {\n                currentFile.mode = mode;\n              }\n            }\n            // We have to handle these for pure renames because there won't be\n            // --- and +++ lines\n            if (line.startsWith('rename from ')) {\n              currentFile.prevName = line.replace('rename from ', '');\n            }\n            if (line.startsWith('rename to ')) {\n              currentFile.name = line.replace('rename to ', '').trim();\n            }\n          }\n        }\n        continue;\n      } else {\n        let currentContent: ContextContent | ChangeContent | undefined;\n        let lastLineType: 'context' | 'addition' | 'deletion' | undefined;\n        // Strip trailing bare newlines (format-patch separators between commits)\n        while (\n          lines.length > 0 &&\n          (lines[lines.length - 1] === '\\n' || lines[lines.length - 1] === '')\n        ) {\n          lines.pop();\n        }\n        for (const rawLine of lines) {\n          const parsedLine = parseLineType(rawLine);\n          if (parsedLine == null) {\n            continue;\n          }\n          const { type, line } = parsedLine;\n          if (type === 'addition') {\n            if (currentContent == null || currentContent.type !== 'change') {\n              currentContent = createContentGroup('change');\n              hunkContent.push(currentContent);\n            }\n            currentContent.additions.push(line);\n            additionLines++;\n            lastLineType = 'addition';\n          } else if (type === 'deletion') {\n            if (currentContent == null || currentContent.type !== 'change') {\n              currentContent = createContentGroup('change');\n              hunkContent.push(currentContent);\n            }\n            currentContent.deletions.push(line);\n            deletionLines++;\n            lastLineType = 'deletion';\n          } else if (type === 'context') {\n            if (currentContent == null || currentContent.type !== 'context') {\n              currentContent = createContentGroup('context');\n              hunkContent.push(currentContent);\n            }\n            currentContent.lines.push(line);\n            lastLineType = 'context';\n          } else if (type === 'metadata' && currentContent != null) {\n            if (currentContent.type === 'context') {\n              currentContent.noEOFCR = true;\n            } else if (lastLineType === 'deletion') {\n              currentContent.noEOFCRDeletions = true;\n              const lastIndex = currentContent.deletions.length - 1;\n              if (lastIndex >= 0) {\n                currentContent.deletions[lastIndex] = cleanLastNewline(\n                  currentContent.deletions[lastIndex]\n                );\n              }\n            } else if (lastLineType === 'addition') {\n              currentContent.noEOFCRAdditions = true;\n              const lastIndex = currentContent.additions.length - 1;\n              if (lastIndex >= 0) {\n                currentContent.additions[lastIndex] = cleanLastNewline(\n                  currentContent.additions[lastIndex]\n                );\n              }\n            }\n          }\n        }\n      }\n      const hunkData: Hunk = {\n        collapsedBefore: 0,\n        splitLineCount: 0,\n        splitLineStart: 0,\n        unifiedLineCount: 0,\n        unifiedLineStart: 0,\n        additionCount: parseInt(match[4] ?? '1'),\n        additionStart: parseInt(match[3]),\n        additionLines,\n        deletionCount: parseInt(match[2] ?? '1'),\n        deletionStart: parseInt(match[1]),\n        deletionLines,\n        hunkContent,\n        hunkContext: match[5],\n        hunkSpecs: firstLine,\n      };\n      if (\n        isNaN(hunkData.additionCount) ||\n        isNaN(hunkData.deletionCount) ||\n        isNaN(hunkData.additionStart) ||\n        isNaN(hunkData.deletionStart)\n      ) {\n        console.error('parsePatchContent: invalid hunk metadata', hunkData);\n        continue;\n      }\n      hunkData.collapsedBefore = Math.max(\n        hunkData.additionStart - 1 - lastHunkEnd,\n        0\n      );\n      currentFile.hunks.push(hunkData);\n      lastHunkEnd = hunkData.additionStart + hunkData.additionCount - 1;\n      for (const content of hunkContent) {\n        if (content.type === 'context') {\n          hunkData.splitLineCount += content.lines.length;\n          hunkData.unifiedLineCount += content.lines.length;\n        } else {\n          hunkData.splitLineCount += Math.max(\n            content.additions.length,\n            content.deletions.length\n          );\n          hunkData.unifiedLineCount +=\n            content.deletions.length + content.additions.length;\n        }\n      }\n      hunkData.splitLineStart = currentFile.splitLineCount;\n      hunkData.unifiedLineStart = currentFile.unifiedLineCount;\n\n      currentFile.splitLineCount += hunkData.splitLineCount;\n      currentFile.unifiedLineCount += hunkData.unifiedLineCount;\n    }\n    if (currentFile != null) {\n      if (\n        !isGitDiff &&\n        currentFile.prevName != null &&\n        currentFile.name !== currentFile.prevName\n      ) {\n        if (currentFile.hunks.length > 0) {\n          currentFile.type = 'rename-changed';\n        } else {\n          currentFile.type = 'rename-pure';\n        }\n      }\n      if (\n        currentFile.type !== 'rename-pure' &&\n        currentFile.type !== 'rename-changed'\n      ) {\n        currentFile.prevName = undefined;\n      }\n      files.push(currentFile);\n    }\n  }\n  return { patchMetadata, files };\n}\n\n/**\n * Parses a patch file string into an array of parsed patches.\n *\n * @param data - The raw patch file content (supports multi-commit patches)\n * @param cacheKeyPrefix - Optional prefix for generating cache keys. When provided,\n *   each file in the patch will get a cache key in the format `prefix-patchIndex-fileIndex`.\n *   This enables caching of rendered diff results in the worker pool.\n */\nexport function parsePatchFiles(\n  data: string,\n  cacheKeyPrefix?: string\n): ParsedPatch[] {\n  // NOTE(amadeus): This function is pretty forgiving in that it can accept a\n  // patch file that includes commit metdata, multiple commits, or not\n  const patches: ParsedPatch[] = [];\n  for (const patch of data.split(COMMIT_METADATA_SPLIT)) {\n    try {\n      patches.push(\n        processPatch(\n          patch,\n          cacheKeyPrefix != null\n            ? `${cacheKeyPrefix}-${patches.length}`\n            : undefined\n        )\n      );\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  return patches;\n}\n\nfunction createContentGroup(type: 'change'): ChangeContent;\nfunction createContentGroup(type: 'context'): ContextContent;\nfunction createContentGroup(\n  type: 'change' | 'context'\n): ChangeContent | ContextContent {\n  if (type === 'change') {\n    return {\n      type: 'change',\n      additions: [],\n      deletions: [],\n      noEOFCRAdditions: false,\n      noEOFCRDeletions: false,\n    };\n  }\n  return { type: 'context', lines: [], noEOFCR: false };\n}\n", "import { createTwoFilesPatch } from 'diff';\n\nimport { SPLIT_WITH_NEWLINES } from '../constants';\nimport type { FileContents, FileDiffMetadata } from '../types';\nimport { parsePatchFiles } from './parsePatchFiles';\n\n/**\n * Parses a diff from two file contents objects.\n *\n * If both `oldFile` and `newFile` have a `cacheKey`, the resulting diff will\n * automatically get a combined cache key in the format `oldKey:newKey`.\n */\nexport function parseDiffFromFile(\n  oldFile: FileContents,\n  newFile: FileContents\n): FileDiffMetadata {\n  const patch = createTwoFilesPatch(\n    oldFile.name,\n    newFile.name,\n    oldFile.contents,\n    newFile.contents,\n    oldFile.header,\n    newFile.header\n  );\n  const fileData = parsePatchFiles(patch)[0]?.files[0];\n  if (fileData == null) {\n    throw new Error(\n      'parseDiffFrom: FileInvalid diff -- probably need to fix something -- if the files are the same maybe?'\n    );\n  }\n  fileData.oldLines = oldFile.contents.split(SPLIT_WITH_NEWLINES);\n  fileData.newLines = newFile.contents.split(SPLIT_WITH_NEWLINES);\n  if (oldFile.cacheKey != null && newFile.cacheKey != null) {\n    fileData.cacheKey = `${oldFile.cacheKey}:${newFile.cacheKey}`;\n  }\n  return fileData;\n}\n", "import type { Element as HASTElement } from 'hast';\nimport { toHtml } from 'hast-util-to-html';\n\nimport {\n  DEFAULT_THEMES,\n  DIFFS_TAG_NAME,\n  HEADER_METADATA_SLOT_ID,\n  UNSAFE_CSS_ATTRIBUTE,\n} from '../constants';\nimport {\n  LineSelectionManager,\n  type LineSelectionOptions,\n  type SelectedLineRange,\n  pluckLineSelectionOptions,\n} from '../managers/LineSelectionManager';\nimport {\n  type GetHoveredLineResult,\n  MouseEventManager,\n  type MouseEventManagerBaseOptions,\n  pluckMouseEventOptions,\n} from '../managers/MouseEventManager';\nimport { ResizeManager } from '../managers/ResizeManager';\nimport { ScrollSyncManager } from '../managers/ScrollSyncManager';\nimport {\n  DiffHunksRenderer,\n  type HunksRenderResult,\n} from '../renderers/DiffHunksRenderer';\nimport { SVGSpriteSheet } from '../sprite';\nimport type {\n  BaseDiffOptions,\n  DiffLineAnnotation,\n  ExpansionDirections,\n  FileContents,\n  FileDiffMetadata,\n  HunkData,\n  HunkSeparators,\n  RenderHeaderMetadataCallback,\n  ThemeTypes,\n} from '../types';\nimport { areFilesEqual } from '../utils/areFilesEqual';\nimport { createAnnotationWrapperNode } from '../utils/createAnnotationWrapperNode';\nimport { createCodeNode } from '../utils/createCodeNode';\nimport { createHoverContentNode } from '../utils/createHoverContentNode';\nimport { createUnsafeCSSStyleNode } from '../utils/createUnsafeCSSStyleNode';\nimport { wrapUnsafeCSS } from '../utils/cssWrappers';\nimport { getLineAnnotationName } from '../utils/getLineAnnotationName';\nimport { parseDiffFromFile } from '../utils/parseDiffFromFile';\nimport { prerenderHTMLIfNecessary } from '../utils/prerenderHTMLIfNecessary';\nimport { setPreNodeProperties } from '../utils/setWrapperNodeProps';\nimport type { WorkerPoolManager } from '../worker';\nimport { DiffsContainerLoaded } from './web-components';\n\nexport interface FileDiffRenderProps<LAnnotation> {\n  fileDiff?: FileDiffMetadata;\n  oldFile?: FileContents;\n  newFile?: FileContents;\n  forceRender?: boolean;\n  fileContainer?: HTMLElement;\n  containerWrapper?: HTMLElement;\n  lineAnnotations?: DiffLineAnnotation<LAnnotation>[];\n}\n\nexport interface FileDiffHydrationProps<LAnnotation>\n  extends Omit<FileDiffRenderProps<LAnnotation>, 'fileContainer'> {\n  fileContainer: HTMLElement;\n  prerenderedHTML?: string;\n}\n\nexport interface FileDiffOptions<LAnnotation>\n  extends Omit<BaseDiffOptions, 'hunkSeparators'>,\n    MouseEventManagerBaseOptions<'diff'>,\n    LineSelectionOptions {\n  hunkSeparators?:\n    | Exclude<HunkSeparators, 'custom'>\n    | ((\n        hunk: HunkData,\n        instance: FileDiff<LAnnotation>\n      ) => HTMLElement | DocumentFragment);\n  disableFileHeader?: boolean;\n  renderHeaderMetadata?: RenderHeaderMetadataCallback;\n  renderAnnotation?(\n    annotation: DiffLineAnnotation<LAnnotation>\n  ): HTMLElement | undefined;\n  renderHoverUtility?(\n    getHoveredRow: () => GetHoveredLineResult<'diff'> | undefined\n  ): HTMLElement | null;\n}\n\nlet instanceId = -1;\n\nexport class FileDiff<LAnnotation = undefined> {\n  // NOTE(amadeus): We sorta need this to ensure the web-component file is\n  // properly loaded\n  static LoadedCustomComponent: boolean = DiffsContainerLoaded;\n\n  readonly __id: number = ++instanceId;\n\n  private fileContainer: HTMLElement | undefined;\n  private spriteSVG: SVGElement | undefined;\n  private pre: HTMLPreElement | undefined;\n  private unsafeCSSStyle: HTMLStyleElement | undefined;\n  private hoverContent: HTMLElement | undefined;\n\n  private headerElement: HTMLElement | undefined;\n  private headerMetadata: HTMLElement | undefined;\n  private customHunkElements: HTMLElement[] = [];\n  private errorWrapper: HTMLElement | undefined;\n\n  private hunksRenderer: DiffHunksRenderer<LAnnotation>;\n  private resizeManager: ResizeManager;\n  private scrollSyncManager: ScrollSyncManager;\n  private mouseEventManager: MouseEventManager<'diff'>;\n  private lineSelectionManager: LineSelectionManager;\n\n  private annotationElements: HTMLElement[] = [];\n  private lineAnnotations: DiffLineAnnotation<LAnnotation>[] = [];\n\n  private oldFile: FileContents | undefined;\n  private newFile: FileContents | undefined;\n  private fileDiff: FileDiffMetadata | undefined;\n\n  constructor(\n    public options: FileDiffOptions<LAnnotation> = { theme: DEFAULT_THEMES },\n    private workerManager?: WorkerPoolManager | undefined,\n    // NOTE(amadeus): Temp hack while we use this component in a react context\n    private isContainerManaged = false\n  ) {\n    this.hunksRenderer = new DiffHunksRenderer(\n      {\n        ...options,\n        hunkSeparators:\n          typeof options.hunkSeparators === 'function'\n            ? 'custom'\n            : options.hunkSeparators,\n      },\n      this.handleHighlightRender,\n      this.workerManager\n    );\n    this.resizeManager = new ResizeManager();\n    this.scrollSyncManager = new ScrollSyncManager();\n    this.mouseEventManager = new MouseEventManager(\n      'diff',\n      pluckMouseEventOptions(\n        options,\n        typeof options.hunkSeparators === 'function' ||\n          (options.hunkSeparators ?? 'line-info') === 'line-info'\n          ? this.handleExpandHunk\n          : undefined\n      )\n    );\n    this.lineSelectionManager = new LineSelectionManager(\n      pluckLineSelectionOptions(options)\n    );\n    this.workerManager?.subscribeToThemeChanges(this);\n  }\n\n  private handleHighlightRender = (): void => {\n    this.rerender();\n  };\n\n  // FIXME(amadeus): This is a bit of a looming issue that I'll need to resolve:\n  // * Do we publicly allow merging of options or do we have individualized setters?\n  // * When setting new options, we need to figure out what settings require a\n  //   re-render and which can just be applied more elegantly\n  // * There's also an issue of options that live here on the File class and\n  //   those that live on the Hunk class, and it's a bit of an issue with passing\n  //   settings down and mirroring them (not great...)\n  setOptions(options: FileDiffOptions<LAnnotation> | undefined): void {\n    if (options == null) return;\n    this.options = options;\n    this.hunksRenderer.setOptions({\n      ...this.options,\n      hunkSeparators:\n        typeof options.hunkSeparators === 'function'\n          ? 'custom'\n          : options.hunkSeparators,\n    });\n    this.mouseEventManager.setOptions(\n      pluckMouseEventOptions(\n        options,\n        typeof options.hunkSeparators === 'function' ||\n          (options.hunkSeparators ?? 'line-info') === 'line-info'\n          ? this.handleExpandHunk\n          : undefined\n      )\n    );\n    this.lineSelectionManager.setOptions(pluckLineSelectionOptions(options));\n  }\n\n  private mergeOptions(options: Partial<FileDiffOptions<LAnnotation>>): void {\n    this.options = { ...this.options, ...options };\n  }\n\n  setThemeType(themeType: ThemeTypes): void {\n    if ((this.options.themeType ?? 'system') === themeType) {\n      return;\n    }\n    this.mergeOptions({ themeType });\n    this.hunksRenderer.setThemeType(themeType);\n\n    if (this.headerElement != null) {\n      if (themeType === 'system') {\n        delete this.headerElement.dataset.themeType;\n      } else {\n        this.headerElement.dataset.themeType = themeType;\n      }\n    }\n\n    // Update pre element theme mode\n    if (this.pre != null) {\n      switch (themeType) {\n        case 'system':\n          delete this.pre.dataset.themeType;\n          break;\n        case 'light':\n        case 'dark':\n          this.pre.dataset.themeType = themeType;\n          break;\n      }\n    }\n  }\n\n  getHoveredLine = (): GetHoveredLineResult<'diff'> | undefined => {\n    return this.mouseEventManager.getHoveredLine();\n  };\n\n  setLineAnnotations(lineAnnotations: DiffLineAnnotation<LAnnotation>[]): void {\n    this.lineAnnotations = lineAnnotations;\n  }\n\n  setSelectedLines(range: SelectedLineRange | null): void {\n    this.lineSelectionManager.setSelection(range);\n  }\n\n  cleanUp(): void {\n    this.hunksRenderer.cleanUp();\n    this.resizeManager.cleanUp();\n    this.mouseEventManager.cleanUp();\n    this.scrollSyncManager.cleanUp();\n    this.lineSelectionManager.cleanUp();\n    this.workerManager?.unsubscribeToThemeChanges(this);\n    this.workerManager = undefined;\n\n    // Clean up the data\n    this.fileDiff = undefined;\n    this.oldFile = undefined;\n    this.newFile = undefined;\n\n    // Clean up the elements\n    if (!this.isContainerManaged) {\n      this.fileContainer?.parentNode?.removeChild(this.fileContainer);\n    }\n    if (this.fileContainer?.shadowRoot != null) {\n      this.fileContainer.shadowRoot.innerHTML = '';\n    }\n    this.fileContainer = undefined;\n    this.pre = undefined;\n    this.headerElement = undefined;\n    this.errorWrapper = undefined;\n  }\n\n  hydrate(props: FileDiffHydrationProps<LAnnotation>): void {\n    const { fileContainer, prerenderedHTML } = props;\n    prerenderHTMLIfNecessary(fileContainer, prerenderedHTML);\n    for (const element of Array.from(\n      fileContainer.shadowRoot?.children ?? []\n    )) {\n      if (element instanceof SVGElement) {\n        this.spriteSVG = element;\n        continue;\n      }\n      if (!(element instanceof HTMLElement)) {\n        continue;\n      }\n      if (element instanceof HTMLPreElement) {\n        this.pre = element;\n        continue;\n      }\n      if ('diffsHeader' in element.dataset) {\n        this.headerElement = element;\n        continue;\n      }\n      if (\n        element instanceof HTMLStyleElement &&\n        element.hasAttribute(UNSAFE_CSS_ATTRIBUTE)\n      ) {\n        this.unsafeCSSStyle = element;\n        continue;\n      }\n    }\n    // If we have no pre tag, then we should render\n    if (this.pre == null) {\n      this.render(props);\n    }\n    // Otherwise orchestrate our setup\n    else {\n      const { lineAnnotations, oldFile, newFile, fileDiff } = props;\n      this.fileContainer = fileContainer;\n      delete this.pre.dataset.dehydrated;\n\n      this.lineAnnotations = lineAnnotations ?? this.lineAnnotations;\n      this.newFile = newFile;\n      this.oldFile = oldFile;\n      this.fileDiff =\n        fileDiff ??\n        (oldFile != null && newFile != null\n          ? parseDiffFromFile(oldFile, newFile)\n          : undefined);\n\n      this.hunksRenderer.hydrate(this.fileDiff);\n      // FIXME(amadeus): not sure how to handle this yet...\n      // this.renderSeparators();\n      this.renderAnnotations();\n      this.renderHoverUtility();\n      this.injectUnsafeCSS();\n      this.mouseEventManager.setup(this.pre);\n      this.lineSelectionManager.setup(this.pre);\n      if ((this.options.overflow ?? 'scroll') === 'scroll') {\n        this.resizeManager.setup(this.pre);\n        this.scrollSyncManager.setup(this.pre);\n      }\n    }\n  }\n\n  rerender(): void {\n    if (this.fileDiff == null && this.newFile == null && this.oldFile == null) {\n      return;\n    }\n    this.render({\n      oldFile: this.oldFile,\n      newFile: this.newFile,\n      fileDiff: this.fileDiff,\n      forceRender: true,\n    });\n  }\n\n  handleExpandHunk = (\n    hunkIndex: number,\n    direction: ExpansionDirections\n  ): void => {\n    this.expandHunk(hunkIndex, direction);\n  };\n\n  expandHunk(hunkIndex: number, direction: ExpansionDirections): void {\n    this.hunksRenderer.expandHunk(hunkIndex, direction);\n    this.rerender();\n  }\n\n  render({\n    oldFile,\n    newFile,\n    fileDiff,\n    forceRender = false,\n    lineAnnotations,\n    fileContainer,\n    containerWrapper,\n  }: FileDiffRenderProps<LAnnotation>): void {\n    const filesDidChange =\n      oldFile != null &&\n      newFile != null &&\n      (!areFilesEqual(oldFile, this.oldFile) ||\n        !areFilesEqual(newFile, this.newFile));\n    const annotationsChanged =\n      lineAnnotations != null &&\n      (lineAnnotations.length > 0 || this.lineAnnotations.length > 0)\n        ? lineAnnotations !== this.lineAnnotations\n        : false;\n    if (\n      !forceRender &&\n      !annotationsChanged &&\n      // If using the fileDiff API, lets check to see if they are equal to\n      // avoid doing work\n      ((fileDiff != null && fileDiff === this.fileDiff) ||\n        // If using the oldFile/newFile API then lets check to see if they are\n        // equal\n        (fileDiff == null && !filesDidChange))\n    ) {\n      return;\n    }\n\n    this.oldFile = oldFile;\n    this.newFile = newFile;\n    if (fileDiff != null) {\n      this.fileDiff = fileDiff;\n    } else if (oldFile != null && newFile != null && filesDidChange) {\n      this.fileDiff = parseDiffFromFile(oldFile, newFile);\n    }\n\n    if (lineAnnotations != null) {\n      this.setLineAnnotations(lineAnnotations);\n    }\n    if (this.fileDiff == null) {\n      return;\n    }\n    this.hunksRenderer.setOptions({\n      ...this.options,\n      hunkSeparators:\n        typeof this.options.hunkSeparators === 'function'\n          ? 'custom'\n          : this.options.hunkSeparators,\n    });\n\n    this.hunksRenderer.setLineAnnotations(this.lineAnnotations);\n\n    const { disableFileHeader = false } = this.options;\n\n    if (disableFileHeader) {\n      // Remove existing header from DOM\n      if (this.headerElement != null) {\n        this.headerElement.parentNode?.removeChild(this.headerElement);\n        this.headerElement = undefined;\n      }\n    }\n    fileContainer = this.getOrCreateFileContainer(\n      fileContainer,\n      containerWrapper\n    );\n\n    try {\n      const hunksResult = this.hunksRenderer.renderDiff(this.fileDiff);\n      if (hunksResult == null) {\n        if (this.workerManager != null && !this.workerManager.isInitialized()) {\n          void this.workerManager.initialize().then(() => this.rerender());\n        }\n        return;\n      }\n\n      if (hunksResult.headerElement != null) {\n        this.applyHeaderToDOM(hunksResult.headerElement, fileContainer);\n      }\n      const pre = this.getOrCreatePreNode(fileContainer);\n      this.applyHunksToDOM(pre, hunksResult);\n      this.renderSeparators(hunksResult.hunkData);\n      this.renderAnnotations();\n      this.renderHoverUtility();\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        this.applyErrorToDOM(error, fileContainer);\n      }\n    }\n  }\n\n  private renderSeparators(hunkData: HunkData[]): void {\n    const { hunkSeparators } = this.options;\n    if (\n      this.isContainerManaged ||\n      this.fileContainer == null ||\n      typeof hunkSeparators !== 'function'\n    ) {\n      return;\n    }\n    for (const element of this.customHunkElements) {\n      element.parentNode?.removeChild(element);\n    }\n    this.customHunkElements.length = 0;\n    for (const hunk of hunkData) {\n      const element = document.createElement('div');\n      element.style.display = 'contents';\n      element.slot = hunk.slotName;\n      element.appendChild(hunkSeparators(hunk, this));\n      this.fileContainer.appendChild(element);\n      this.customHunkElements.push(element);\n    }\n  }\n\n  private renderAnnotations(): void {\n    if (this.isContainerManaged || this.fileContainer == null) {\n      return;\n    }\n    // Handle annotation elements\n    for (const element of this.annotationElements) {\n      element.parentNode?.removeChild(element);\n    }\n    this.annotationElements.length = 0;\n\n    const { renderAnnotation } = this.options;\n    if (renderAnnotation != null && this.lineAnnotations.length > 0) {\n      for (const annotation of this.lineAnnotations) {\n        const content = renderAnnotation(annotation);\n        if (content == null) continue;\n        const el = createAnnotationWrapperNode(\n          getLineAnnotationName(annotation)\n        );\n        el.appendChild(content);\n        this.annotationElements.push(el);\n        this.fileContainer.appendChild(el);\n      }\n    }\n  }\n\n  private renderHoverUtility() {\n    const { renderHoverUtility } = this.options;\n    if (this.fileContainer == null || renderHoverUtility == null) return;\n    if (this.hoverContent == null) {\n      this.hoverContent = createHoverContentNode();\n      this.fileContainer.appendChild(this.hoverContent);\n    }\n    const element = renderHoverUtility(this.mouseEventManager.getHoveredLine);\n    this.hoverContent.innerHTML = '';\n    if (element != null) {\n      this.hoverContent.appendChild(element);\n    }\n  }\n\n  private getOrCreateFileContainer(\n    fileContainer?: HTMLElement,\n    parentNode?: HTMLElement\n  ): HTMLElement {\n    this.fileContainer =\n      fileContainer ??\n      this.fileContainer ??\n      document.createElement(DIFFS_TAG_NAME);\n    if (parentNode != null && this.fileContainer.parentNode !== parentNode) {\n      parentNode.appendChild(this.fileContainer);\n    }\n    if (this.spriteSVG == null) {\n      const fragment = document.createElement('div');\n      fragment.innerHTML = SVGSpriteSheet;\n      const firstChild = fragment.firstChild;\n      if (firstChild instanceof SVGElement) {\n        this.spriteSVG = firstChild;\n        this.fileContainer.shadowRoot?.appendChild(this.spriteSVG);\n      }\n    }\n    return this.fileContainer;\n  }\n\n  getFileContainer(): HTMLElement | undefined {\n    return this.fileContainer;\n  }\n\n  private getOrCreatePreNode(container: HTMLElement): HTMLPreElement {\n    // If we haven't created a pre element yet, lets go ahead and do that\n    if (this.pre == null) {\n      this.pre = document.createElement('pre');\n      container.shadowRoot?.appendChild(this.pre);\n    }\n    // If we have a new parent container for the pre element, lets go ahead and\n    // move it into the new container\n    else if (this.pre.parentNode !== container) {\n      container.shadowRoot?.appendChild(this.pre);\n    }\n    return this.pre;\n  }\n\n  private applyHeaderToDOM(\n    headerAST: HASTElement,\n    container: HTMLElement\n  ): void {\n    this.cleanupErrorWrapper();\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = toHtml(headerAST);\n    const newHeader = tempDiv.firstElementChild;\n    if (!(newHeader instanceof HTMLElement)) {\n      return;\n    }\n    if (this.headerElement != null) {\n      container.shadowRoot?.replaceChild(newHeader, this.headerElement);\n    } else {\n      container.shadowRoot?.prepend(newHeader);\n    }\n    this.headerElement = newHeader;\n\n    if (this.isContainerManaged) return;\n\n    const { renderHeaderMetadata } = this.options;\n    if (this.headerMetadata != null) {\n      this.headerMetadata.parentNode?.removeChild(this.headerMetadata);\n    }\n    const content =\n      renderHeaderMetadata?.({\n        oldFile: this.oldFile,\n        newFile: this.newFile,\n        fileDiff: this.fileDiff,\n      }) ?? undefined;\n    if (content != null) {\n      this.headerMetadata = document.createElement('div');\n      this.headerMetadata.slot = HEADER_METADATA_SLOT_ID;\n      if (content instanceof Element) {\n        this.headerMetadata.appendChild(content);\n      } else {\n        this.headerMetadata.innerText = `${content}`;\n      }\n      container.appendChild(this.headerMetadata);\n    }\n  }\n\n  private injectUnsafeCSS(): void {\n    if (this.fileContainer?.shadowRoot == null) {\n      return;\n    }\n    const { unsafeCSS } = this.options;\n\n    if (unsafeCSS == null || unsafeCSS === '') {\n      return;\n    }\n\n    // Create or update the style element\n    if (this.unsafeCSSStyle == null) {\n      this.unsafeCSSStyle = createUnsafeCSSStyleNode();\n      this.fileContainer.shadowRoot.appendChild(this.unsafeCSSStyle);\n    }\n    // Wrap in @layer unsafe to match SSR behavior\n    this.unsafeCSSStyle.innerText = wrapUnsafeCSS(unsafeCSS);\n  }\n\n  private applyHunksToDOM(\n    pre: HTMLPreElement,\n    result: HunksRenderResult\n  ): void {\n    this.cleanupErrorWrapper();\n    this.applyPreNodeAttributes(pre, result);\n\n    // Clear existing content\n    pre.innerHTML = '';\n\n    let codeDeletions: HTMLElement | undefined;\n    let codeAdditions: HTMLElement | undefined;\n    // Create code elements and insert HTML content\n    if (result.unifiedAST != null) {\n      const codeUnified = createCodeNode({ columnType: 'unified' });\n      codeUnified.innerHTML = this.hunksRenderer.renderPartialHTML(\n        result.unifiedAST\n      );\n      pre.appendChild(codeUnified);\n    } else {\n      if (result.deletionsAST != null) {\n        codeDeletions = createCodeNode({ columnType: 'deletions' });\n        codeDeletions.innerHTML = this.hunksRenderer.renderPartialHTML(\n          result.deletionsAST\n        );\n        pre.appendChild(codeDeletions);\n      }\n      if (result.additionsAST != null) {\n        codeAdditions = createCodeNode({ columnType: 'additions' });\n        codeAdditions.innerHTML = this.hunksRenderer.renderPartialHTML(\n          result.additionsAST\n        );\n        pre.appendChild(codeAdditions);\n      }\n    }\n\n    this.injectUnsafeCSS();\n\n    this.mouseEventManager.setup(pre);\n    this.lineSelectionManager.setup(pre);\n    if ((this.options.overflow ?? 'scroll') === 'scroll') {\n      this.resizeManager.setup(pre);\n      this.scrollSyncManager.setup(pre, codeDeletions, codeAdditions);\n    } else {\n      this.resizeManager.cleanUp();\n      this.scrollSyncManager.cleanUp();\n    }\n  }\n\n  private applyPreNodeAttributes(\n    pre: HTMLPreElement,\n    {\n      themeStyles,\n      baseThemeType,\n      additionsAST,\n      deletionsAST,\n      totalLines,\n    }: HunksRenderResult\n  ): void {\n    const {\n      diffIndicators = 'bars',\n      disableBackground = false,\n      disableLineNumbers = false,\n      overflow = 'scroll',\n      themeType = 'system',\n      diffStyle = 'split',\n    } = this.options;\n    const split =\n      diffStyle === 'unified'\n        ? false\n        : additionsAST != null && deletionsAST != null;\n    setPreNodeProperties({\n      pre,\n      diffIndicators,\n      disableBackground,\n      disableLineNumbers,\n      overflow,\n      split,\n      themeStyles,\n      themeType: baseThemeType ?? themeType,\n      totalLines,\n    });\n  }\n\n  private applyErrorToDOM(error: Error, container: HTMLElement) {\n    this.cleanupErrorWrapper();\n    const pre = this.getOrCreatePreNode(container);\n    pre.innerHTML = '';\n    pre.parentNode?.removeChild(pre);\n    this.pre = undefined;\n    const shadowRoot =\n      container.shadowRoot ?? container.attachShadow({ mode: 'open' });\n    this.errorWrapper ??= document.createElement('div');\n    this.errorWrapper.dataset.errorWrapper = '';\n    this.errorWrapper.innerHTML = '';\n    shadowRoot.appendChild(this.errorWrapper);\n    const errorMessage = document.createElement('div');\n    errorMessage.dataset.errorMessage = '';\n    errorMessage.innerText = error.message;\n    this.errorWrapper.appendChild(errorMessage);\n    const errorStack = document.createElement('pre');\n    errorStack.dataset.errorStack = '';\n    errorStack.innerText = error.stack ?? 'No Error Stack';\n    this.errorWrapper.appendChild(errorStack);\n  }\n\n  private cleanupErrorWrapper() {\n    this.errorWrapper?.parentNode?.removeChild(this.errorWrapper);\n    this.errorWrapper = undefined;\n  }\n}\n", "type Callback = (time: number) => unknown;\n\nconst queuedCallbacks = new Set<Callback>();\nlet callbacks = new Set<Callback>();\nlet frameId: null | number = null;\nlet isRendering = false;\n\n// TODO(amadeus): Figure out a proper name for this module...\nexport function queueRender(callback: Callback): void {\n  if (isRendering) {\n    queuedCallbacks.add(callback);\n    return;\n  }\n  callbacks.add(callback);\n  frameId ??= requestAnimationFrame(render);\n}\n\nfunction render(time: number): void {\n  isRendering = true;\n  for (const callback of callbacks) {\n    try {\n      callback(time);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  callbacks.clear();\n  if (queuedCallbacks.size > 0) {\n    callbacks = new Set(queuedCallbacks);\n    queuedCallbacks.clear();\n    frameId = requestAnimationFrame(render);\n  } else {\n    frameId = null;\n  }\n  isRendering = false;\n}\n", "import type { GrammarState, ThemedToken } from '@shikijs/core';\n\nimport type {\n  ShikiStreamTokenizerEnqueueResult,\n  ShikiStreamTokenizerOptions,\n} from './types';\n\nexport class ShikiStreamTokenizer {\n  public readonly options: ShikiStreamTokenizerOptions;\n\n  public tokensStable: ThemedToken[] = [];\n  public tokensUnstable: ThemedToken[] = [];\n\n  public lastUnstableCodeChunk: string = '';\n  public lastStableGrammarState: GrammarState | undefined;\n\n  constructor(options: ShikiStreamTokenizerOptions) {\n    this.options = options;\n  }\n\n  /**\n   * Enqueue a chunk of code to the buffer.\n   */\n  // eslint-disable-next-line @typescript-eslint/require-await\n  async enqueue(chunk: string): Promise<ShikiStreamTokenizerEnqueueResult> {\n    const chunkLines = (this.lastUnstableCodeChunk + chunk).split('\\n');\n\n    const stable: ThemedToken[] = [];\n    let unstable: ThemedToken[] = [];\n    const recall = this.tokensUnstable.length;\n\n    chunkLines.forEach((line, i) => {\n      const isLastLine = i === chunkLines.length - 1;\n\n      const result = this.options.highlighter.codeToTokens(line, {\n        ...this.options,\n        grammarState: this.lastStableGrammarState,\n      });\n      const tokens = result.tokens[0]; // only one line\n      if (!isLastLine) tokens.push({ content: '\\n', offset: 0 });\n\n      if (!isLastLine) {\n        this.lastStableGrammarState = result.grammarState;\n        stable.push(...tokens);\n      } else {\n        unstable = tokens;\n        this.lastUnstableCodeChunk = line;\n      }\n    });\n\n    this.tokensStable.push(...stable);\n    this.tokensUnstable = unstable;\n\n    return {\n      recall,\n      stable,\n      unstable,\n    };\n  }\n\n  close(): { stable: ThemedToken[] } {\n    const stable = this.tokensUnstable;\n    this.tokensUnstable = [];\n    this.lastUnstableCodeChunk = '';\n    this.lastStableGrammarState = undefined;\n    return {\n      stable,\n    };\n  }\n\n  clear(): void {\n    this.tokensStable = [];\n    this.tokensUnstable = [];\n    this.lastUnstableCodeChunk = '';\n    this.lastStableGrammarState = undefined;\n  }\n\n  clone(): ShikiStreamTokenizer {\n    const clone = new ShikiStreamTokenizer(this.options);\n    clone.lastUnstableCodeChunk = this.lastUnstableCodeChunk;\n    clone.tokensUnstable = this.tokensUnstable;\n    clone.tokensStable = this.tokensStable;\n    clone.lastStableGrammarState = this.lastStableGrammarState;\n    return clone;\n  }\n}\n", "import type { ThemedToken } from '@shikijs/core';\n\nimport { ShikiStreamTokenizer } from './tokenizer';\nimport type { CodeToTokenTransformStreamOptions, RecallToken } from './types';\n\n/**\n * Create a transform stream that takes code chunks and emits themed tokens.\n */\nexport class CodeToTokenTransformStream extends TransformStream<\n  string,\n  ThemedToken | RecallToken\n> {\n  readonly tokenizer: ShikiStreamTokenizer;\n  readonly options: CodeToTokenTransformStreamOptions;\n\n  constructor(options: CodeToTokenTransformStreamOptions) {\n    const tokenizer = new ShikiStreamTokenizer(options);\n    const { allowRecalls = false } = options;\n\n    super({\n      async transform(chunk, controller) {\n        const {\n          stable,\n          unstable: buffer,\n          recall,\n        } = await tokenizer.enqueue(chunk);\n        if (allowRecalls && recall > 0) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          controller.enqueue({ recall } as any);\n        }\n        for (const token of stable) {\n          controller.enqueue(token);\n        }\n        if (allowRecalls) {\n          for (const token of buffer) {\n            controller.enqueue(token);\n          }\n        }\n      },\n      // eslint-disable-next-line @typescript-eslint/require-await\n      async flush(controller) {\n        const { stable } = tokenizer.close();\n        // if allow recalls, the tokens should already be sent\n        if (!allowRecalls) {\n          for (const token of stable) {\n            controller.enqueue(token);\n          }\n        }\n      },\n    });\n\n    this.tokenizer = tokenizer;\n    this.options = options;\n  }\n}\n", "export function createRowNodes(line: number): {\n  row: HTMLElement;\n  content: HTMLElement;\n} {\n  const row = document.createElement('div');\n  row.dataset.line = `${line}`;\n\n  const lineColumn = document.createElement('div');\n  lineColumn.dataset.columnNumber = '';\n  lineColumn.textContent = `${line}`;\n\n  const content = document.createElement('div');\n  content.dataset.columnContent = '';\n\n  row.appendChild(lineColumn);\n  row.appendChild(content);\n  return { row, content };\n}\n", "import {\n  type ThemedToken,\n  getTokenStyleObject,\n  stringifyTokenStyle,\n} from 'shiki';\n\nexport function createSpanFromToken(token: ThemedToken): HTMLSpanElement {\n  const element = document.createElement('span');\n  const style = token.htmlStyle ?? getTokenStyleObject(token);\n  element.style = stringifyTokenStyle(style);\n  element.textContent = token.content;\n  return element;\n}\n", "import { DEFAULT_THEMES, DIFFS_TAG_NAME } from '../constants';\nimport { getSharedHighlighter } from '../highlighter/shared_highlighter';\nimport { queueRender } from '../managers/UniversalRenderingManager';\nimport { CodeToTokenTransformStream, type RecallToken } from '../shiki-stream';\nimport type {\n  BaseCodeOptions,\n  DiffsHighlighter,\n  SupportedLanguages,\n  ThemeTypes,\n  ThemedToken,\n} from '../types';\nimport { createCodeNode } from '../utils/createCodeNode';\nimport { createRowNodes } from '../utils/createRowNodes';\nimport { createSpanFromToken } from '../utils/createSpanNodeFromToken';\nimport { formatCSSVariablePrefix } from '../utils/formatCSSVariablePrefix';\nimport { getHighlighterOptions } from '../utils/getHighlighterOptions';\nimport { getHighlighterThemeStyles } from '../utils/getHighlighterThemeStyles';\nimport { setPreNodeProperties } from '../utils/setWrapperNodeProps';\n\nexport interface FileStreamOptions extends BaseCodeOptions {\n  lang?: SupportedLanguages;\n  startingLineIndex?: number;\n\n  onPreRender?(instance: FileStream): unknown;\n  onPostRender?(instance: FileStream): unknown;\n\n  onStreamStart?(controller: WritableStreamDefaultController): unknown;\n  onStreamWrite?(token: ThemedToken | RecallToken): unknown;\n  onStreamClose?(): unknown;\n  onStreamAbort?(reason: unknown): unknown;\n}\n\nexport class FileStream {\n  private highlighter: DiffsHighlighter | undefined;\n  private stream: ReadableStream<string> | undefined;\n  private abortController: AbortController | undefined;\n  private fileContainer: HTMLElement | undefined;\n  pre: HTMLPreElement | undefined;\n  private code: HTMLElement | undefined;\n\n  constructor(public options: FileStreamOptions = { theme: DEFAULT_THEMES }) {\n    this.currentLineIndex = this.options.startingLineIndex ?? 1;\n  }\n\n  cleanUp(): void {\n    this.abortController?.abort();\n    this.abortController = undefined;\n  }\n\n  setThemeType(themeType: ThemeTypes): void {\n    if ((this.options.themeType ?? 'system') === themeType) {\n      return;\n    }\n    this.options = { ...this.options, themeType };\n\n    // Update pre element theme mode\n    if (this.pre != null) {\n      switch (themeType) {\n        case 'system':\n          delete this.pre.dataset.themeType;\n          break;\n        case 'light':\n        case 'dark':\n          this.pre.dataset.themeType = themeType;\n          break;\n      }\n    }\n  }\n\n  private async initializeHighlighter(): Promise<DiffsHighlighter> {\n    this.highlighter = await getSharedHighlighter(\n      getHighlighterOptions(this.options.lang, this.options)\n    );\n    return this.highlighter;\n  }\n\n  private queuedSetupArgs: [ReadableStream<string>, HTMLElement] | undefined;\n  async setup(\n    _source: ReadableStream<string>,\n    _wrapper: HTMLElement\n  ): Promise<void> {\n    const isSettingUp = this.queuedSetupArgs != null;\n    this.queuedSetupArgs = [_source, _wrapper];\n    if (isSettingUp) {\n      // TODO(amadeus): Make it so that this function can be properly\n      // awaitable, maybe?\n      return;\n    }\n    this.highlighter ??= await this.initializeHighlighter();\n\n    const [source, wrapper] = this.queuedSetupArgs;\n    this.queuedSetupArgs = undefined;\n\n    const stream = source;\n\n    this.setupStream(stream, wrapper, this.highlighter);\n  }\n\n  private setupStream(\n    stream: ReadableStream<string>,\n    wrapper: HTMLElement,\n    highlighter: DiffsHighlighter\n  ): void {\n    const {\n      disableLineNumbers = false,\n      overflow = 'scroll',\n      theme = DEFAULT_THEMES,\n      themeType = 'system',\n    } = this.options;\n    const fileContainer = this.getOrCreateFileContainer();\n    if (fileContainer.parentElement == null) {\n      wrapper.appendChild(fileContainer);\n    }\n    this.pre ??= document.createElement('pre');\n    if (this.pre.parentElement == null) {\n      fileContainer.shadowRoot?.appendChild(this.pre);\n    }\n    const themeStyles = getHighlighterThemeStyles({ theme, highlighter });\n    const baseThemeType =\n      typeof theme === 'string' ? highlighter.getTheme(theme).type : undefined;\n    const pre = setPreNodeProperties({\n      diffIndicators: 'none',\n      disableBackground: true,\n      disableLineNumbers,\n      overflow,\n      pre: this.pre,\n      split: false,\n      themeType: baseThemeType ?? themeType,\n      themeStyles,\n      totalLines: 0,\n    });\n    pre.innerHTML = '';\n\n    this.pre = pre;\n    this.code = createCodeNode({ pre });\n    this.abortController?.abort();\n    this.abortController = new AbortController();\n    const { onStreamStart, onStreamClose, onStreamAbort } = this.options;\n    this.stream = stream;\n    this.stream\n      .pipeThrough(\n        typeof theme === 'string'\n          ? new CodeToTokenTransformStream({\n              ...this.options,\n              theme,\n              highlighter,\n              allowRecalls: true,\n              defaultColor: false,\n              cssVariablePrefix: formatCSSVariablePrefix(),\n            })\n          : new CodeToTokenTransformStream({\n              ...this.options,\n              themes: theme,\n              highlighter,\n              allowRecalls: true,\n              defaultColor: false,\n              cssVariablePrefix: formatCSSVariablePrefix(),\n            })\n      )\n      .pipeTo(\n        new WritableStream({\n          start(controller) {\n            onStreamStart?.(controller);\n          },\n          close() {\n            onStreamClose?.();\n          },\n          abort(reason) {\n            onStreamAbort?.(reason);\n          },\n          write: this.handleWrite,\n        }),\n        { signal: this.abortController.signal }\n      )\n      .catch((error) => {\n        // Ignore AbortError - it's expected when cleaning up\n        if (error.name !== 'AbortError') {\n          console.error('FileStream pipe error:', error);\n        }\n      });\n  }\n\n  private queuedTokens: (ThemedToken | RecallToken)[] = [];\n  private handleWrite = (token: ThemedToken | RecallToken) => {\n    // If we've recalled tokens we haven't rendered yet, we can just yeet them\n    // and never apply them\n    if ('recall' in token && this.queuedTokens.length >= token.recall) {\n      this.queuedTokens.length = this.queuedTokens.length - token.recall;\n    } else {\n      this.queuedTokens.push(token);\n    }\n    queueRender(this.render);\n    this.options.onStreamWrite?.(token);\n  };\n\n  private currentLineIndex: number;\n  private currentLineElement: HTMLElement | undefined;\n  private render = () => {\n    this.options.onPreRender?.(this);\n    const linesToAppend: HTMLElement[] = [];\n    for (const token of this.queuedTokens) {\n      if ('recall' in token) {\n        if (this.currentLineElement == null) {\n          throw new Error(\n            'FileStream.render: no current line element, shouldnt be possible to get here'\n          );\n        }\n        if (token.recall > this.currentLineElement.childNodes.length) {\n          throw new Error(\n            `FileStream.render: Token recall exceed the current line, there's probably a bug...`\n          );\n        }\n        for (let i = 0; i < token.recall; i++) {\n          this.currentLineElement.lastChild?.remove();\n        }\n      } else {\n        const span = createSpanFromToken(token);\n        if (this.currentLineElement == null) {\n          linesToAppend.push(this.createLine());\n        }\n        this.currentLineElement?.appendChild(span);\n        if (token.content === '\\n') {\n          this.currentLineIndex++;\n          linesToAppend.push(this.createLine());\n        }\n      }\n    }\n    for (const line of linesToAppend) {\n      this.code?.appendChild(line);\n    }\n    this.queuedTokens.length = 0;\n    this.options.onPostRender?.(this);\n  };\n\n  private createLine(): HTMLElement {\n    const { row, content } = createRowNodes(this.currentLineIndex);\n    this.currentLineElement = content;\n    return row;\n  }\n\n  private getOrCreateFileContainer(fileContainer?: HTMLElement): HTMLElement {\n    if (\n      (fileContainer != null && fileContainer === this.fileContainer) ||\n      (fileContainer == null && this.fileContainer != null)\n    ) {\n      return this.fileContainer;\n    }\n    this.fileContainer =\n      fileContainer ?? document.createElement(DIFFS_TAG_NAME);\n    return this.fileContainer;\n  }\n}\n", "export function areObjectsEqual<T extends object>(\n  objA: T | undefined,\n  objB: T | undefined,\n  omitKeys?: (keyof T)[]\n): boolean {\n  // Lets get out of here early if they are the same or either is undefined\n  if (objA === objB || objA == null || objB == null) {\n    return objA === objB;\n  }\n\n  // Convert array to Set for O(1) lookup\n  const omitSet = new Set(omitKeys);\n  const keysA = Object.keys(objA) as (keyof T)[];\n  const keysBSet = new Set(Object.keys(objB) as (keyof T)[]);\n\n  // Compare keys from objA\n  for (const key of keysA) {\n    keysBSet.delete(key);\n    if (omitSet.has(key)) {\n      continue;\n    }\n\n    if (!(key in objB) || objA[key] !== objB[key]) {\n      return false;\n    }\n  }\n\n  // If we got any remaining keys that aren't omitted in objB,\n  // then we gotta return false\n  for (const key of Array.from(keysBSet)) {\n    if (!omitSet.has(key)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n", "import type { FileDiffOptions } from 'src/components/FileDiff';\nimport { DEFAULT_THEMES } from 'src/constants';\nimport type { FileOptions } from 'src/react';\n\nimport { areObjectsEqual } from './areObjectsEqual';\nimport { areThemesEqual } from './areThemesEqual';\n\nexport function areOptionsEqual<LAnnotation>(\n  optionsA: FileOptions<LAnnotation> | FileDiffOptions<LAnnotation> | undefined,\n  optionsB: FileOptions<LAnnotation> | FileDiffOptions<LAnnotation> | undefined\n): boolean {\n  const themeA = optionsA?.theme ?? DEFAULT_THEMES;\n  const themeB = optionsB?.theme ?? DEFAULT_THEMES;\n  return (\n    areThemesEqual(themeA, themeB) &&\n    areObjectsEqual(optionsA, optionsB, ['theme'])\n  );\n}\n", "import type { Element as HASTElement } from 'hast';\n\nimport { CORE_CSS_ATTRIBUTE, UNSAFE_CSS_ATTRIBUTE } from '../constants';\nimport { wrapCoreCSS, wrapUnsafeCSS } from './cssWrappers';\nimport { createHastElement, createTextNodeElement } from './hast_utils';\n\nexport function createStyleElement(\n  content: string,\n  isCoreCSS: boolean = false\n): HASTElement {\n  return createHastElement({\n    tagName: 'style',\n    children: [\n      createTextNodeElement(\n        isCoreCSS ? wrapCoreCSS(content) : wrapUnsafeCSS(content)\n      ),\n    ],\n    properties: {\n      [CORE_CSS_ATTRIBUTE]: isCoreCSS ? '' : undefined,\n      [UNSAFE_CSS_ATTRIBUTE]: !isCoreCSS ? '' : undefined,\n    },\n  });\n}\n", "import type { ContextContent, FileDiffMetadata } from '../types';\n\nexport function diffAcceptRejectHunk(\n  diff: FileDiffMetadata,\n  hunkIndex: number,\n  type: 'accept' | 'reject'\n): FileDiffMetadata {\n  diff = {\n    ...diff,\n    hunks: [...diff.hunks],\n    oldLines: diff.oldLines != null ? [...diff.oldLines] : undefined,\n    newLines: diff.newLines != null ? [...diff.newLines] : undefined,\n    // Automatically update cacheKey if it exists, since content is changing\n    cacheKey:\n      diff.cacheKey != null\n        ? `${diff.cacheKey}:${type[0]}-${hunkIndex}`\n        : undefined,\n  };\n  // Fix the content lines\n  const { newLines, oldLines } = diff;\n  if (newLines != null && oldLines != null) {\n    const hunk = diff.hunks[hunkIndex];\n    if (hunk == null) {\n      console.error({ diff, hunkIndex });\n      throw new Error(\n        `diffResolveRejectHunk: Invalid hunk index: ${hunkIndex}`\n      );\n    }\n    if (type === 'reject') {\n      newLines.splice(\n        hunk.additionStart - 1,\n        hunk.additionCount,\n        ...oldLines.slice(\n          hunk.deletionStart - 1,\n          hunk.deletionStart - 1 + hunk.deletionCount\n        )\n      );\n    } else {\n      oldLines.splice(\n        hunk.deletionStart - 1,\n        hunk.deletionCount,\n        ...newLines.slice(\n          hunk.additionStart - 1,\n          hunk.additionStart - 1 + hunk.additionCount\n        )\n      );\n    }\n  }\n  let deletionOffset = 0;\n  let additionOffset = 0;\n  let splitOffset = 0;\n  let unifiedOffset = 0;\n  for (let i = hunkIndex; i < diff.hunks.length; i++) {\n    let hunk = diff.hunks[i];\n    if (hunk == null) {\n      console.error({ hunk, i, hunkIndex, diff });\n      throw new Error(\n        'diffResolveRejectHunk: iterating through hunks, hunk doesnt exist...'\n      );\n    }\n    hunk = { ...hunk };\n    diff.hunks[i] = hunk;\n    if (i === hunkIndex) {\n      const newContent: ContextContent = {\n        type: 'context',\n        lines: [],\n        noEOFCR: false,\n      };\n      for (const content of hunk.hunkContent) {\n        if (content.type === 'context') {\n          newContent.lines.push(...content.lines);\n          newContent.noEOFCR = content.noEOFCR;\n        } else if (type === 'accept') {\n          newContent.lines.push(...content.additions);\n          newContent.noEOFCR = content.noEOFCRAdditions;\n        } else if (type === 'reject') {\n          newContent.lines.push(...content.deletions);\n          newContent.noEOFCR = content.noEOFCRDeletions;\n        }\n      }\n      const lineCount = newContent.lines.length;\n      hunk.hunkContent = [newContent];\n      splitOffset = lineCount - hunk.splitLineCount;\n      hunk.splitLineCount = lineCount;\n      unifiedOffset = lineCount - hunk.unifiedLineCount;\n      hunk.unifiedLineCount = lineCount;\n      deletionOffset = lineCount - hunk.deletionCount;\n      hunk.deletionCount = lineCount;\n      hunk.deletionLines = 0;\n      additionOffset = lineCount - hunk.additionCount;\n      hunk.additionCount = lineCount;\n      hunk.additionLines = 0;\n      diff.splitLineCount += splitOffset;\n      diff.unifiedLineCount += unifiedOffset;\n    } else {\n      hunk.splitLineStart += splitOffset;\n      hunk.unifiedLineStart += unifiedOffset;\n      hunk.additionStart += additionOffset;\n      hunk.deletionStart += deletionOffset;\n    }\n  }\n  return diff;\n}\n", "export function getLineEndingType(\n  content: string\n): 'CRLF' | 'CR' | 'LF' | 'none' {\n  // Windows\n  if (content.includes('\\r\\n')) {\n    return 'CRLF';\n  }\n  // Old Mac\n  if (content.includes('\\r')) {\n    return 'CR';\n  }\n  // Unix/Linux/Modern Mac\n  if (content.includes('\\n')) {\n    return 'LF';\n  }\n  // No line endings found\n  return 'none';\n}\n", "import type { FileDiffMetadata } from '../types';\nimport { parsePatchFiles } from './parsePatchFiles';\n\nexport function getSingularPatch(patch: string): FileDiffMetadata {\n  const parsedPatches = parsePatchFiles(patch);\n  if (parsedPatches.length !== 1) {\n    console.error(parsedPatches);\n    throw new Error(\n      'PatchDiff: Provided patch must include only 1 patch, with 1 diff'\n    );\n  }\n  const { files } = parsedPatches[0];\n  if (files.length !== 1) {\n    console.error(files);\n    throw new Error(\n      'FileDiff: Provided patch must contain exactly 1 file diff'\n    );\n  }\n  return files[0];\n}\n", "import type {\n  FileContents,\n  FileDiffMetadata,\n  SupportedLanguages,\n} from '../types';\n\nexport function setLanguageOverride<T extends FileContents | FileDiffMetadata>(\n  fileOrDiff: T,\n  lang: SupportedLanguages\n): T {\n  return { ...fileOrDiff, lang };\n}\n"],
  "mappings": "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",
  "names": ["options: LineSelectionOptions", "lineNumber: number | undefined", "lineIndex: number | undefined", "eventSide: AnnotationSide | undefined", "mode: TMode", "options: MouseEventManagerOptions<TMode>", "reasons: string[]", "direction: ExpansionDirections | undefined", "numberElement", "item: ObservedGridNodes", "item: ObservedAnnotationNodes", "properties: Properties", "children: ElementContent[]", "properties: Properties", "options: FileRendererOptions", "onRenderUpdate?: () => unknown", "workerManager?: WorkerPoolManager | undefined", "options", "options: RenderFileOptions", "codeAST: ElementContent[]", "rawStyles", "sheet: CSSStyleSheet | undefined", "styles", "options: FileOptions<LAnnotation>", "workerManager?: WorkerPoolManager | undefined", "error: unknown", "contentChildren: ElementContent[]", "EXPANDED_REGION: ExpansionRegion", "options: BaseDiffOptions", "onRenderUpdate?: () => unknown", "workerManager?: WorkerPoolManager | undefined", "areRenderOptionsEqual", "options", "options: RenderDiffOptions", "additionsAST: ElementContent[] | undefined", "deletionsAST: ElementContent[] | undefined", "unifiedAST: ElementContent[] | undefined", "hunkData: HunkData[]", "prevHunk: Hunk | undefined", "oldLine: ElementContent | undefined", "newLine: ElementContent | undefined", "oldLine", "newLine", "deletionSpan: AnnotationSpan", "additionSpan: AnnotationSpan", "patchMetadata: string | undefined", "files: FileDiffMetadata[]", "currentFile: FileDiffMetadata | undefined", "hunkContent: (ContextContent | ChangeContent)[]", "currentContent: ContextContent | ChangeContent | undefined", "lastLineType: 'context' | 'addition' | 'deletion' | undefined", "hunkData: Hunk", "patches: ParsedPatch[]", "instanceId", "options: FileDiffOptions<LAnnotation>", "workerManager?: WorkerPoolManager | undefined", "error: unknown", "codeDeletions: HTMLElement | undefined", "codeAdditions: HTMLElement | undefined", "frameId: null | number", "ShikiStreamTokenizer", "stable: ThemedToken[]", "unstable: ThemedToken[]", "options: FileStreamOptions", "linesToAppend: HTMLElement[]", "newContent: ContextContent"]
}
