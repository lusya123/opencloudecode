import {
  isServer
} from "./chunk-5C2DUIQJ.js";
import {
  createRoot,
  getOwner,
  onCleanup,
  sharedConfig
} from "./chunk-VL2SL2GY.js";

// ../../node_modules/.bun/@solid-primitives+rootless@1.5.2+95b571dd5236cc92/node_modules/@solid-primitives/rootless/dist/index.js
function createSingletonRoot(factory, detachedOwner = getOwner()) {
  let listeners = 0, value, disposeRoot;
  return () => {
    listeners++;
    onCleanup(() => {
      listeners--;
      queueMicrotask(() => {
        if (!listeners && disposeRoot) {
          disposeRoot();
          disposeRoot = value = void 0;
        }
      });
    });
    if (!disposeRoot) {
      createRoot((dispose) => value = factory(disposeRoot = dispose), detachedOwner);
    }
    return value;
  };
}
function createHydratableSingletonRoot(factory) {
  const owner = getOwner();
  const singleton = createSingletonRoot(factory, owner);
  return () => isServer || sharedConfig.context ? createRoot(factory, owner) : singleton();
}

export {
  createHydratableSingletonRoot
};
//# sourceMappingURL=chunk-YOJYDSY5.js.map
