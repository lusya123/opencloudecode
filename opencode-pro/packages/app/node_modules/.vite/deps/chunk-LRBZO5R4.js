import {
  accessWith,
  isObject
} from "./chunk-EPEP5WPS.js";
import {
  isServer
} from "./chunk-5C2DUIQJ.js";
import {
  batch,
  createSignal,
  getListener,
  onMount,
  sharedConfig,
  untrack
} from "./chunk-VL2SL2GY.js";

// ../../node_modules/.bun/@solid-primitives+static-store@0.1.2+95b571dd5236cc92/node_modules/@solid-primitives/static-store/dist/index.js
function createStaticStore(init) {
  const copy = { ...init }, store = { ...init }, cache = {};
  const getValue = (key) => {
    let signal = cache[key];
    if (!signal) {
      if (!getListener())
        return copy[key];
      cache[key] = signal = createSignal(copy[key], { internal: true });
      delete copy[key];
    }
    return signal[0]();
  };
  for (const key in init) {
    Object.defineProperty(store, key, { get: () => getValue(key), enumerable: true });
  }
  const setValue = (key, value) => {
    const signal = cache[key];
    if (signal)
      return signal[1](value);
    if (key in copy)
      copy[key] = accessWith(value, copy[key]);
  };
  return [
    store,
    (a, b) => {
      if (isObject(a)) {
        const entries = untrack(() => Object.entries(accessWith(a, store)));
        batch(() => {
          for (const [key, value] of entries)
            setValue(key, () => value);
        });
      } else
        setValue(a, b);
      return store;
    }
  ];
}
function createHydratableStaticStore(serverValue, update) {
  if (isServer)
    return createStaticStore(serverValue);
  if (sharedConfig.context) {
    const [state, setState] = createStaticStore(serverValue);
    onMount(() => setState(update()));
    return [state, setState];
  }
  return createStaticStore(update());
}

export {
  createStaticStore,
  createHydratableStaticStore
};
//# sourceMappingURL=chunk-LRBZO5R4.js.map
