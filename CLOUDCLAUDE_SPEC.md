# CloudClaude - åŸºäº OpenCode çš„å¢å¼ºå¥—ä»¶

> è®© OpenCode æˆä¸º 24/7 äº‘ç«¯æ™ºèƒ½åŠ©æ‰‹

## é¡¹ç›®å®šä½

CloudClaude æ˜¯ OpenCode çš„**å¢å¼ºå¥—ä»¶**ï¼Œä¸ä¿®æ”¹ OpenCode æºç ï¼Œé€šè¿‡è°ƒç”¨ OpenCode API å®ç°ï¼š
- å®šæ—¶ä»»åŠ¡è°ƒåº¦
- é£ä¹¦/å¾®ä¿¡é›†æˆ
- Web ç®¡ç†é¢æ¿
- è‡ªç„¶è¯­è¨€é…ç½®

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è®¿é—®å±‚                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Web é¢æ¿   â”‚  é£ä¹¦æœºå™¨äºº  â”‚  å¾®ä¿¡æœºå™¨äºº  â”‚   API æ¥å£          â”‚
â”‚  (æµè§ˆå™¨)   â”‚  (Webhook)  â”‚  (Webhook)  â”‚   (REST)           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚             â”‚                 â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CloudClaude æœåŠ¡å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å®šæ—¶ä»»åŠ¡è°ƒåº¦ â”‚  â”‚  æ¶ˆæ¯è·¯ç”±å™¨  â”‚  â”‚     é…ç½®ç®¡ç†å™¨          â”‚ â”‚
â”‚  â”‚ (Scheduler) â”‚  â”‚  (Router)   â”‚  â”‚  (ConfigManager)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                â”‚                     â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                          â”‚                                     â”‚
â”‚                          â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              OpenCode API å®¢æˆ·ç«¯                         â”‚   â”‚
â”‚  â”‚  â€¢ ä¼šè¯ç®¡ç†  â€¢ æ¶ˆæ¯å‘é€  â€¢ PTY ç»ˆç«¯  â€¢ äº‹ä»¶è®¢é˜…          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP API
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenCode (å®˜æ–¹ç‰ˆæœ¬)                           â”‚
â”‚                                                                 â”‚
â”‚  ç«¯å£: 10274                                                    â”‚
â”‚  â€¢ /session/* - ä¼šè¯ç®¡ç†                                        â”‚
â”‚  â€¢ /pty/* - ç»ˆç«¯ç®¡ç†                                            â”‚
â”‚  â€¢ /config - é…ç½®                                               â”‚
â”‚  â€¢ /global/event - SSE äº‹ä»¶æµ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ (Scheduler)

**åŠŸèƒ½æè¿°**ï¼š
- Cron è¡¨è¾¾å¼å®šæ—¶è§¦å‘
- ä»»åŠ¡è§¦å‘æ—¶è‡ªåŠ¨åˆ›å»º OpenCode ä¼šè¯å¹¶æ‰§è¡ŒæŒ‡ä»¤
- æ‰§è¡Œç»“æœæ¨é€åˆ°é£ä¹¦/å¾®ä¿¡
- æ”¯æŒè‡ªç„¶è¯­è¨€åˆ›å»º/ä¿®æ”¹ä»»åŠ¡

**æ•°æ®ç»“æ„**ï¼š
```typescript
interface ScheduledTask {
  id: string
  name: string
  cron: string                    // "0 12 * * *"
  instruction: string             // å‘é€ç»™ AI çš„æŒ‡ä»¤
  workingDir?: string             // å·¥ä½œç›®å½•
  enabled: boolean
  notifyChannels: string[]        // ["feishu", "wechat"]
  lastRun?: string
  lastResult?: "success" | "failed"
  createdAt: string
  createdBy: "user" | "ai"        // æ”¯æŒ AI åˆ›å»ºä»»åŠ¡
}
```

**API ç«¯ç‚¹**ï¼š
```
GET    /api/tasks              # åˆ—å‡ºæ‰€æœ‰ä»»åŠ¡
POST   /api/tasks              # åˆ›å»ºä»»åŠ¡
PUT    /api/tasks/:id          # æ›´æ–°ä»»åŠ¡
DELETE /api/tasks/:id          # åˆ é™¤ä»»åŠ¡
POST   /api/tasks/:id/run      # ç«‹å³æ‰§è¡Œ
GET    /api/tasks/:id/history  # æ‰§è¡Œå†å²
```

**è‡ªç„¶è¯­è¨€ç¤ºä¾‹**ï¼š
```
ç”¨æˆ·: "æ¯å¤©ä¸­åˆ12ç‚¹è¿è¡Œ /home/scripts/backup.sh"
AI: åˆ›å»ºå®šæ—¶ä»»åŠ¡ â†’ è°ƒç”¨ POST /api/tasks

ç”¨æˆ·: "æŠŠå¤‡ä»½ä»»åŠ¡æ”¹æˆæ¯å‘¨ä¸€æ‰§è¡Œ"
AI: æ›´æ–°ä»»åŠ¡ â†’ è°ƒç”¨ PUT /api/tasks/:id
```

---

### 2. æ¶ˆæ¯è·¯ç”±å™¨ (Router)

**åŠŸèƒ½æè¿°**ï¼š
- æ¥æ”¶é£ä¹¦/å¾®ä¿¡æ¶ˆæ¯
- è§£æç”¨æˆ·æ„å›¾ï¼ˆå¯¹è¯/å‘½ä»¤/ä»»åŠ¡ç®¡ç†ï¼‰
- è·¯ç”±åˆ°å¯¹åº”å¤„ç†å™¨
- è¿”å›ç»“æœåˆ°æ¶ˆæ¯æº

**æ¶ˆæ¯æµç¨‹**ï¼š
```
é£ä¹¦æ¶ˆæ¯ â”€â”€â”
          â”œâ”€â”€â–º æ¶ˆæ¯è·¯ç”±å™¨ â”€â”€â–º æ„å›¾è¯†åˆ«
å¾®ä¿¡æ¶ˆæ¯ â”€â”€â”˜                    â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                     â”‚
              æ™®é€šå¯¹è¯              ç³»ç»Ÿå‘½ä»¤
                    â”‚                     â”‚
                    â–¼                     â–¼
           è°ƒç”¨ OpenCode API      ç›´æ¥å¤„ç†
           /session/:id/message   (ä»»åŠ¡ç®¡ç†/é…ç½®ç­‰)
                    â”‚                     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                         è¿”å›ç»“æœåˆ°æ¶ˆæ¯æº
```

**æ”¯æŒçš„å‘½ä»¤**ï¼š
```
/new [name]        - åˆ›å»ºæ–°ä¼šè¯
/switch <id>       - åˆ‡æ¢ä¼šè¯
/list              - åˆ—å‡ºä¼šè¯
/task list         - åˆ—å‡ºå®šæ—¶ä»»åŠ¡
/task add <...>    - æ·»åŠ ä»»åŠ¡
/config show       - æ˜¾ç¤ºé…ç½®
/terminal          - è·å–ç»ˆç«¯é“¾æ¥
```

---

### 3. Web ç®¡ç†é¢æ¿ (Panel)

**é¡µé¢å¸ƒå±€è®¾è®¡**ï¼š

æ•´ä½“é‡‡ç”¨å·¦ä¾§å¯¼èˆªæ  + å³ä¾§å†…å®¹åŒºçš„å¸ƒå±€ï¼Œå·¦ä¾§å¯¼èˆªæ åŒ…å«å››ä¸ªä¸»è¦æ¨¡å—ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¦ä¾§å¯¼èˆªæ                 â”‚           å³ä¾§å†…å®¹åŒº                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                                      â”‚
â”‚  â”‚ ğŸ“ Workspace       â”‚   â”‚                                      â”‚
â”‚  â”‚ â° å®šæ—¶ä»»åŠ¡         â”‚   â”‚        æ ¹æ®é€‰ä¸­æ¨¡å—æ˜¾ç¤ºå†…å®¹            â”‚
â”‚  â”‚ ğŸ“‚ æ–‡ä»¶ç³»ç»Ÿ         â”‚   â”‚                                      â”‚
â”‚  â”‚ ğŸ’» ç»ˆç«¯            â”‚   â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å››å¤§æ¨¡å—**ï¼š

1. **Workspaceï¼ˆé¡¹ç›®æ ‡ç­¾é¡µï¼‰**
   - å±•ç¤ºä¸åŒé¡¹ç›®åˆ—è¡¨
   - æ¯ä¸ªé¡¹ç›®ä¸‹å±•ç¤ºä¸åŒä¼šè¯è®°å½•
   - ç‚¹å‡»ä¼šè¯è¿›å…¥å¯¹è¯ç•Œé¢
   - ä¿æŒä¸åŸ OpenCode Web UI ä¸€è‡´çš„å®ç°

2. **å®šæ—¶ä»»åŠ¡**
   - å±•ç¤º AI é¢„è®¾å¹¶å®šæ—¶è¿è¡Œçš„ä»»åŠ¡åˆ—è¡¨
   - ä»»åŠ¡çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ã€ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´ï¼‰
   - åˆ›å»º/ç¼–è¾‘ä»»åŠ¡è¡¨å•
   - Cron è¡¨è¾¾å¼å¯è§†åŒ–ç¼–è¾‘å™¨
   - æ‰§è¡Œå†å²å’Œæ—¥å¿—

3. **æ–‡ä»¶ç³»ç»Ÿ**
   - VS Code é£æ ¼çš„æ–‡ä»¶æ ‘æµè§ˆå™¨
   - å±•ç¤ºç³»ç»Ÿå†…æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•
   - æ”¯æŒæ–‡ä»¶æ‹–æ‹½æ“ä½œ
   - æ–‡ä»¶é¢„è§ˆåŠŸèƒ½

4. **ç»ˆç«¯**
   - åŸºäº xterm.js
   - è¿æ¥ OpenCode PTY API
   - æ”¯æŒå¤šç»ˆç«¯æ ‡ç­¾
   - ç‚¹å‡»åå³ä¾§å†…å®¹åŒºåˆ‡æ¢ä¸ºå®æ—¶äº¤äº’ç»ˆç«¯ï¼ˆæ›¿ä»£å¯¹è¯ç•Œé¢ï¼‰

**æ ¸å¿ƒäº¤äº’è®¾è®¡ - æ–‡ä»¶ç³»ç»Ÿçš„å åŠ æ˜¾ç¤º**ï¼š

æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç‹¬ç«‹æ¨¡å—ï¼Œæ¿€æ´»æ—¶ä¼šä¸ä¸Šä¸€ä¸ªæ‰“å¼€çš„é¡µé¢**å¹¶æ’æ˜¾ç¤º**ï¼š

```
åœºæ™¯ Aï¼šä¸Šä¸€ä¸ªæ“ä½œæ˜¯ç»ˆç«¯ï¼Œç‚¹å‡»æ–‡ä»¶ç³»ç»Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¼èˆªæ   â”‚      æ–‡ä»¶ç³»ç»Ÿ        â”‚         ç»ˆç«¯                    â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ Workspaceâ”‚  â”‚ ğŸ“ project/ â”‚    â”‚  â”‚ $ _                     â”‚    â”‚
â”‚ å®šæ—¶ä»»åŠ¡ â”‚  â”‚   ğŸ“„ file.tsâ”‚ â”€â”€æ‹–æ‹½â†’â”‚                         â”‚    â”‚
â”‚ æ–‡ä»¶ç³»ç»Ÿâœ“â”‚  â”‚   ğŸ“ src/   â”‚    â”‚  â”‚                         â”‚    â”‚
â”‚ ç»ˆç«¯    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†’ å¯å°†æ–‡ä»¶ä»æ–‡ä»¶ç³»ç»Ÿç›´æ¥æ‹–æ‹½åˆ°ç»ˆç«¯ä¸­

åœºæ™¯ Bï¼šä¸Šä¸€ä¸ªæ“ä½œæ˜¯å¯¹è¯ç•Œé¢ï¼Œç‚¹å‡»æ–‡ä»¶ç³»ç»Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¼èˆªæ   â”‚      æ–‡ä»¶ç³»ç»Ÿ        â”‚         å¯¹è¯ç•Œé¢                 â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ Workspaceâ”‚  â”‚ ğŸ“ project/ â”‚    â”‚  â”‚ ç”¨æˆ·: å¸®æˆ‘åˆ†æè¿™ä¸ªæ–‡ä»¶   â”‚    â”‚
â”‚ å®šæ—¶ä»»åŠ¡ â”‚  â”‚   ğŸ“„ file.tsâ”‚ â”€â”€æ‹–æ‹½â†’â”‚ [æ–‡ä»¶è¾“å…¥æ¡†]            â”‚    â”‚
â”‚ æ–‡ä»¶ç³»ç»Ÿâœ“â”‚  â”‚   ğŸ“ src/   â”‚    â”‚  â”‚                         â”‚    â”‚
â”‚ ç»ˆç«¯    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†’ å¯å°†æ–‡ä»¶ä»æ–‡ä»¶ç³»ç»Ÿç›´æ¥æ‹–å…¥å¯¹è¯æ¡†

åœºæ™¯ Cï¼šç‚¹å‡» Workspace
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¼èˆªæ   â”‚   é¡¹ç›®/ä¼šè¯åˆ—è¡¨       â”‚         å¯¹è¯ç•Œé¢                 â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ Workspaceâœ“â”‚ â”‚ ğŸ“ é¡¹ç›® A    â”‚    â”‚  â”‚                         â”‚    â”‚
â”‚ å®šæ—¶ä»»åŠ¡ â”‚  â”‚   ğŸ’¬ ä¼šè¯ 1  â”‚    â”‚  â”‚      é€‰ä¸­ä¼šè¯çš„å¯¹è¯å†…å®¹   â”‚    â”‚
â”‚ æ–‡ä»¶ç³»ç»Ÿ â”‚  â”‚   ğŸ’¬ ä¼šè¯ 2  â”‚    â”‚  â”‚                         â”‚    â”‚
â”‚ ç»ˆç«¯    â”‚  â”‚ ğŸ“ é¡¹ç›® B    â”‚    â”‚  â”‚                         â”‚    â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†’ å·¦ä¾§å˜ä¸ºé¡¹ç›®å’Œä¼šè¯åˆ—è¡¨ï¼ˆä¸åŸ Web UI ç›¸åŒï¼‰
```

**äº¤äº’è§„åˆ™æ€»ç»“**ï¼š
- ç‚¹å‡» Workspaceï¼šå·¦ä¾§æ˜¾ç¤ºé¡¹ç›®/ä¼šè¯åˆ—è¡¨ï¼Œå³ä¾§æ˜¾ç¤ºå¯¹è¯ç•Œé¢
- ç‚¹å‡»å®šæ—¶ä»»åŠ¡ï¼šå…¨å±æ˜¾ç¤ºå®šæ—¶ä»»åŠ¡ç®¡ç†é¡µé¢
- ç‚¹å‡»æ–‡ä»¶ç³»ç»Ÿï¼šæ–‡ä»¶ç³»ç»Ÿä¸ä¸Šä¸€ä¸ªæ´»åŠ¨é¡µé¢ï¼ˆç»ˆç«¯æˆ–å¯¹è¯ï¼‰å¹¶æ’æ˜¾ç¤º
- ç‚¹å‡»ç»ˆç«¯ï¼šå³ä¾§å†…å®¹åŒºåˆ‡æ¢ä¸ºå®æ—¶äº¤äº’ç»ˆç«¯
- æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ‹–æ‹½æ–‡ä»¶åˆ°ç»ˆç«¯æˆ–å¯¹è¯è¾“å…¥æ¡†

**è·¯ç”±ç»“æ„**ï¼š
```
/                     - é»˜è®¤è¿›å…¥ Workspace
/workspace            - é¡¹ç›®å’Œä¼šè¯ç®¡ç†
/workspace/:projectId/:sessionId  - æŒ‡å®šä¼šè¯å¯¹è¯
/tasks                - å®šæ—¶ä»»åŠ¡ç®¡ç†
/terminal             - Web ç»ˆç«¯
/config               - é…ç½®ç®¡ç†
```

---

### 4. é…ç½®ç®¡ç†å™¨ (ConfigManager)

**é…ç½®æ–‡ä»¶**ï¼š`~/.cloudclaude/config.json`

```json
{
  "opencode": {
    "url": "http://localhost:10274",
    "password": ""
  },
  "feishu": {
    "enabled": true,
    "appId": "",
    "appSecret": "",
    "webhookUrl": ""
  },
  "wechat": {
    "enabled": false,
    "appId": "",
    "appSecret": ""
  },
  "panel": {
    "port": 3000,
    "auth": {
      "enabled": true,
      "username": "admin",
      "password": ""
    }
  },
  "defaults": {
    "workingDir": "/home/projects",
    "notifyOnComplete": true,
    "sessionTimeout": 3600
  }
}
```

**è‡ªç„¶è¯­è¨€é…ç½®**ï¼š
```
ç”¨æˆ·: "æŠŠé»˜è®¤å·¥ä½œç›®å½•æ”¹æˆ /home/data"
AI: ä¿®æ”¹é…ç½® â†’ defaults.workingDir = "/home/data"

ç”¨æˆ·: "å¼€å¯å¾®ä¿¡é€šçŸ¥"
AI: ä¿®æ”¹é…ç½® â†’ wechat.enabled = true
```

---

## OpenCode API è°ƒç”¨å°è£…

```typescript
// packages/core/src/opencode-client.ts

class OpenCodeClient {
  private baseUrl: string
  private auth?: { username: string; password: string }

  // ä¼šè¯ç®¡ç†
  async listSessions(): Promise<Session[]>
  async createSession(workingDir: string): Promise<Session>
  async getSession(id: string): Promise<Session>
  async deleteSession(id: string): Promise<void>

  // æ¶ˆæ¯
  async sendMessage(sessionId: string, content: string): Promise<void>
  async getMessages(sessionId: string): Promise<Message[]>

  // äº‹ä»¶æµ
  subscribeEvents(callback: (event: Event) => void): () => void
  subscribeSessionEvents(sessionId: string, callback: (event: Event) => void): () => void

  // PTY ç»ˆç«¯
  async createPty(): Promise<{ ptyId: string }>
  async getPtyWebSocketUrl(ptyId: string): Promise<string>

  // é…ç½®
  async getConfig(): Promise<Config>
}
```

---

## é¡¹ç›®ç»“æ„

```
cloudclaude/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒåº“
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ opencode-client.ts    # OpenCode API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler.ts          # å®šæ—¶ä»»åŠ¡è°ƒåº¦
â”‚   â”‚   â”‚   â”œâ”€â”€ config-manager.ts     # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ types.ts              # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ server/                  # åç«¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts              # å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tasks.ts          # ä»»åŠ¡ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sessions.ts       # ä¼šè¯ä»£ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ config.ts         # é…ç½® API
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ feishu.ts         # é£ä¹¦é›†æˆ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ wechat.ts         # å¾®ä¿¡é›†æˆ
â”‚   â”‚   â”‚   â””â”€â”€ websocket/
â”‚   â”‚   â”‚       â””â”€â”€ terminal.ts       # ç»ˆç«¯ WebSocket ä»£ç†
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ web/                     # å‰ç«¯é¢æ¿
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Workspace.tsx       # é¡¹ç›®/ä¼šè¯ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Chat.tsx            # å¯¹è¯ç•Œé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Tasks.tsx           # å®šæ—¶ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Terminal.tsx        # ç»ˆç«¯é¡µé¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Config.tsx          # é…ç½®é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx         # å·¦ä¾§å¯¼èˆªæ 
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileExplorer.tsx    # æ–‡ä»¶ç³»ç»Ÿæµè§ˆå™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectList.tsx     # é¡¹ç›®åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SessionList.tsx     # ä¼šè¯åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageList.tsx     # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TaskForm.tsx        # ä»»åŠ¡è¡¨å•
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CronEditor.tsx      # Cron ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ XTerminal.tsx       # ç»ˆç«¯ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MainLayout.tsx      # ä¸»å¸ƒå±€
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SplitLayout.tsx     # åˆ†å±å¸ƒå±€ï¼ˆæ–‡ä»¶ç³»ç»Ÿå åŠ ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ cli/                     # å‘½ä»¤è¡Œå·¥å…·
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ default.json             # é»˜è®¤é…ç½®
â”‚
â”œâ”€â”€ package.json                 # Monorepo æ ¹é…ç½®
â”œâ”€â”€ turbo.json
â””â”€â”€ README.md
```

---

## æŠ€æœ¯é€‰å‹

| æ¨¡å— | æŠ€æœ¯ | ç†ç”± |
|------|------|------|
| åç«¯æ¡†æ¶ | Hono | è½»é‡ã€ä¸ OpenCode ä¸€è‡´ |
| å‰ç«¯æ¡†æ¶ | SolidJS | ä¸ OpenCode ä¸€è‡´ï¼Œå¯å¤ç”¨ç»„ä»¶ |
| å®šæ—¶è°ƒåº¦ | node-cron | æˆç†Ÿç¨³å®š |
| ç»ˆç«¯ | xterm.js | ä¸šç•Œæ ‡å‡† |
| æ•°æ®å­˜å‚¨ | SQLite | è½»é‡ã€æ— éœ€é¢å¤–æœåŠ¡ |
| åŒ…ç®¡ç† | Bun | ä¸ OpenCode ä¸€è‡´ |
| Monorepo | Turborepo | ä¸ OpenCode ä¸€è‡´ |

---

## å®ç°è®¡åˆ’

### Phase 1: æ ¸å¿ƒåŸºç¡€
- [ ] é¡¹ç›®åˆå§‹åŒ–ï¼ˆMonorepo ç»“æ„ï¼‰
- [ ] OpenCode API å®¢æˆ·ç«¯å°è£…
- [ ] åŸºç¡€é…ç½®ç®¡ç†
- [ ] ç®€å• Web é¢æ¿ï¼ˆä¼šè¯åˆ—è¡¨ + å¯¹è¯ï¼‰

### Phase 2: å®šæ—¶ä»»åŠ¡
- [ ] å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
- [ ] ä»»åŠ¡ç®¡ç† API
- [ ] ä»»åŠ¡ç®¡ç† UI
- [ ] æ‰§è¡Œå†å²è®°å½•

### Phase 3: æ¶ˆæ¯é›†æˆ
- [ ] é£ä¹¦æœºå™¨äººé›†æˆ
- [ ] æ¶ˆæ¯è·¯ç”±å™¨
- [ ] ç»“æœæ¨é€

### Phase 4: å¢å¼ºåŠŸèƒ½
- [ ] Web ç»ˆç«¯
- [ ] è‡ªç„¶è¯­è¨€é…ç½®ï¼ˆOpenCode æ’ä»¶ï¼‰
- [ ] å¾®ä¿¡é›†æˆï¼ˆå¯é€‰ï¼‰

---

## ç”¨æˆ·ä½¿ç”¨æµç¨‹

### å®‰è£…
```bash
# å…¨å±€å®‰è£…
npm install -g cloudclaude

# æˆ–è€… Docker
docker run -d --name cloudclaude \
  -p 3000:3000 \
  -v ~/.cloudclaude:/root/.cloudclaude \
  cloudclaude/cloudclaude
```

### é…ç½®
```bash
# åˆå§‹åŒ–é…ç½®
cloudclaude init

# é…ç½®é£ä¹¦
cloudclaude config set feishu.appId xxx
cloudclaude config set feishu.appSecret xxx
```

### è¿è¡Œ
```bash
# ç¡®ä¿ OpenCode åœ¨è¿è¡Œ
opencode &

# å¯åŠ¨ CloudClaude
cloudclaude start

# è®¿é—® http://localhost:3000
```

### é£ä¹¦ä½¿ç”¨
```
ç”¨æˆ·: å¸®æˆ‘æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
AI: [æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›ç»“æœ]

ç”¨æˆ·: æ¯å¤©æ—©ä¸Š9ç‚¹ç»™æˆ‘å‘é€æœåŠ¡å™¨æŠ¥å‘Š
AI: âœ… å·²åˆ›å»ºå®šæ—¶ä»»åŠ¡ã€Œæ¯æ—¥æœåŠ¡å™¨æŠ¥å‘Šã€
    æ‰§è¡Œæ—¶é—´: æ¯å¤© 09:00
    ä¸‹æ¬¡æ‰§è¡Œ: æ˜å¤© 09:00

ç”¨æˆ·: /task list
AI: ğŸ“‹ å®šæ—¶ä»»åŠ¡åˆ—è¡¨:
    1. æ¯æ—¥æœåŠ¡å™¨æŠ¥å‘Š - 09:00 æ¯å¤© - âœ… å¯ç”¨
    2. æ•°æ®å¤‡ä»½ - 02:00 æ¯å¤© - âœ… å¯ç”¨
```

---

## ä¸ OpenCode çš„å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è§†è§’                              â”‚
â”‚                                                         â”‚
â”‚   "CloudClaude æ˜¯ OpenCode çš„äº‘ç«¯å¢å¼ºç‰ˆ"                 â”‚
â”‚   "è®© OpenCode èƒ½ 24/7 è¿è¡Œï¼Œæ”¯æŒå®šæ—¶ä»»åŠ¡å’Œæ¶ˆæ¯é€šçŸ¥"      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŠ€æœ¯è§†è§’                              â”‚
â”‚                                                         â”‚
â”‚   CloudClaude = OpenCode API å®¢æˆ·ç«¯                     â”‚
â”‚               + å®šæ—¶ä»»åŠ¡è°ƒåº¦                             â”‚
â”‚               + æ¶ˆæ¯å¹³å°é›†æˆ                             â”‚
â”‚               + Web ç®¡ç†é¢æ¿                             â”‚
â”‚                                                         â”‚
â”‚   ä¸ä¿®æ”¹ OpenCode ä»»ä½•ä»£ç ï¼Œçº¯ API è°ƒç”¨                  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‘å¸ƒç­–ç•¥

1. **GitHub å¼€æº** - MIT åè®®
2. **NPM åŒ…** - `npm install -g cloudclaude`
3. **Docker é•œåƒ** - `docker pull cloudclaude/cloudclaude`
4. **æ–‡æ¡£ç«™ç‚¹** - ä½¿ç”¨æŒ‡å—ã€API æ–‡æ¡£

---

## FAQ

**Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ Fork OpenCodeï¼Ÿ**
A: Fork éœ€è¦æŒç»­è·Ÿè¿›ä¸Šæ¸¸æ›´æ–°ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚é€šè¿‡ API è°ƒç”¨ï¼ŒOpenCode å‡çº§ä¸å½±å“ CloudClaudeã€‚

**Q: OpenCode æ›´æ–° API æ€ä¹ˆåŠï¼Ÿ**
A: OpenCode API æœ‰ OpenAPI è§„èŒƒï¼Œå˜æ›´ä¼šæœ‰ç‰ˆæœ¬æ§åˆ¶ã€‚æˆ‘ä»¬å°è£…äº† API å®¢æˆ·ç«¯ï¼Œé€‚é…æˆæœ¬ä½ã€‚

**Q: æ€§èƒ½å¦‚ä½•ï¼Ÿ**
A: CloudClaude åªæ˜¯è–„è–„ä¸€å±‚è°ƒåº¦å’Œè·¯ç”±ï¼Œæ ¸å¿ƒè®¡ç®—éƒ½åœ¨ OpenCodeã€‚é¢å¤–å¼€é”€å¯å¿½ç•¥ã€‚

**Q: å¯ä»¥ä¸ç”¨é£ä¹¦å—ï¼Ÿ**
A: å¯ä»¥ã€‚é£ä¹¦/å¾®ä¿¡éƒ½æ˜¯å¯é€‰æ¨¡å—ï¼Œçº¯ Web é¢æ¿ä¹Ÿèƒ½å®Œæ•´ä½¿ç”¨ã€‚

---

## æ ¸å¿ƒè®¾è®¡åŸåˆ™ï¼šä¸€åˆ‡çš†è‡ªç„¶è¯­è¨€

### è®¾è®¡ç†å¿µ

ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€å®Œæˆï¼Œæ— éœ€å­¦ä¹ å‘½ä»¤æˆ–æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼š
```
ç”¨æˆ·è¯´çš„ä»»ä½•è¯ â†’ å…¨éƒ¨å‘ç»™ AI â†’ AI å†³å®šè°ƒç”¨ä»€ä¹ˆå·¥å…·
```

### è‡ªç„¶è¯­è¨€èƒ½åŠ›ç¤ºä¾‹

| ç”¨æˆ·è¯´ | AI æ‰§è¡Œ |
|--------|---------|
| "æˆ‘çš„ OpenAI API Key æ˜¯ sk-xxx" | è°ƒç”¨ `config_set` å·¥å…·ä¿®æ”¹é…ç½® |
| "æŠŠ Base URL æ”¹æˆ https://api.example.com" | è°ƒç”¨ `config_set` å·¥å…· |
| "å¼€ä¸€ä¸ªæ–°ä¼šè¯ï¼Œåœ¨ /home/projects ç›®å½•" | è°ƒç”¨ `session_create` å·¥å…· |
| "æ¯å¤©æ—©ä¸Š9ç‚¹æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€" | è°ƒç”¨ `schedule_task` å·¥å…·åˆ›å»ºå®šæ—¶ä»»åŠ¡ |
| "å¸®æˆ‘åšä¸ªç½‘é¡µç„¶åéƒ¨ç½²ä¸Šçº¿" | è°ƒç”¨ bashã€write ç­‰å·¥å…·å®Œæˆå¼€å‘éƒ¨ç½² |

### è‡ªå®šä¹‰å·¥å…·ï¼ˆé€šè¿‡ OpenCode æ’ä»¶æ·»åŠ ï¼‰

```typescript
// cloudclaude-plugin/index.ts
export default async function(input: PluginInput): Promise<Hooks> {
  return {
    tool: {
      // ä¿®æ”¹é…ç½®
      "config_set": {
        description: "ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œå¦‚ API Keyã€Base URLã€å·¥ä½œç›®å½•ç­‰",
        parameters: z.object({
          key: z.string().describe("é…ç½®é¡¹è·¯å¾„ï¼Œå¦‚ 'openai.apiKey'"),
          value: z.string().describe("é…ç½®å€¼")
        }),
        execute: async ({ key, value }) => {
          await configManager.set(key, value)
          return { success: true, message: `å·²è®¾ç½® ${key}` }
        }
      },

      // åˆ›å»ºä¼šè¯
      "session_create": {
        description: "åˆ›å»ºæ–°çš„å¯¹è¯ä¼šè¯",
        parameters: z.object({
          name: z.string().optional(),
          workingDir: z.string().optional()
        }),
        execute: async ({ name, workingDir }) => {
          const session = await client.session.sessionCreate({ ... })
          return { sessionId: session.id }
        }
      },

      // åˆ›å»ºå®šæ—¶ä»»åŠ¡
      "schedule_task": {
        description: "åˆ›å»ºå®šæ—¶ä»»åŠ¡",
        parameters: z.object({
          name: z.string(),
          cron: z.string().describe("Cron è¡¨è¾¾å¼"),
          instruction: z.string().describe("ä»»åŠ¡æ‰§è¡Œæ—¶çš„æŒ‡ä»¤")
        }),
        execute: async ({ name, cron, instruction }) => {
          scheduler.add({ name, cron, instruction })
          return { success: true }
        }
      },

      // å‘é€é£ä¹¦æ¶ˆæ¯
      "feishu_send": {
        description: "å‘é€é£ä¹¦æ¶ˆæ¯",
        parameters: z.object({
          userId: z.string(),
          content: z.string()
        }),
        execute: async ({ userId, content }) => {
          await feishuBot.send(userId, content)
          return { success: true }
        }
      }
    }
  }
}
```

### æ¶ˆæ¯å¤„ç†æµç¨‹

è®¿é—®å±‚ï¼ˆé£ä¹¦/Webï¼‰ä¸åšä»»ä½•æ„å›¾è§£æï¼Œç›´æ¥é€ä¼ ç»™ AIï¼š

```typescript
// é£ä¹¦æ¶ˆæ¯å¤„ç† - æç®€
async function handleFeishuMessage(text: string, userId: string) {
  // ä¸è§£æï¼Œç›´æ¥å‘ç»™ AI
  const result = await opencode.session.sessionPrompt({
    sessionId: getUserSession(userId),
    body: { content: text }
  })
  return result
}
```

### æƒé™è®¾è®¡

Agent æ‹¥æœ‰æœåŠ¡å™¨å®Œå…¨æ§åˆ¶æƒé™ï¼š
- æ‰§è¡Œä»»ä½•å‘½ä»¤
- ä¿®æ”¹ä»»ä½•æ–‡ä»¶
- å®‰è£…ä»»ä½•è½¯ä»¶
- éƒ¨ç½²ä»»ä½•æœåŠ¡

é…ç½®æ–¹å¼ï¼š
```json
// opencode.json
{
  "permissions": {
    "autoApprove": ["Bash(*)", "Write(*)", "Edit(*)"]
  }
}
```

---

## å®šæ—¶ä»»åŠ¡è§¦å‘æœºåˆ¶

### ä¸¤ç§è§¦å‘æ–¹å¼

1. **ç”¨æˆ·ä¸»åŠ¨è§¦å‘** - é€šè¿‡é£ä¹¦/Web å‘é€æ¶ˆæ¯
2. **å®šæ—¶ä»»åŠ¡è§¦å‘** - Scheduler æ£€æµ‹åˆ°æ—¶é—´åè‡ªåŠ¨æ‰§è¡Œ

ä¸¤ç§æ–¹å¼æœ€ç»ˆéƒ½èµ°åŒä¸€ä¸ª Agentic Loopï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è§¦å‘æ¥æº                                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ç”¨æˆ·ä¸»åŠ¨è§¦å‘     â”‚        â”‚ å®šæ—¶ä»»åŠ¡è§¦å‘             â”‚    â”‚
â”‚  â”‚                 â”‚        â”‚                         â”‚    â”‚
â”‚  â”‚ é£ä¹¦æ¶ˆæ¯        â”‚        â”‚ Scheduler æ£€æµ‹åˆ°æ—¶é—´    â”‚    â”‚
â”‚  â”‚ Web é¢æ¿è¾“å…¥    â”‚        â”‚ è¯»å–ä»»åŠ¡çš„ instruction  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚                              â”‚                 â”‚
â”‚           â”‚     éƒ½æ˜¯ä¸€æ®µæ–‡æœ¬ (prompt)     â”‚                 â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                          â”‚                                 â”‚
â”‚                          â–¼                                 â”‚
â”‚           client.session.sessionPrompt({                   â”‚
â”‚             sessionId: "xxx",                              â”‚
â”‚             body: { content: prompt }                      â”‚
â”‚           })                                               â”‚
â”‚                          â”‚                                 â”‚
â”‚                          â–¼                                 â”‚
â”‚                  OpenCode Agentic Loop                     â”‚
â”‚           (å·¥å…·è°ƒç”¨ã€Skill æ‰§è¡Œã€æ–‡ä»¶æ“ä½œç­‰)                 â”‚
â”‚                          â”‚                                 â”‚
â”‚                          â–¼                                 â”‚
â”‚                      æ‰§è¡Œç»“æœ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å®ç°

```typescript
// scheduler.ts
class Scheduler {
  private client: OpencodeClient

  async execute(task: ScheduledTask) {
    // 1. è·å–æˆ–åˆ›å»ºä¼šè¯
    let sessionId = task.sessionId
    if (!sessionId) {
      const session = await this.client.session.sessionCreate({
        body: { path: task.workingDir || "/home" }
      })
      sessionId = session.data.id
    }

    // 2. å‘é€æŒ‡ä»¤ï¼ˆèµ°å®Œæ•´ Agentic Loopï¼Œå’Œç”¨æˆ·å‘æ¶ˆæ¯å®Œå…¨ä¸€æ ·ï¼‰
    const result = await this.client.session.sessionPrompt({
      sessionId,
      body: { content: task.instruction }
    })

    // 3. æ¨é€ç»“æœåˆ°é£ä¹¦
    if (task.notifyTo?.length) {
      for (const userId of task.notifyTo) {
        await feishuBot.send(userId, `
ğŸ“‹ å®šæ—¶ä»»åŠ¡ã€Œ${task.name}ã€æ‰§è¡Œå®Œæˆ
${result.data.summary || "ä»»åŠ¡å·²å®Œæˆ"}
        `)
      }
    }
  }
}
```

---

## Web å‰ç«¯å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆé€‰æ‹©ï¼šå¤ç”¨ OpenCode UI ç»„ä»¶åº“

ä¸ Fork OpenCodeï¼Œä¹Ÿä¸ä»é›¶å†™ï¼Œè€Œæ˜¯**ç›´æ¥ä½¿ç”¨ OpenCode çš„ UI ç»„ä»¶åº“**ï¼š

```typescript
// package.json
{
  "dependencies": {
    "@opencode-ai/ui": "latest",    // å¤ç”¨ UI ç»„ä»¶
    "@opencode-ai/sdk": "latest",   // å¤ç”¨ SDK
    "solid-js": "^1.8.0"
  }
}
```

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å·¥ä½œé‡ | ç»´æŠ¤æˆæœ¬ | æ¨èåº¦ |
|------|--------|---------|--------|
| Fork OpenCode æ”¹ | å° | é«˜ï¼ˆæ¯æ¬¡å‡çº§è¦åˆå¹¶ï¼‰ | â­â­ |
| ä»é›¶å†™ | å¤§ | ä½ | â­â­ |
| **å¤ç”¨ UI ç»„ä»¶åº“** | ä¸­ | ä½ | â­â­â­â­â­ |

### å¯å¤ç”¨çš„ OpenCode ç»„ä»¶

| ç»„ä»¶ | ç”¨é€” |
|------|------|
| `SessionTurn` | å¯¹è¯è½®æ¬¡å±•ç¤ºï¼ˆå«å·¥å…·è°ƒç”¨ï¼‰ |
| `MessagePart` | æ¶ˆæ¯éƒ¨åˆ†æ¸²æŸ“ |
| `Markdown` | Markdown æ¸²æŸ“ |
| `Terminal` | xterm.js ç»ˆç«¯ |
| `Button`, `Tabs`, `Dialog` ç­‰ | åŸºç¡€ UI ç»„ä»¶ |

### å¯¹è¯é¡µé¢ç¤ºä¾‹

```tsx
import { SessionTurn } from "@opencode-ai/ui/session-turn"
import { createAutoScroll } from "@opencode-ai/ui/hooks"

function ChatPage({ sessionId }: { sessionId: string }) {
  const { messages, status } = useChat(sessionId)
  const autoScroll = createAutoScroll({ working: () => status() !== "idle" })

  return (
    <div ref={autoScroll.scrollRef}>
      <For each={messages}>
        {(msg) => (
          <SessionTurn
            sessionID={sessionId}
            messageID={msg.id}
            stepsExpanded={true}
            onStepsExpandedToggle={() => {}}
          />
        )}
      </For>

      {/* è¾“å…¥æ¡† */}
      <PromptInput onSubmit={send} />
    </div>
  )
}
```

### å®æ—¶æ˜¾ç¤ºæœºåˆ¶

é€šè¿‡ SSE è®¢é˜… OpenCode äº‹ä»¶æµï¼Œå®æ—¶æ›´æ–° UIï¼š

```typescript
function useChat(sessionId: string) {
  const [messages, setMessages] = createSignal([])
  const [status, setStatus] = createSignal("idle")

  onMount(() => {
    // è®¢é˜…ä¼šè¯äº‹ä»¶
    const eventSource = new EventSource(
      `${OPENCODE_URL}/session/${sessionId}/event`
    )

    eventSource.onmessage = (e) => {
      const event = JSON.parse(e.data)

      switch (event.type) {
        case "part.text.delta":
          // AI æ­£åœ¨è¾“å‡ºæ–‡æœ¬
          break
        case "part.tool.start":
          // å·¥å…·è°ƒç”¨å¼€å§‹
          break
        case "part.tool.done":
          // å·¥å…·è°ƒç”¨å®Œæˆ
          break
        case "message.complete":
          // æ¶ˆæ¯å®Œæˆ
          break
      }
    }

    onCleanup(() => eventSource.close())
  })

  return { messages, status }
}
```

### OpenCode SSE äº‹ä»¶ç±»å‹

| äº‹ä»¶ç±»å‹ | è¯´æ˜ |
|---------|------|
| `part.text.delta` | AI è¾“å‡ºæ–‡æœ¬ç‰‡æ®µ |
| `part.tool.start` | å¼€å§‹è°ƒç”¨å·¥å…· |
| `part.tool.done` | å·¥å…·è°ƒç”¨å®Œæˆ |
| `message.complete` | æ¶ˆæ¯ç”Ÿæˆå®Œæˆ |
| `session.status` | ä¼šè¯çŠ¶æ€å˜åŒ– |

---

## è‡ªå·±å®ç°çš„éƒ¨åˆ†

åªéœ€è¦å†™è¿™äº›ï¼š

```
cloudclaude/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ web/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Workspace.tsx     # é¡¹ç›®/ä¼šè¯ç®¡ç†ï¼ˆå¤ç”¨ OpenCode ä¼šè¯ç»„ä»¶ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Chat.tsx          # å¯¹è¯é¡µï¼ˆå¤ç”¨ SessionTurnï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Tasks.tsx         # å®šæ—¶ä»»åŠ¡ç®¡ç†ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ Config.tsx        # é…ç½®é¡µï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx       # å·¦ä¾§å¯¼èˆªæ ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ FileExplorer.tsx  # æ–‡ä»¶ç³»ç»Ÿæµè§ˆå™¨ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ProjectList.tsx   # é¡¹ç›®åˆ—è¡¨ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionList.tsx   # ä¼šè¯åˆ—è¡¨ï¼ˆå¤ç”¨ OpenCodeï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskForm.tsx      # ä»»åŠ¡è¡¨å•ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ CronEditor.tsx    # Cron ç¼–è¾‘å™¨ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚   â””â”€â”€ layouts/
â”‚   â”‚       â”œâ”€â”€ MainLayout.tsx    # ä¸»å¸ƒå±€ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚       â””â”€â”€ SplitLayout.tsx   # åˆ†å±å¸ƒå±€ - æ–‡ä»¶ç³»ç»Ÿå åŠ é€»è¾‘ï¼ˆè‡ªå·±å†™ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ plugin/                   # OpenCode æ’ä»¶
â”‚       â””â”€â”€ index.ts              # æ·»åŠ è‡ªå®šä¹‰å·¥å…·
```

å¯¹è¯å±•ç¤ºã€å·¥å…·è°ƒç”¨å¯è§†åŒ–ã€ç»ˆç«¯ç­‰å¤æ‚ç»„ä»¶å…¨éƒ¨å¤ç”¨ OpenCode çš„ã€‚
